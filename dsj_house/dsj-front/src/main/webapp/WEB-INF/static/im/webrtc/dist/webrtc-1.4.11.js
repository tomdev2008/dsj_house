/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "./";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ({

/***/ 0:
/***/ (function(module, exports, __webpack_require__) {

	module.exports = __webpack_require__(250);


/***/ }),

/***/ 250:
/***/ (function(module, exports, __webpack_require__) {

	eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(module) {'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar Util = __webpack_require__(252);\nvar Call = __webpack_require__(253);\n\nwindow.WebIM = typeof WebIM !== 'undefined' ? WebIM : {};\nWebIM.WebRTC = WebIM.WebRTC || {};\nWebIM.WebRTC.Call = Call;\nWebIM.WebRTC.Util = Util;\n\nif (( false ? 'undefined' : _typeof(module)) === 'object' && _typeof(module.exports) === 'object') {\n    module.exports = WebIM.WebRTC;\n} else if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n        return WebIM.WebRTC;\n    }.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n}\n\n/**\r\n * 判断是否支持pranswer\r\n */\nif (/Chrome/.test(navigator.userAgent)) {\n    WebIM.WebRTC.supportPRAnswer = navigator.userAgent.split(\"Chrome/\")[1].split(\".\")[0] >= 50 ? true : false;\n}\n\n//WebIM.WebRTC.supportPRAnswer = false;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(251)(module)))\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnJ0Yy9zcmMvZW50cnkuanM/ZmZlNSJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgVXRpbCA9IHJlcXVpcmUoJy4vY29tcG9uZW50cy91dGlscycpO1xyXG52YXIgQ2FsbCA9IHJlcXVpcmUoJy4vY29tcG9uZW50cy9jYWxsJyk7XHJcblxyXG53aW5kb3cuV2ViSU0gPSB0eXBlb2YgV2ViSU0gIT09ICd1bmRlZmluZWQnID8gV2ViSU0gOiB7fTtcclxuV2ViSU0uV2ViUlRDID0gV2ViSU0uV2ViUlRDIHx8IHt9O1xyXG5XZWJJTS5XZWJSVEMuQ2FsbCA9IENhbGw7XHJcbldlYklNLldlYlJUQy5VdGlsID0gVXRpbDtcclxuXHJcbmlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlLmV4cG9ydHMgPT09ICdvYmplY3QnKSB7XHJcbiAgICBtb2R1bGUuZXhwb3J0cyA9IFdlYklNLldlYlJUQztcclxufSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcclxuICAgIGRlZmluZShbXSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBXZWJJTS5XZWJSVEM7XHJcbiAgICB9KTtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiDliKTmlq3mmK/lkKbmlK/mjIFwcmFuc3dlclxyXG4gKi9cclxuaWYgKC9DaHJvbWUvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcclxuICAgIFdlYklNLldlYlJUQy5zdXBwb3J0UFJBbnN3ZXIgPSAobmF2aWdhdG9yLnVzZXJBZ2VudC5zcGxpdChcIkNocm9tZS9cIilbMV0uc3BsaXQoXCIuXCIpWzBdID49IDUwKSA/IHRydWUgOiBmYWxzZTtcclxufVxyXG5cclxuLy9XZWJJTS5XZWJSVEMuc3VwcG9ydFBSQW5zd2VyID0gZmFsc2U7XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJydGMvc3JjL2VudHJ5LmpzIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7OyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ 251:
/***/ (function(module, exports) {

	eval("module.exports = function(module) {\r\n\tif(!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tmodule.children = [];\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n}\r\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLyh3ZWJwYWNrKS9idWlsZGluL21vZHVsZS5qcz9jM2MyIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obW9kdWxlKSB7XHJcblx0aWYoIW1vZHVsZS53ZWJwYWNrUG9seWZpbGwpIHtcclxuXHRcdG1vZHVsZS5kZXByZWNhdGUgPSBmdW5jdGlvbigpIHt9O1xyXG5cdFx0bW9kdWxlLnBhdGhzID0gW107XHJcblx0XHQvLyBtb2R1bGUucGFyZW50ID0gdW5kZWZpbmVkIGJ5IGRlZmF1bHRcclxuXHRcdG1vZHVsZS5jaGlsZHJlbiA9IFtdO1xyXG5cdFx0bW9kdWxlLndlYnBhY2tQb2x5ZmlsbCA9IDE7XHJcblx0fVxyXG5cdHJldHVybiBtb2R1bGU7XHJcbn1cclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gKHdlYnBhY2spL2J1aWxkaW4vbW9kdWxlLmpzXG4vLyBtb2R1bGUgaWQgPSAyNTFcbi8vIG1vZHVsZSBjaHVua3MgPSAyIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ 252:
/***/ (function(module, exports) {

	eval("'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n/*\r\n * ! Math.uuid.js (v1.4) http://www.broofa.com mailto:robert@broofa.com\r\n * \r\n * Copyright (c) 2010 Robert Kieffer Dual licensed under the MIT and GPL\r\n * licenses.\r\n */\n\n/*\r\n * Generate a random uuid.\r\n * \r\n * USAGE: Math.uuid(length, radix) length - the desired number of characters\r\n * radix - the number of allowable values for each character.\r\n * \r\n * EXAMPLES: // No arguments - returns RFC4122, version 4 ID >>> Math.uuid()\r\n * \"92329D39-6F5C-4520-ABFC-AAB64544E172\" // One argument - returns ID of the\r\n * specified length >>> Math.uuid(15) // 15 character ID (default base=62)\r\n * \"VcydxgltxrVZSTV\" // Two arguments - returns ID of the specified length, and\r\n * radix. (Radix must be <= 62) >>> Math.uuid(8, 2) // 8 character ID (base=2)\r\n * \"01001010\" >>> Math.uuid(8, 10) // 8 character ID (base=10) \"47473046\" >>>\r\n * Math.uuid(8, 16) // 8 character ID (base=16) \"098F4D35\"\r\n */\n(function () {\n    // Private array of chars to use\n    var CHARS = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');\n\n    Math.uuid = function (len, radix) {\n        var chars = CHARS,\n            uuid = [],\n            i;\n        radix = radix || chars.length;\n\n        if (len) {\n            // Compact form\n            for (i = 0; i < len; i++) {\n                uuid[i] = chars[0 | Math.random() * radix];\n            }\n        } else {\n            // rfc4122, version 4 form\n            var r;\n\n            // rfc4122 requires these characters\n            uuid[8] = uuid[13] = uuid[18] = uuid[23] = '-';\n            uuid[14] = '4';\n\n            // Fill in random data. At i==19 set the high bits of clock sequence\n            // as\n            // per rfc4122, sec. 4.1.5\n            for (i = 0; i < 36; i++) {\n                if (!uuid[i]) {\n                    r = 0 | Math.random() * 16;\n                    uuid[i] = chars[i == 19 ? r & 0x3 | 0x8 : r];\n                }\n            }\n        }\n\n        return uuid.join('');\n    };\n\n    // A more performant, but slightly bulkier, RFC4122v4 solution. We boost\n    // performance\n    // by minimizing calls to random()\n    Math.uuidFast = function () {\n        var chars = CHARS,\n            uuid = new Array(36),\n            rnd = 0,\n            r;\n        for (var i = 0; i < 36; i++) {\n            if (i == 8 || i == 13 || i == 18 || i == 23) {\n                uuid[i] = '-';\n            } else if (i == 14) {\n                uuid[i] = '4';\n            } else {\n                if (rnd <= 0x02) rnd = 0x2000000 + Math.random() * 0x1000000 | 0;\n                r = rnd & 0xf;\n                rnd = rnd >> 4;\n                uuid[i] = chars[i == 19 ? r & 0x3 | 0x8 : r];\n            }\n        }\n        return uuid.join('');\n    };\n\n    // A more compact, but less performant, RFC4122v4 solution:\n    Math.uuidCompact = function () {\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n            var r = Math.random() * 16 | 0,\n                v = c == 'x' ? r : r & 0x3 | 0x8;\n            return v.toString(16);\n        });\n    };\n})();\n\n/**\r\n * Util\r\n *\r\n * @constructor\r\n */\nfunction Util() {}\n\n/**\r\n * Function Logger\r\n *\r\n * @constructor\r\n */\nvar Logger = function Logger() {\n    var self = this;\n\n    var LogLevel = {\n        TRACE: 0,\n        DEBUG: 1,\n        INFO: 2,\n        WARN: 3,\n        ERROR: 4,\n        FATAL: 5\n    };\n\n    var LogLevelName = ['TRACE', 'DEBUG', 'INFO', 'WARN', 'ERROR', 'FATAL'];\n\n    this.log = function () {\n        var level = arguments[0];\n\n        level = arguments[0] = '[' + LogLevelName[level] + '] ';\n\n        var text = arguments[1];\n\n        if (WebIM && WebIM.config && WebIM.config.isDebug) {\n            console.log.apply(console, arguments);\n        }\n    };\n\n    function callLog(level, args) {\n        var _args = [];\n\n        _args.push(level);\n\n        for (var i in args) {\n            _args.push(args[i]);\n        }\n\n        self.log.apply(self, _args);\n    };\n\n    this.trace = function () {\n        this.log && callLog(LogLevel.TRACE, arguments);\n    };\n\n    this.debug = function () {\n        this.log && callLog(LogLevel.DEBUG, arguments);\n    };\n\n    this.info = function () {\n        this.log && callLog(LogLevel.INFO, arguments);\n    };\n\n    this.warn = function () {\n        this.log && callLog(LogLevel.WARN, arguments);\n    };\n\n    this.error = function () {\n        this.log && callLog(LogLevel.ERROR, arguments);\n    };\n\n    this.fatal = function () {\n        this.log && callLog(LogLevel.FATAL, arguments);\n    };\n};\n\nUtil.prototype.logger = new Logger();\n\n/**\r\n * parse json\r\n *\r\n * @param jsonString\r\n */\nUtil.prototype.parseJSON = function (jsonString) {\n    return JSON.parse(jsonString);\n};\n\n/**\r\n * json to string\r\n *\r\n * @type {Util.stringifyJSON}\r\n */\nvar stringifyJSON = Util.prototype.stringifyJSON = function (jsonObj) {\n    return JSON.stringify(jsonObj);\n};\n\nvar class2type = {};\n\nvar toString = class2type.toString;\n\nvar hasOwn = class2type.hasOwnProperty;\n\nvar fnToString = hasOwn.toString;\n\nvar ObjectFunctionString = fnToString.call(Object);\n\n/**\r\n * check object type\r\n *\r\n * @type {Util.isPlainObject}\r\n */\nvar isPlainObject = Util.prototype.isPlainObject = function (obj) {\n    var proto, Ctor;\n\n    // Detect obvious negatives\n    // Use toString instead of jQuery.type to catch host objects\n    if (!obj || toString.call(obj) !== \"[object Object]\") {\n        return false;\n    }\n\n    proto = Object.getPrototypeOf(obj);\n\n    // Objects with no prototype (e.g., `Object.create( null )`) are plain\n    if (!proto) {\n        return true;\n    }\n\n    // Objects with prototype are plain iff they were constructed by a\n    // global Object function\n    Ctor = hasOwn.call(proto, \"constructor\") && proto.constructor;\n    return typeof Ctor === \"function\" && fnToString.call(Ctor) === ObjectFunctionString;\n};\n\nUtil.prototype.isArray = Array.isArray;\n\n/**\r\n * check empty object\r\n *\r\n * @param obj\r\n * @returns {boolean}\r\n */\nUtil.prototype.isEmptyObject = function (obj) {\n    var name;\n    for (name in obj) {\n        return false;\n    }\n    return true;\n};\n\nUtil.prototype.type = function (obj) {\n    if (obj == null) {\n        return obj + \"\";\n    }\n    return (typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) === \"object\" || typeof obj === \"function\" ? class2type[toString.call(obj)] || \"object\" : typeof obj === 'undefined' ? 'undefined' : _typeof(obj);\n};\n\n/**\r\n * Function extend\r\n *\r\n * @returns {*|{}}\r\n */\nUtil.prototype.extend = function () {\n    var self = this;\n    var options,\n        name,\n        src,\n        copy,\n        copyIsArray,\n        clone,\n        target = arguments[0] || {},\n        i = 1,\n        length = arguments.length,\n        deep = false;\n\n    // Handle a deep copy situation\n    if (typeof target === \"boolean\") {\n        deep = target;\n\n        // Skip the boolean and the target\n        target = arguments[i] || {};\n        i++;\n    }\n\n    // Handle case when target is a string or something (possible in deep\n    // copy)\n    if ((typeof target === 'undefined' ? 'undefined' : _typeof(target)) !== \"object\" && !self.isFunction(target)) {\n        target = {};\n    }\n\n    // Extend self itself if only one argument is passed\n    if (i === length) {\n        target = this;\n        i--;\n    }\n\n    for (; i < length; i++) {\n\n        // Only deal with non-null/undefined values\n        if ((options = arguments[i]) != null) {\n\n            // Extend the base object\n            for (name in options) {\n                src = target[name];\n                copy = options[name];\n\n                // Prevent never-ending loop\n                if (target === copy) {\n                    continue;\n                }\n\n                // Recurse if we're merging plain objects or arrays\n                if (deep && copy && (self.isPlainObject(copy) || (copyIsArray = self.isArray(copy)))) {\n\n                    if (copyIsArray) {\n                        copyIsArray = false;\n                        clone = src && self.isArray(src) ? src : [];\n                    } else {\n                        clone = src && self.isPlainObject(src) ? src : {};\n                    }\n\n                    // Never move original objects, clone them\n                    target[name] = self.extend(deep, clone, copy);\n\n                    // Don't bring in undefined values\n                } else if (copy !== undefined) {\n                    target[name] = copy;\n                }\n            }\n        }\n    }\n\n    // Return the modified object\n    return target;\n};\n\n/**\r\n * get local cache\r\n *\r\n * @memberOf tool\r\n * @name hasLocalData\r\n * @param key{string}\r\n *            localStorage的key值\r\n * @return boolean\r\n */\nUtil.prototype.hasLocalStorage = function (key) {\n    // null -> localStorage.removeItem时\n    // '{}' -> collection.models.destroy时\n    if (localStorage.getItem(key) == null || localStorage.getItem(key) == '{}') {\n        return false;\n    }\n    return true;\n};\n\nUtil.prototype.toggleClass = function (node, className) {\n    if (node.hasClass(className)) {\n        node.removeClass(className);\n        return;\n    }\n    node.addClass(className);\n};\n\n/**\r\n * set cookie\r\n *\r\n * @param name{String}\r\n *\r\n * @param value{String}\r\n *\r\n * @param hour{Number}\r\n *\r\n * @return void\r\n */\nUtil.prototype.setCookie = function (name, value, hour) {\n    var exp = new Date();\n    exp.setTime(exp.getTime() + hour * 60 * 60 * 1000);\n    document.cookie = name + \"=\" + escape(value) + \";expires=\" + exp.toGMTString();\n};\n\n/**\r\n * read cookie\r\n *\r\n * @param name(String)\r\n *            cookie key\r\n * @return cookie value\r\n * @memberOf Tool\r\n */\nUtil.prototype.getCookie = function (name) {\n    var arr = document.cookie.match(new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\"));\n    if (arr != null) {\n        return unescape(arr[2]);\n    }\n    return null;\n};\n\n/**\r\n * query parameter from url\r\n *\r\n * @name parseURL\r\n * @memberof C.Tools\r\n * @param {string}\r\n *\r\n * @return {string}\r\n * @type function\r\n * @public\r\n */\nUtil.prototype.parseURL = function (name) {\n    var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n    var r = window.location.search.substr(1).match(reg);\n    if (r != null) {\n        return unescape(r[2]);\n    }\n    return null;\n};\n\nmodule.exports = new Util();\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnJ0Yy9zcmMvY29tcG9uZW50cy91dGlscy5qcz8wOTNmIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqICEgTWF0aC51dWlkLmpzICh2MS40KSBodHRwOi8vd3d3LmJyb29mYS5jb20gbWFpbHRvOnJvYmVydEBicm9vZmEuY29tXHJcbiAqIFxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTAgUm9iZXJ0IEtpZWZmZXIgRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUExcclxuICogbGljZW5zZXMuXHJcbiAqL1xyXG5cclxuLypcclxuICogR2VuZXJhdGUgYSByYW5kb20gdXVpZC5cclxuICogXHJcbiAqIFVTQUdFOiBNYXRoLnV1aWQobGVuZ3RoLCByYWRpeCkgbGVuZ3RoIC0gdGhlIGRlc2lyZWQgbnVtYmVyIG9mIGNoYXJhY3RlcnNcclxuICogcmFkaXggLSB0aGUgbnVtYmVyIG9mIGFsbG93YWJsZSB2YWx1ZXMgZm9yIGVhY2ggY2hhcmFjdGVyLlxyXG4gKiBcclxuICogRVhBTVBMRVM6IC8vIE5vIGFyZ3VtZW50cyAtIHJldHVybnMgUkZDNDEyMiwgdmVyc2lvbiA0IElEID4+PiBNYXRoLnV1aWQoKVxyXG4gKiBcIjkyMzI5RDM5LTZGNUMtNDUyMC1BQkZDLUFBQjY0NTQ0RTE3MlwiIC8vIE9uZSBhcmd1bWVudCAtIHJldHVybnMgSUQgb2YgdGhlXHJcbiAqIHNwZWNpZmllZCBsZW5ndGggPj4+IE1hdGgudXVpZCgxNSkgLy8gMTUgY2hhcmFjdGVyIElEIChkZWZhdWx0IGJhc2U9NjIpXHJcbiAqIFwiVmN5ZHhnbHR4clZaU1RWXCIgLy8gVHdvIGFyZ3VtZW50cyAtIHJldHVybnMgSUQgb2YgdGhlIHNwZWNpZmllZCBsZW5ndGgsIGFuZFxyXG4gKiByYWRpeC4gKFJhZGl4IG11c3QgYmUgPD0gNjIpID4+PiBNYXRoLnV1aWQoOCwgMikgLy8gOCBjaGFyYWN0ZXIgSUQgKGJhc2U9MilcclxuICogXCIwMTAwMTAxMFwiID4+PiBNYXRoLnV1aWQoOCwgMTApIC8vIDggY2hhcmFjdGVyIElEIChiYXNlPTEwKSBcIjQ3NDczMDQ2XCIgPj4+XHJcbiAqIE1hdGgudXVpZCg4LCAxNikgLy8gOCBjaGFyYWN0ZXIgSUQgKGJhc2U9MTYpIFwiMDk4RjREMzVcIlxyXG4gKi9cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIC8vIFByaXZhdGUgYXJyYXkgb2YgY2hhcnMgdG8gdXNlXHJcbiAgICB2YXIgQ0hBUlMgPSAnMDEyMzQ1Njc4OUFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonLnNwbGl0KCcnKTtcclxuXHJcbiAgICBNYXRoLnV1aWQgPSBmdW5jdGlvbiAobGVuLCByYWRpeCkge1xyXG4gICAgICAgIHZhciBjaGFycyA9IENIQVJTLCB1dWlkID0gW10sIGk7XHJcbiAgICAgICAgcmFkaXggPSByYWRpeCB8fCBjaGFycy5sZW5ndGg7XHJcblxyXG4gICAgICAgIGlmIChsZW4pIHtcclxuICAgICAgICAgICAgLy8gQ29tcGFjdCBmb3JtXHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgdXVpZFtpXSA9IGNoYXJzWzAgfCBNYXRoLnJhbmRvbSgpICogcmFkaXhdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIHJmYzQxMjIsIHZlcnNpb24gNCBmb3JtXHJcbiAgICAgICAgICAgIHZhciByO1xyXG5cclxuICAgICAgICAgICAgLy8gcmZjNDEyMiByZXF1aXJlcyB0aGVzZSBjaGFyYWN0ZXJzXHJcbiAgICAgICAgICAgIHV1aWRbOF0gPSB1dWlkWzEzXSA9IHV1aWRbMThdID0gdXVpZFsyM10gPSAnLSc7XHJcbiAgICAgICAgICAgIHV1aWRbMTRdID0gJzQnO1xyXG5cclxuICAgICAgICAgICAgLy8gRmlsbCBpbiByYW5kb20gZGF0YS4gQXQgaT09MTkgc2V0IHRoZSBoaWdoIGJpdHMgb2YgY2xvY2sgc2VxdWVuY2VcclxuICAgICAgICAgICAgLy8gYXNcclxuICAgICAgICAgICAgLy8gcGVyIHJmYzQxMjIsIHNlYy4gNC4xLjVcclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDM2OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICghdXVpZFtpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHIgPSAwIHwgTWF0aC5yYW5kb20oKSAqIDE2O1xyXG4gICAgICAgICAgICAgICAgICAgIHV1aWRbaV0gPSBjaGFyc1soaSA9PSAxOSkgPyAociAmIDB4MykgfCAweDggOiByXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHV1aWQuam9pbignJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEEgbW9yZSBwZXJmb3JtYW50LCBidXQgc2xpZ2h0bHkgYnVsa2llciwgUkZDNDEyMnY0IHNvbHV0aW9uLiBXZSBib29zdFxyXG4gICAgLy8gcGVyZm9ybWFuY2VcclxuICAgIC8vIGJ5IG1pbmltaXppbmcgY2FsbHMgdG8gcmFuZG9tKClcclxuICAgIE1hdGgudXVpZEZhc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGNoYXJzID0gQ0hBUlMsIHV1aWQgPSBuZXcgQXJyYXkoMzYpLCBybmQgPSAwLCByO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMzY7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoaSA9PSA4IHx8IGkgPT0gMTMgfHwgaSA9PSAxOCB8fCBpID09IDIzKSB7XHJcbiAgICAgICAgICAgICAgICB1dWlkW2ldID0gJy0nO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGkgPT0gMTQpIHtcclxuICAgICAgICAgICAgICAgIHV1aWRbaV0gPSAnNCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocm5kIDw9IDB4MDIpIHJuZCA9IDB4MjAwMDAwMCArIChNYXRoLnJhbmRvbSgpICogMHgxMDAwMDAwKSB8IDA7XHJcbiAgICAgICAgICAgICAgICByID0gcm5kICYgMHhmO1xyXG4gICAgICAgICAgICAgICAgcm5kID0gcm5kID4+IDQ7XHJcbiAgICAgICAgICAgICAgICB1dWlkW2ldID0gY2hhcnNbKGkgPT0gMTkpID8gKHIgJiAweDMpIHwgMHg4IDogcl07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHV1aWQuam9pbignJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEEgbW9yZSBjb21wYWN0LCBidXQgbGVzcyBwZXJmb3JtYW50LCBSRkM0MTIydjQgc29sdXRpb246XHJcbiAgICBNYXRoLnV1aWRDb21wYWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uIChjKSB7XHJcbiAgICAgICAgICAgIHZhciByID0gTWF0aC5yYW5kb20oKSAqIDE2IHwgMCwgdiA9IGMgPT0gJ3gnID8gciA6IChyICYgMHgzIHwgMHg4KTtcclxuICAgICAgICAgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxufSkoKTtcclxuXHJcblxyXG4vKipcclxuICogVXRpbFxyXG4gKlxyXG4gKiBAY29uc3RydWN0b3JcclxuICovXHJcbmZ1bmN0aW9uIFV0aWwoKSB7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGdW5jdGlvbiBMb2dnZXJcclxuICpcclxuICogQGNvbnN0cnVjdG9yXHJcbiAqL1xyXG52YXIgTG9nZ2VyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgIHZhciBMb2dMZXZlbCA9IHtcclxuICAgICAgICBUUkFDRTogMCxcclxuICAgICAgICBERUJVRzogMSxcclxuICAgICAgICBJTkZPOiAyLFxyXG4gICAgICAgIFdBUk46IDMsXHJcbiAgICAgICAgRVJST1I6IDQsXHJcbiAgICAgICAgRkFUQUw6IDVcclxuICAgIH1cclxuXHJcbiAgICB2YXIgTG9nTGV2ZWxOYW1lID0gW1xyXG4gICAgICAgICdUUkFDRScsXHJcbiAgICAgICAgJ0RFQlVHJyxcclxuICAgICAgICAnSU5GTycsXHJcbiAgICAgICAgJ1dBUk4nLFxyXG4gICAgICAgICdFUlJPUicsXHJcbiAgICAgICAgJ0ZBVEFMJ1xyXG4gICAgXVxyXG5cclxuICAgIHRoaXMubG9nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBsZXZlbCA9IGFyZ3VtZW50c1swXTtcclxuXHJcbiAgICAgICAgbGV2ZWwgPSBhcmd1bWVudHNbMF0gPSAnWycgKyBMb2dMZXZlbE5hbWVbbGV2ZWxdICsgJ10gJztcclxuXHJcbiAgICAgICAgdmFyIHRleHQgPSBhcmd1bWVudHNbMV07XHJcblxyXG4gICAgICAgIGlmIChXZWJJTSAmJiBXZWJJTS5jb25maWcgJiYgV2ViSU0uY29uZmlnLmlzRGVidWcpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBjYWxsTG9nKGxldmVsLCBhcmdzKSB7XHJcbiAgICAgICAgdmFyIF9hcmdzID0gW107XHJcblxyXG4gICAgICAgIF9hcmdzLnB1c2gobGV2ZWwpO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpIGluIGFyZ3MpIHtcclxuICAgICAgICAgICAgX2FyZ3MucHVzaChhcmdzW2ldKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNlbGYubG9nLmFwcGx5KHNlbGYsIF9hcmdzKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy50cmFjZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmxvZyAmJiBjYWxsTG9nKExvZ0xldmVsLlRSQUNFLCBhcmd1bWVudHMpXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZGVidWcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5sb2cgJiYgY2FsbExvZyhMb2dMZXZlbC5ERUJVRywgYXJndW1lbnRzKVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmluZm8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5sb2cgJiYgY2FsbExvZyhMb2dMZXZlbC5JTkZPLCBhcmd1bWVudHMpXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMud2FybiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmxvZyAmJiBjYWxsTG9nKExvZ0xldmVsLldBUk4sIGFyZ3VtZW50cylcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5lcnJvciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmxvZyAmJiBjYWxsTG9nKExvZ0xldmVsLkVSUk9SLCBhcmd1bWVudHMpXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZmF0YWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5sb2cgJiYgY2FsbExvZyhMb2dMZXZlbC5GQVRBTCwgYXJndW1lbnRzKVxyXG4gICAgfTtcclxufVxyXG5cclxuVXRpbC5wcm90b3R5cGUubG9nZ2VyID0gbmV3IExvZ2dlcigpO1xyXG5cclxuLyoqXHJcbiAqIHBhcnNlIGpzb25cclxuICpcclxuICogQHBhcmFtIGpzb25TdHJpbmdcclxuICovXHJcblV0aWwucHJvdG90eXBlLnBhcnNlSlNPTiA9IGZ1bmN0aW9uIChqc29uU3RyaW5nKSB7XHJcbiAgICByZXR1cm4gSlNPTi5wYXJzZShqc29uU3RyaW5nKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBqc29uIHRvIHN0cmluZ1xyXG4gKlxyXG4gKiBAdHlwZSB7VXRpbC5zdHJpbmdpZnlKU09OfVxyXG4gKi9cclxudmFyIHN0cmluZ2lmeUpTT04gPSBVdGlsLnByb3RvdHlwZS5zdHJpbmdpZnlKU09OID0gZnVuY3Rpb24gKGpzb25PYmopIHtcclxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShqc29uT2JqKTtcclxufTtcclxuXHJcblxyXG52YXIgY2xhc3MydHlwZSA9IHt9O1xyXG5cclxudmFyIHRvU3RyaW5nID0gY2xhc3MydHlwZS50b1N0cmluZztcclxuXHJcbnZhciBoYXNPd24gPSBjbGFzczJ0eXBlLmhhc093blByb3BlcnR5O1xyXG5cclxudmFyIGZuVG9TdHJpbmcgPSBoYXNPd24udG9TdHJpbmc7XHJcblxyXG52YXIgT2JqZWN0RnVuY3Rpb25TdHJpbmcgPSBmblRvU3RyaW5nLmNhbGwoT2JqZWN0KTtcclxuXHJcbi8qKlxyXG4gKiBjaGVjayBvYmplY3QgdHlwZVxyXG4gKlxyXG4gKiBAdHlwZSB7VXRpbC5pc1BsYWluT2JqZWN0fVxyXG4gKi9cclxudmFyIGlzUGxhaW5PYmplY3QgPSBVdGlsLnByb3RvdHlwZS5pc1BsYWluT2JqZWN0ID0gZnVuY3Rpb24gKG9iaikge1xyXG4gICAgdmFyIHByb3RvLCBDdG9yO1xyXG5cclxuICAgIC8vIERldGVjdCBvYnZpb3VzIG5lZ2F0aXZlc1xyXG4gICAgLy8gVXNlIHRvU3RyaW5nIGluc3RlYWQgb2YgalF1ZXJ5LnR5cGUgdG8gY2F0Y2ggaG9zdCBvYmplY3RzXHJcbiAgICBpZiAoIW9iaiB8fCB0b1N0cmluZy5jYWxsKG9iaikgIT09IFwiW29iamVjdCBPYmplY3RdXCIpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKTtcclxuXHJcbiAgICAvLyBPYmplY3RzIHdpdGggbm8gcHJvdG90eXBlIChlLmcuLCBgT2JqZWN0LmNyZWF0ZSggbnVsbCApYCkgYXJlIHBsYWluXHJcbiAgICBpZiAoIXByb3RvKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT2JqZWN0cyB3aXRoIHByb3RvdHlwZSBhcmUgcGxhaW4gaWZmIHRoZXkgd2VyZSBjb25zdHJ1Y3RlZCBieSBhXHJcbiAgICAvLyBnbG9iYWwgT2JqZWN0IGZ1bmN0aW9uXHJcbiAgICBDdG9yID0gaGFzT3duLmNhbGwocHJvdG8sIFwiY29uc3RydWN0b3JcIikgJiYgcHJvdG8uY29uc3RydWN0b3I7XHJcbiAgICByZXR1cm4gdHlwZW9mIEN0b3IgPT09IFwiZnVuY3Rpb25cIiAmJiBmblRvU3RyaW5nLmNhbGwoQ3RvcikgPT09IE9iamVjdEZ1bmN0aW9uU3RyaW5nO1xyXG59O1xyXG5cclxuVXRpbC5wcm90b3R5cGUuaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7XHJcblxyXG4vKipcclxuICogY2hlY2sgZW1wdHkgb2JqZWN0XHJcbiAqXHJcbiAqIEBwYXJhbSBvYmpcclxuICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAqL1xyXG5VdGlsLnByb3RvdHlwZS5pc0VtcHR5T2JqZWN0ID0gZnVuY3Rpb24gKG9iaikge1xyXG4gICAgdmFyIG5hbWU7XHJcbiAgICBmb3IgKG5hbWUgaW4gb2JqKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn07XHJcblxyXG5VdGlsLnByb3RvdHlwZS50eXBlID0gZnVuY3Rpb24gKG9iaikge1xyXG4gICAgaWYgKG9iaiA9PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIG9iaiArIFwiXCI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gXCJvYmplY3RcIiB8fCB0eXBlb2Ygb2JqID09PSBcImZ1bmN0aW9uXCIgPyBjbGFzczJ0eXBlW3RvU3RyaW5nLmNhbGwob2JqKV0gfHwgXCJvYmplY3RcIiA6IHR5cGVvZiBvYmo7XHJcbn07XHJcblxyXG4vKipcclxuICogRnVuY3Rpb24gZXh0ZW5kXHJcbiAqXHJcbiAqIEByZXR1cm5zIHsqfHt9fVxyXG4gKi9cclxuVXRpbC5wcm90b3R5cGUuZXh0ZW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgdmFyIG9wdGlvbnMsIG5hbWUsIHNyYywgY29weSwgY29weUlzQXJyYXksIGNsb25lLFxyXG4gICAgICAgIHRhcmdldCA9IGFyZ3VtZW50c1swXSB8fCB7fSxcclxuICAgICAgICBpID0gMSxcclxuICAgICAgICBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLFxyXG4gICAgICAgIGRlZXAgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBIYW5kbGUgYSBkZWVwIGNvcHkgc2l0dWF0aW9uXHJcbiAgICBpZiAodHlwZW9mIHRhcmdldCA9PT0gXCJib29sZWFuXCIpIHtcclxuICAgICAgICBkZWVwID0gdGFyZ2V0O1xyXG5cclxuICAgICAgICAvLyBTa2lwIHRoZSBib29sZWFuIGFuZCB0aGUgdGFyZ2V0XHJcbiAgICAgICAgdGFyZ2V0ID0gYXJndW1lbnRzW2ldIHx8IHt9O1xyXG4gICAgICAgIGkrKztcclxuICAgIH1cclxuXHJcbiAgICAvLyBIYW5kbGUgY2FzZSB3aGVuIHRhcmdldCBpcyBhIHN0cmluZyBvciBzb21ldGhpbmcgKHBvc3NpYmxlIGluIGRlZXBcclxuICAgIC8vIGNvcHkpXHJcbiAgICBpZiAodHlwZW9mIHRhcmdldCAhPT0gXCJvYmplY3RcIiAmJiAhc2VsZi5pc0Z1bmN0aW9uKHRhcmdldCkpIHtcclxuICAgICAgICB0YXJnZXQgPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBFeHRlbmQgc2VsZiBpdHNlbGYgaWYgb25seSBvbmUgYXJndW1lbnQgaXMgcGFzc2VkXHJcbiAgICBpZiAoaSA9PT0gbGVuZ3RoKSB7XHJcbiAgICAgICAgdGFyZ2V0ID0gdGhpcztcclxuICAgICAgICBpLS07XHJcbiAgICB9XHJcblxyXG4gICAgZm9yICg7IGkgPCBsZW5ndGg7IGkrKykge1xyXG5cclxuICAgICAgICAvLyBPbmx5IGRlYWwgd2l0aCBub24tbnVsbC91bmRlZmluZWQgdmFsdWVzXHJcbiAgICAgICAgaWYgKCggb3B0aW9ucyA9IGFyZ3VtZW50c1tpXSApICE9IG51bGwpIHtcclxuXHJcbiAgICAgICAgICAgIC8vIEV4dGVuZCB0aGUgYmFzZSBvYmplY3RcclxuICAgICAgICAgICAgZm9yIChuYW1lIGluIG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIHNyYyA9IHRhcmdldFtuYW1lXTtcclxuICAgICAgICAgICAgICAgIGNvcHkgPSBvcHRpb25zW25hbWVdO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFByZXZlbnQgbmV2ZXItZW5kaW5nIGxvb3BcclxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgPT09IGNvcHkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBSZWN1cnNlIGlmIHdlJ3JlIG1lcmdpbmcgcGxhaW4gb2JqZWN0cyBvciBhcnJheXNcclxuICAgICAgICAgICAgICAgIGlmIChkZWVwICYmIGNvcHkgJiYgKCBzZWxmLmlzUGxhaW5PYmplY3QoY29weSkgfHxcclxuICAgICAgICAgICAgICAgICAgICAoIGNvcHlJc0FycmF5ID0gc2VsZi5pc0FycmF5KGNvcHkpICkgKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29weUlzQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29weUlzQXJyYXkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvbmUgPSBzcmMgJiYgc2VsZi5pc0FycmF5KHNyYykgPyBzcmMgOiBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvbmUgPSBzcmMgJiYgc2VsZi5pc1BsYWluT2JqZWN0KHNyYykgPyBzcmMgOiB7fTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIE5ldmVyIG1vdmUgb3JpZ2luYWwgb2JqZWN0cywgY2xvbmUgdGhlbVxyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFtuYW1lXSA9IHNlbGYuZXh0ZW5kKGRlZXAsIGNsb25lLCBjb3B5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgYnJpbmcgaW4gdW5kZWZpbmVkIHZhbHVlc1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb3B5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRbbmFtZV0gPSBjb3B5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFJldHVybiB0aGUgbW9kaWZpZWQgb2JqZWN0XHJcbiAgICByZXR1cm4gdGFyZ2V0O1xyXG59XHJcblxyXG4vKipcclxuICogZ2V0IGxvY2FsIGNhY2hlXHJcbiAqXHJcbiAqIEBtZW1iZXJPZiB0b29sXHJcbiAqIEBuYW1lIGhhc0xvY2FsRGF0YVxyXG4gKiBAcGFyYW0ga2V5e3N0cmluZ31cclxuICogICAgICAgICAgICBsb2NhbFN0b3JhZ2XnmoRrZXnlgLxcclxuICogQHJldHVybiBib29sZWFuXHJcbiAqL1xyXG5VdGlsLnByb3RvdHlwZS5oYXNMb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAvLyBudWxsIC0+IGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVt5pe2XHJcbiAgICAvLyAne30nIC0+IGNvbGxlY3Rpb24ubW9kZWxzLmRlc3Ryb3nml7ZcclxuICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpID09IG51bGwgfHwgbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KSA9PSAne30nKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcblV0aWwucHJvdG90eXBlLnRvZ2dsZUNsYXNzID0gZnVuY3Rpb24gKG5vZGUsIGNsYXNzTmFtZSkge1xyXG4gICAgaWYgKG5vZGUuaGFzQ2xhc3MoY2xhc3NOYW1lKSkge1xyXG4gICAgICAgIG5vZGUucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBub2RlLmFkZENsYXNzKGNsYXNzTmFtZSk7XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogc2V0IGNvb2tpZVxyXG4gKlxyXG4gKiBAcGFyYW0gbmFtZXtTdHJpbmd9XHJcbiAqXHJcbiAqIEBwYXJhbSB2YWx1ZXtTdHJpbmd9XHJcbiAqXHJcbiAqIEBwYXJhbSBob3Vye051bWJlcn1cclxuICpcclxuICogQHJldHVybiB2b2lkXHJcbiAqL1xyXG5VdGlsLnByb3RvdHlwZS5zZXRDb29raWUgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUsIGhvdXIpIHtcclxuICAgIHZhciBleHAgPSBuZXcgRGF0ZSgpO1xyXG4gICAgZXhwLnNldFRpbWUoZXhwLmdldFRpbWUoKSArIGhvdXIgKiA2MCAqIDYwICogMTAwMCk7XHJcbiAgICBkb2N1bWVudC5jb29raWUgPSBuYW1lICsgXCI9XCIgKyBlc2NhcGUodmFsdWUpICsgXCI7ZXhwaXJlcz1cIiArIGV4cC50b0dNVFN0cmluZygpO1xyXG59XHJcblxyXG4vKipcclxuICogcmVhZCBjb29raWVcclxuICpcclxuICogQHBhcmFtIG5hbWUoU3RyaW5nKVxyXG4gKiAgICAgICAgICAgIGNvb2tpZSBrZXlcclxuICogQHJldHVybiBjb29raWUgdmFsdWVcclxuICogQG1lbWJlck9mIFRvb2xcclxuICovXHJcblV0aWwucHJvdG90eXBlLmdldENvb2tpZSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICB2YXIgYXJyID0gZG9jdW1lbnQuY29va2llLm1hdGNoKG5ldyBSZWdFeHAoXCIoXnwgKVwiICsgbmFtZSArIFwiPShbXjtdKikoO3wkKVwiKSk7XHJcbiAgICBpZiAoYXJyICE9IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gdW5lc2NhcGUoYXJyWzJdKTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG59XHJcblxyXG5cclxuLyoqXHJcbiAqIHF1ZXJ5IHBhcmFtZXRlciBmcm9tIHVybFxyXG4gKlxyXG4gKiBAbmFtZSBwYXJzZVVSTFxyXG4gKiBAbWVtYmVyb2YgQy5Ub29sc1xyXG4gKiBAcGFyYW0ge3N0cmluZ31cclxuICpcclxuICogQHJldHVybiB7c3RyaW5nfVxyXG4gKiBAdHlwZSBmdW5jdGlvblxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5VdGlsLnByb3RvdHlwZS5wYXJzZVVSTCA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICB2YXIgcmVnID0gbmV3IFJlZ0V4cChcIihefCYpXCIgKyBuYW1lICsgXCI9KFteJl0qKSgmfCQpXCIsIFwiaVwiKTtcclxuICAgIHZhciByID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHIoMSkubWF0Y2gocmVnKTtcclxuICAgIGlmIChyICE9IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gdW5lc2NhcGUoclsyXSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBuZXcgVXRpbCgpO1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicnRjL3NyYy9jb21wb25lbnRzL3V0aWxzLmpzIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7Ozs7Ozs7QUFPQTs7Ozs7Ozs7Ozs7Ozs7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7OztBQUtBO0FBQ0E7QUFFQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFRQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7Ozs7OztBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7Ozs7Ozs7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ 253:
/***/ (function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar Util = __webpack_require__(252);\nvar RTCIQHandler = __webpack_require__(254);\nvar API = __webpack_require__(255);\nvar WebRTC = __webpack_require__(256);\nvar CommonPattern = __webpack_require__(257);\n\nvar RouteTo = API.RouteTo;\nvar Api = API.Api;\nvar _logger = Util.logger;\n\nvar _Call = {\n    api: null,\n    caller: '',\n    connection: null,\n\n    pattern: null,\n\n    listener: {\n        onAcceptCall: function onAcceptCall(from, options) {},\n\n        onRinging: function onRinging(caller) {},\n\n        onTermCall: function onTermCall() {},\n\n        onIceConnectionStateChange: function onIceConnectionStateChange(iceState) {}\n    },\n\n    mediaStreamConstaints: {\n        audio: true,\n        video: true\n    },\n\n    init: function init() {\n        var self = this;\n\n        if (typeof self.connection === \"undefined\") {\n            throw \"Caller need a instance of Easemob.im.Connection\";\n        }\n\n        self.api = self.api || new Api({\n            imConnection: self.connection,\n\n            rtcHandler: new RTCIQHandler({\n                imConnection: self.connection\n            })\n        });\n\n        self.api.onInitC = function () {\n            self._onInitC.apply(self, arguments);\n        }, self.api.onIceConnectionStateChange = function () {\n            self.listener.onIceConnectionStateChange.apply(self, arguments);\n        };\n    },\n\n    makeVideoCall: function makeVideoCall(callee, accessSid) {\n        var self = this;\n\n        var mediaStreamConstaints = {};\n        Util.extend(mediaStreamConstaints, self.mediaStreamConstaints);\n        self.mediaStreamConstaints.video = true;\n\n        this.call(callee, mediaStreamConstaints, accessSid);\n    },\n\n    makeVoiceCall: function makeVoiceCall(callee, accessSid) {\n        console.log('ScareCrow');\n        var self = this;\n\n        var mediaStreamConstaints = {};\n        Util.extend(mediaStreamConstaints, self.mediaStreamConstaints);\n        self.mediaStreamConstaints.video = false;\n\n        self.call(callee, mediaStreamConstaints, accessSid);\n    },\n\n    acceptCall: function acceptCall() {\n        var self = this;\n        self.pattern.accept();\n    },\n\n    endCall: function endCall(callee) {\n        var self = this;\n        self.caller = '';\n        self.pattern.termCall();\n    },\n\n    call: function call(callee, mediaStreamConstaints, accessSid) {\n        var self = this;\n        this.callee = this.api.jid(callee);\n\n        var rt = new RouteTo({\n            rtKey: \"\",\n            sid: accessSid,\n\n            success: function success(result) {\n                _logger.debug(\"iq to server success\", result);\n            },\n            fail: function fail(error) {\n                _logger.debug(\"iq to server error\", error);\n                self.onError(error);\n            }\n        });\n\n        this.api.reqP2P(rt, mediaStreamConstaints.video ? 1 : 0, mediaStreamConstaints.audio ? 1 : 0, this.api.jid(callee), function (from, rtcOptions) {\n            if (rtcOptions.online == \"0\") {\n                self.listener.onError({ message: \"callee is not online!\" });\n                return;\n            }\n            self._onGotServerP2PConfig(from, rtcOptions);\n            self.pattern.initC(self.mediaStreamConstaints, accessSid);\n        });\n    },\n\n    _onInitC: function _onInitC(from, options, rtkey, tsxId, fromSid) {\n        var self = this;\n\n        self.callee = from;\n        self._rtcCfg = options.rtcCfg;\n        self._WebRTCCfg = options.WebRTC;\n\n        self.sessId = options.sessId;\n        self.rtcId = options.rtcId;\n\n        self.switchPattern(options.streamType == \"VIDEO\" ? \"VIDEO\" : \"VOICE\");\n        self.pattern._onInitC(from, options, rtkey, tsxId, fromSid);\n    },\n\n    _onGotServerP2PConfig: function _onGotServerP2PConfig(from, rtcOptions) {\n        var self = this;\n\n        if (rtcOptions.result == 0) {\n            self._p2pConfig = rtcOptions;\n            self._rtcCfg = rtcOptions.rtcCfg;\n            self._rtcCfg2 = rtcOptions.rtcCfg2;\n\n            self.sessId = rtcOptions.sessId;\n            self.rtcId = \"Channel_webIM\";\n\n            self._rtKey = self._rtkey = rtcOptions.rtKey || rtcOptions.rtkey;\n            self._rtFlag = self._rtflag = rtcOptions.rtFlag || rtcOptions.rtflag;\n\n            self._WebRTCCfg = rtcOptions.WebRTC;\n            self.admtok = rtcOptions.admtok;\n            self.tkt = rtcOptions.tkt;\n\n            self.switchPattern(self.mediaStreamConstaints.audio && self.mediaStreamConstaints.video ? \"VIDEO\" : \"VOICE\");\n        } else {\n            //\n        }\n    },\n\n    switchPattern: function switchPattern(streamType) {\n        var self = this;\n\n        !self._WebRTCCfg && (self.pattern = new CommonPattern({\n            callee: self.callee,\n\n            _p2pConfig: self._p2pConfig,\n            _rtcCfg: self._rtcCfg,\n            _rtcCfg2: self._rtcCfg2,\n\n            _rtKey: self._rtKey || self._rtkey,\n            _rtFlag: self._rtFlag || self._rtflag,\n\n            _sessId: self.sessId,\n            _rtcId: self.rtcId,\n\n            webRtc: new WebRTC({\n                streamType: streamType,\n                onGotLocalStream: self.listener.onGotLocalStream,\n                onGotRemoteStream: self.listener.onGotRemoteStream,\n                onError: self.listener.onError\n            }),\n\n            api: self.api,\n\n            onAcceptCall: self.listener && self.listener.onAcceptCall || function () {},\n            onRinging: self.listener && self.listener.onRinging || function () {},\n            onTermCall: self.listener && self.listener.onTermCall || function () {},\n            onOtherUserOpenVoice: self.listener && self.listener.onOtherUserOpenVoice || function () {},\n            onOtherUserOpenVideo: self.listener && self.listener.onOtherUserOpenVideo || function () {}\n        }));\n    }\n};\n\nmodule.exports = function (initConfigs) {\n    Util.extend(true, this, _Call, initConfigs || {});\n\n    this.init();\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnJ0Yy9zcmMvY29tcG9uZW50cy9jYWxsLmpzPzlmY2UiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIFV0aWwgPSByZXF1aXJlKCcuL3V0aWxzJyk7XHJcbnZhciBSVENJUUhhbmRsZXIgPSByZXF1aXJlKCcuL2lxJyk7XHJcbnZhciBBUEkgPSByZXF1aXJlKCcuL2FwaScpO1xyXG52YXIgV2ViUlRDID0gcmVxdWlyZSgnLi93ZWJydGMnKTtcclxudmFyIENvbW1vblBhdHRlcm4gPSByZXF1aXJlKCcuL3AycCcpO1xyXG5cclxudmFyIFJvdXRlVG8gPSBBUEkuUm91dGVUbztcclxudmFyIEFwaSA9IEFQSS5BcGk7XHJcbnZhciBfbG9nZ2VyID0gVXRpbC5sb2dnZXI7XHJcblxyXG5cclxudmFyIF9DYWxsID0ge1xyXG4gICAgYXBpOiBudWxsLFxyXG4gICAgY2FsbGVyOiAnJyxcclxuICAgIGNvbm5lY3Rpb246IG51bGwsXHJcblxyXG4gICAgcGF0dGVybjogbnVsbCxcclxuXHJcbiAgICBsaXN0ZW5lcjoge1xyXG4gICAgICAgIG9uQWNjZXB0Q2FsbDogZnVuY3Rpb24gKGZyb20sIG9wdGlvbnMpIHtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBvblJpbmdpbmc6IGZ1bmN0aW9uIChjYWxsZXIpIHtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBvblRlcm1DYWxsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgb25JY2VDb25uZWN0aW9uU3RhdGVDaGFuZ2U6IGZ1bmN0aW9uIChpY2VTdGF0ZSkge1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgbWVkaWFTdHJlYW1Db25zdGFpbnRzOiB7XHJcbiAgICAgICAgYXVkaW86IHRydWUsXHJcbiAgICAgICAgdmlkZW86IHRydWVcclxuICAgIH0sXHJcblxyXG4gICAgaW5pdDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBzZWxmLmNvbm5lY3Rpb24gPT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgdGhyb3cgXCJDYWxsZXIgbmVlZCBhIGluc3RhbmNlIG9mIEVhc2Vtb2IuaW0uQ29ubmVjdGlvblwiXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZWxmLmFwaSA9IHNlbGYuYXBpIHx8IG5ldyBBcGkoe1xyXG4gICAgICAgICAgICAgICAgaW1Db25uZWN0aW9uOiBzZWxmLmNvbm5lY3Rpb24sXHJcblxyXG4gICAgICAgICAgICAgICAgcnRjSGFuZGxlcjogbmV3IFJUQ0lRSGFuZGxlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgaW1Db25uZWN0aW9uOiBzZWxmLmNvbm5lY3Rpb25cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzZWxmLmFwaS5vbkluaXRDID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZWxmLl9vbkluaXRDLmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgc2VsZi5hcGkub25JY2VDb25uZWN0aW9uU3RhdGVDaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlbGYubGlzdGVuZXIub25JY2VDb25uZWN0aW9uU3RhdGVDaGFuZ2UuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIG1ha2VWaWRlb0NhbGw6IGZ1bmN0aW9uIChjYWxsZWUsIGFjY2Vzc1NpZCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIG1lZGlhU3RyZWFtQ29uc3RhaW50cyA9IHt9O1xyXG4gICAgICAgIFV0aWwuZXh0ZW5kKG1lZGlhU3RyZWFtQ29uc3RhaW50cywgc2VsZi5tZWRpYVN0cmVhbUNvbnN0YWludHMpO1xyXG4gICAgICAgIHNlbGYubWVkaWFTdHJlYW1Db25zdGFpbnRzLnZpZGVvID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgdGhpcy5jYWxsKGNhbGxlZSwgbWVkaWFTdHJlYW1Db25zdGFpbnRzLCBhY2Nlc3NTaWQpO1xyXG4gICAgfSxcclxuXHJcbiAgICBtYWtlVm9pY2VDYWxsOiBmdW5jdGlvbiAoY2FsbGVlLCBhY2Nlc3NTaWQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnU2NhcmVDcm93Jyk7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgbWVkaWFTdHJlYW1Db25zdGFpbnRzID0ge307XHJcbiAgICAgICAgVXRpbC5leHRlbmQobWVkaWFTdHJlYW1Db25zdGFpbnRzLCBzZWxmLm1lZGlhU3RyZWFtQ29uc3RhaW50cyk7XHJcbiAgICAgICAgc2VsZi5tZWRpYVN0cmVhbUNvbnN0YWludHMudmlkZW8gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgc2VsZi5jYWxsKGNhbGxlZSwgbWVkaWFTdHJlYW1Db25zdGFpbnRzLCBhY2Nlc3NTaWQpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhY2NlcHRDYWxsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYucGF0dGVybi5hY2NlcHQoKTtcclxuICAgIH0sXHJcblxyXG4gICAgZW5kQ2FsbDogZnVuY3Rpb24gKGNhbGxlZSkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICBzZWxmLmNhbGxlciA9ICcnO1xyXG4gICAgICAgIHNlbGYucGF0dGVybi50ZXJtQ2FsbCgpO1xyXG4gICAgfSxcclxuXHJcbiAgICBjYWxsOiBmdW5jdGlvbiAoY2FsbGVlLCBtZWRpYVN0cmVhbUNvbnN0YWludHMsIGFjY2Vzc1NpZCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICB0aGlzLmNhbGxlZSA9IHRoaXMuYXBpLmppZChjYWxsZWUpO1xyXG5cclxuICAgICAgICB2YXIgcnQgPSBuZXcgUm91dGVUbyh7XHJcbiAgICAgICAgICAgIHJ0S2V5OiBcIlwiLFxyXG4gICAgICAgICAgICBzaWQ6IGFjY2Vzc1NpZCxcclxuXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIF9sb2dnZXIuZGVidWcoXCJpcSB0byBzZXJ2ZXIgc3VjY2Vzc1wiLCByZXN1bHQpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmYWlsOiBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIF9sb2dnZXIuZGVidWcoXCJpcSB0byBzZXJ2ZXIgZXJyb3JcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5vbkVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmFwaS5yZXFQMlAoXHJcbiAgICAgICAgICAgIHJ0LFxyXG4gICAgICAgICAgICBtZWRpYVN0cmVhbUNvbnN0YWludHMudmlkZW8gPyAxIDogMCxcclxuICAgICAgICAgICAgbWVkaWFTdHJlYW1Db25zdGFpbnRzLmF1ZGlvID8gMSA6IDAsXHJcbiAgICAgICAgICAgIHRoaXMuYXBpLmppZChjYWxsZWUpLFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZnJvbSwgcnRjT3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJ0Y09wdGlvbnMub25saW5lID09IFwiMFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5saXN0ZW5lci5vbkVycm9yKHttZXNzYWdlOiBcImNhbGxlZSBpcyBub3Qgb25saW5lIVwifSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2VsZi5fb25Hb3RTZXJ2ZXJQMlBDb25maWcoZnJvbSwgcnRjT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnBhdHRlcm4uaW5pdEMoc2VsZi5tZWRpYVN0cmVhbUNvbnN0YWludHMsIGFjY2Vzc1NpZCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfSxcclxuXHJcbiAgICBfb25Jbml0QzogZnVuY3Rpb24gKGZyb20sIG9wdGlvbnMsIHJ0a2V5LCB0c3hJZCwgZnJvbVNpZCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2VsZi5jYWxsZWUgPSBmcm9tO1xyXG4gICAgICAgIHNlbGYuX3J0Y0NmZyA9IG9wdGlvbnMucnRjQ2ZnO1xyXG4gICAgICAgIHNlbGYuX1dlYlJUQ0NmZyA9IG9wdGlvbnMuV2ViUlRDO1xyXG5cclxuICAgICAgICBzZWxmLnNlc3NJZCA9IG9wdGlvbnMuc2Vzc0lkO1xyXG4gICAgICAgIHNlbGYucnRjSWQgPSBvcHRpb25zLnJ0Y0lkO1xyXG5cclxuICAgICAgICBzZWxmLnN3aXRjaFBhdHRlcm4ob3B0aW9ucy5zdHJlYW1UeXBlID09IFwiVklERU9cIiA/IFwiVklERU9cIiA6IFwiVk9JQ0VcIik7XHJcbiAgICAgICAgc2VsZi5wYXR0ZXJuLl9vbkluaXRDKGZyb20sIG9wdGlvbnMsIHJ0a2V5LCB0c3hJZCwgZnJvbVNpZCk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9vbkdvdFNlcnZlclAyUENvbmZpZzogZnVuY3Rpb24gKGZyb20sIHJ0Y09wdGlvbnMpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIGlmIChydGNPcHRpb25zLnJlc3VsdCA9PSAwKSB7XHJcbiAgICAgICAgICAgIHNlbGYuX3AycENvbmZpZyA9IHJ0Y09wdGlvbnM7XHJcbiAgICAgICAgICAgIHNlbGYuX3J0Y0NmZyA9IHJ0Y09wdGlvbnMucnRjQ2ZnO1xyXG4gICAgICAgICAgICBzZWxmLl9ydGNDZmcyID0gcnRjT3B0aW9ucy5ydGNDZmcyO1xyXG5cclxuICAgICAgICAgICAgc2VsZi5zZXNzSWQgPSBydGNPcHRpb25zLnNlc3NJZDtcclxuICAgICAgICAgICAgc2VsZi5ydGNJZCA9IFwiQ2hhbm5lbF93ZWJJTVwiO1xyXG5cclxuICAgICAgICAgICAgc2VsZi5fcnRLZXkgPSBzZWxmLl9ydGtleSA9IHJ0Y09wdGlvbnMucnRLZXkgfHwgcnRjT3B0aW9ucy5ydGtleTtcclxuICAgICAgICAgICAgc2VsZi5fcnRGbGFnID0gc2VsZi5fcnRmbGFnID0gcnRjT3B0aW9ucy5ydEZsYWcgfHwgcnRjT3B0aW9ucy5ydGZsYWc7XHJcblxyXG4gICAgICAgICAgICBzZWxmLl9XZWJSVENDZmcgPSBydGNPcHRpb25zLldlYlJUQztcclxuICAgICAgICAgICAgc2VsZi5hZG10b2sgPSBydGNPcHRpb25zLmFkbXRvaztcclxuICAgICAgICAgICAgc2VsZi50a3QgPSBydGNPcHRpb25zLnRrdDtcclxuXHJcblxyXG4gICAgICAgICAgICBzZWxmLnN3aXRjaFBhdHRlcm4oc2VsZi5tZWRpYVN0cmVhbUNvbnN0YWludHMuYXVkaW8gJiYgc2VsZi5tZWRpYVN0cmVhbUNvbnN0YWludHMudmlkZW8gPyBcIlZJREVPXCIgOiBcIlZPSUNFXCIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBzd2l0Y2hQYXR0ZXJuOiBmdW5jdGlvbiAoc3RyZWFtVHlwZSkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgKCFzZWxmLl9XZWJSVENDZmcpICYmIChzZWxmLnBhdHRlcm4gPSBuZXcgQ29tbW9uUGF0dGVybih7XHJcbiAgICAgICAgICAgIGNhbGxlZTogc2VsZi5jYWxsZWUsXHJcblxyXG4gICAgICAgICAgICBfcDJwQ29uZmlnOiBzZWxmLl9wMnBDb25maWcsXHJcbiAgICAgICAgICAgIF9ydGNDZmc6IHNlbGYuX3J0Y0NmZyxcclxuICAgICAgICAgICAgX3J0Y0NmZzI6IHNlbGYuX3J0Y0NmZzIsXHJcblxyXG4gICAgICAgICAgICBfcnRLZXk6IHNlbGYuX3J0S2V5IHx8IHNlbGYuX3J0a2V5LFxyXG4gICAgICAgICAgICBfcnRGbGFnOiBzZWxmLl9ydEZsYWcgfHwgc2VsZi5fcnRmbGFnLFxyXG5cclxuICAgICAgICAgICAgX3Nlc3NJZDogc2VsZi5zZXNzSWQsXHJcbiAgICAgICAgICAgIF9ydGNJZDogc2VsZi5ydGNJZCxcclxuXHJcbiAgICAgICAgICAgIHdlYlJ0YzogbmV3IFdlYlJUQyh7XHJcbiAgICAgICAgICAgICAgICBzdHJlYW1UeXBlOiBzdHJlYW1UeXBlLFxyXG4gICAgICAgICAgICAgICAgb25Hb3RMb2NhbFN0cmVhbTogc2VsZi5saXN0ZW5lci5vbkdvdExvY2FsU3RyZWFtLFxyXG4gICAgICAgICAgICAgICAgb25Hb3RSZW1vdGVTdHJlYW06IHNlbGYubGlzdGVuZXIub25Hb3RSZW1vdGVTdHJlYW0sXHJcbiAgICAgICAgICAgICAgICBvbkVycm9yOiBzZWxmLmxpc3RlbmVyLm9uRXJyb3JcclxuICAgICAgICAgICAgfSksXHJcblxyXG4gICAgICAgICAgICBhcGk6IHNlbGYuYXBpLFxyXG5cclxuICAgICAgICAgICAgb25BY2NlcHRDYWxsOiAoc2VsZi5saXN0ZW5lciAmJiBzZWxmLmxpc3RlbmVyLm9uQWNjZXB0Q2FsbCkgfHwgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb25SaW5naW5nOiAoc2VsZi5saXN0ZW5lciAmJiBzZWxmLmxpc3RlbmVyLm9uUmluZ2luZykgfHwgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb25UZXJtQ2FsbDogKHNlbGYubGlzdGVuZXIgJiYgc2VsZi5saXN0ZW5lci5vblRlcm1DYWxsKSB8fCBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBvbk90aGVyVXNlck9wZW5Wb2ljZTogKHNlbGYubGlzdGVuZXIgJiYgc2VsZi5saXN0ZW5lci5vbk90aGVyVXNlck9wZW5Wb2ljZSkgfHwgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb25PdGhlclVzZXJPcGVuVmlkZW86IChzZWxmLmxpc3RlbmVyICYmIHNlbGYubGlzdGVuZXIub25PdGhlclVzZXJPcGVuVmlkZW8pIHx8IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaW5pdENvbmZpZ3MpIHtcclxuICAgIFV0aWwuZXh0ZW5kKHRydWUsIHRoaXMsIF9DYWxsLCBpbml0Q29uZmlncyB8fCB7fSk7XHJcblxyXG4gICAgdGhpcy5pbml0KCk7XHJcbn07XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJydGMvc3JjL2NvbXBvbmVudHMvY2FsbC5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQVZBO0FBQ0E7QUFhQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFIQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVkE7QUFDQTtBQVlBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFHQTtBQUdBO0FBR0E7QUFHQTtBQWxDQTtBQXNDQTtBQWxNQTtBQUNBO0FBcU1BO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ 254:
/***/ (function(module, exports, __webpack_require__) {

	eval("'use strict';\n\n/**\r\n * IQ Message，IM -> CMServer --> IM\r\n */\n\nvar _util = __webpack_require__(252);\nvar _logger = _util.logger;\nvar API = __webpack_require__(255);\nvar RouteTo = API.RouteTo;\n\nvar CONFERENCE_XMLNS = \"urn:xmpp:media-conference\";\n\nvar _RtcHandler = {\n    _apiCallbacks: {},\n\n    imConnection: null,\n\n    _connectedSid: '',\n\n    init: function init() {\n        var self = this;\n\n        var _conn = self.imConnection;\n\n        _conn.registerConfrIQHandler = function () {\n            var handleConferenceIQ = function handleConferenceIQ(msginfo) {\n                try {\n                    self.handleRtcMessage(msginfo);\n                } catch (error) {\n                    _logger.error(error.stack || error);\n                    throw error;\n                }\n\n                return true;\n            };\n\n            _conn.addHandler(handleConferenceIQ, CONFERENCE_XMLNS, 'iq', \"set\");\n            _conn.addHandler(handleConferenceIQ, CONFERENCE_XMLNS, 'iq', \"get\");\n\n            _logger.warn(\"Conference iq handler. registered.\");\n        };\n    },\n\n    handleRtcMessage: function handleRtcMessage(msginfo) {\n        var self = this;\n\n        var id = msginfo.getAttribute('id');\n        var from = msginfo.getAttribute('from') || '';\n\n        // remove resource\n        from.lastIndexOf(\"/\") >= 0 && (from = from.substring(0, from.lastIndexOf(\"/\")));\n\n        var rtkey = msginfo.getElementsByTagName('rtkey')[0].innerHTML;\n\n        var fromSessionId = msginfo.getElementsByTagName('sid')[0].innerHTML;\n\n        (self._fromSessionID || (self._fromSessionID = {}))[from] = fromSessionId;\n\n        var contentTags = msginfo.getElementsByTagName('content');\n\n        var contentString = contentTags[0].innerHTML;\n\n        var content = _util.parseJSON(contentString);\n\n        var rtcOptions = content;\n\n        var streamType = msginfo.getElementsByTagName('stream_type')[0].innerHTML; //VOICE, VIDEO\n\n        if (streamType == \"\") {\n            streamType = \"VOICE\";\n        }\n\n        rtcOptions.streamType = streamType;\n\n        if (rtcOptions.op == 102) {\n            self.singalStreamType = streamType;\n        }\n\n        var tsxId = content.tsxId;\n\n        self.ctx = content.ctx;\n\n        _logger.debug(\"Recv [op = \" + rtcOptions.op + \"] [tsxId=\" + tsxId + \"]\\r\\n json :\", msginfo);\n\n        //if a->b already, c->a/b should be termiated with 'busy' reason\n        if (from.indexOf(\"@\") >= 0) {\n            if (self._connectedSid == '' && rtcOptions.op == 102) {\n                self._connectedSid = fromSessionId;\n            } else {\n                if (self._connectedSid != fromSessionId) {\n                    _logger.debug(\"Error recv [op = \" + rtcOptions.op + \"] [tsxId=\" + tsxId + \"]. caused by _connectedSid != fromSessionId :\", self._connectedSid, fromSessionId);\n\n                    //onInitC\n                    if (rtcOptions.op == 102) {\n                        var rt = new RouteTo({\n                            to: from,\n                            rtKey: rtkey,\n                            sid: fromSessionId,\n                            success: function success(result) {\n                                _logger.debug(\"iq to server success\", result);\n                            },\n                            fail: function fail(error) {\n                                _logger.debug(\"iq to server error\", error);\n                                self.onError(error);\n                            }\n                        });\n\n                        var options = {\n                            data: {\n                                op: 107,\n                                sessId: rtcOptions.sessId,\n                                rtcId: rtcOptions.rtcId,\n                                reason: 'busy'\n\n                            },\n                            reason: 'busy'\n                        };\n                        self.sendRtcMessage(rt, options);\n                    }\n                    return;\n                }\n            }\n        }\n\n        //onTermC\n        if (rtcOptions.op == 107) {\n            self._connectedSid = '';\n            self._fromSessionID = {};\n\n            var reasonObj = msginfo.getElementsByTagName('reason');\n            //var endReason = msginfo.getElementsByTagName('reason')[0].innerHTML;\n            reasonObj && reasonObj.length > 0 && (rtcOptions.reason = reasonObj[0].innerHTML);\n        }\n\n        if (rtcOptions.sdp) {\n            if (typeof rtcOptions.sdp === 'string') {\n                rtcOptions.sdp = _util.parseJSON(rtcOptions.sdp);\n            }\n            rtcOptions.sdp.type && (rtcOptions.sdp.type = rtcOptions.sdp.type.toLowerCase());\n        }\n        if (rtcOptions.cands) {\n            if (typeof rtcOptions.cands === 'string') {\n                rtcOptions.cands = _util.parseJSON(rtcOptions.cands);\n            }\n\n            for (var i = 0; i < rtcOptions.cands.length; i++) {\n                typeof rtcOptions.cands[i] === 'string' && (rtcOptions.cands[i] = _util.parseJSON(rtcOptions.cands[i]));\n\n                rtcOptions.cands[i].sdpMLineIndex = rtcOptions.cands[i].mlineindex;\n                rtcOptions.cands[i].sdpMid = rtcOptions.cands[i].mid;\n\n                delete rtcOptions.cands[i].mlineindex;\n                delete rtcOptions.cands[i].mid;\n            }\n        }\n\n        rtcOptions.rtcCfg && typeof rtcOptions.rtcCfg === 'string' && (rtcOptions.rtcCfg = _util.parseJSON(rtcOptions.rtcCfg));\n        rtcOptions.rtcCfg2 && typeof rtcOptions.rtcCfg2 === 'string' && (rtcOptions.rtcCfg2 = _util.parseJSON(rtcOptions.rtcCfg2));\n        rtcOptions.WebRTC && typeof rtcOptions.WebRTC === 'string' && (rtcOptions.WebRTC = _util.parseJSON(rtcOptions.WebRTC));\n\n        if (tsxId && self._apiCallbacks[tsxId]) {\n            try {\n                self._apiCallbacks[tsxId].callback && self._apiCallbacks[tsxId].callback(from, rtcOptions);\n            } catch (err) {\n                throw err;\n            } finally {\n                delete self._apiCallbacks[tsxId];\n            }\n        } else {\n            self.onRecvRtcMessage(from, rtcOptions, rtkey, tsxId, fromSessionId);\n        }\n\n        return true;\n    },\n\n    onRecvRtcMessage: function onRecvRtcMessage(from, rtcOptions, rtkey, tsxId, fromSessionId) {\n        _logger.debug(' form : ' + from + \" \\r\\n json :\" + _util.stringifyJSON(rtcJSON));\n    },\n\n    convertRtcOptions: function convertRtcOptions(options) {\n        var sdp = options.data.sdp;\n        if (sdp) {\n            var _sdp = {\n                type: sdp.type,\n                sdp: sdp.sdp\n            };\n\n            sdp = _sdp;\n\n            sdp.type = sdp.type.toUpperCase();\n            sdp = _util.stringifyJSON(sdp);\n\n            options.data.sdp = sdp;\n        }\n\n        var cands = options.data.cands;\n\n        if (cands) {\n            if (_util.isArray(cands)) {} else {\n                var _cands = [];\n                _cands.push(cands);\n                cands = _cands;\n            }\n\n            for (var i in cands) {\n                if (cands[i] instanceof RTCIceCandidate) {\n                    var _cand = {\n                        type: \"candidate\",\n                        candidate: cands[i].candidate,\n                        mlineindex: cands[i].sdpMLineIndex,\n                        mid: cands[i].sdpMid\n                        // seq: i\n                    };\n\n                    cands[i] = _util.stringifyJSON(_cand);\n                }\n            }\n\n            options.data.cands = cands;\n        } else {\n            // options.data.cands = [];\n        }\n\n        var rtcCfg = options.data.rtcCfg;\n        if (rtcCfg) {\n            typeof rtcCfg !== 'string' && (options.data.rtcCfg = _util.stringifyJSON(rtcCfg));\n        }\n\n        var _webrtc = options.data.WebRTC;\n        if (_webrtc) {\n            typeof _webrtc !== 'string' && (options.data.WebRTC = _util.stringifyJSON(_webrtc));\n        }\n    },\n\n    /**\r\n     * rt: { id: , to: , rtKey: , rtflag: , sid: , tsxId: , type: , }\r\n     *\r\n     * rtcOptions: { data : { op : 'reqP2P', video : 1, audio : 1, peer :\r\n     * curChatUserId, //appKey + \"_\" + curChatUserId + \"@\" + this.domain, } }\r\n     *\r\n     */\n    sendRtcMessage: function sendRtcMessage(rt, options, callback) {\n        var self = this;\n\n        var _conn = self.imConnection;\n\n        var tsxId = rt.tsxId || _conn.getUniqueId();\n\n        var to = rt.to || _conn.domain;\n\n        var sid = rt.sid || self._fromSessionID && self._fromSessionID[to];\n        //sid = sid || ((self._fromSessionID || (self._fromSessionID = {}))[to] = _conn.getUniqueId(\"CONFR_\"));\n        sid = sid || _conn.getUniqueId(\"CONFR_\");\n        (self._fromSessionID || (self._fromSessionID = {}))[to] = sid;\n\n        if (to.indexOf(\"@\") >= 0) {\n            if (self._connectedSid == '' && options.data.op == 102) {\n                self._connectedSid = sid;\n            }\n        }\n        var rtKey = rt.rtKey || rt.rtkey;\n        // rtKey && delete rt.rtKey;\n        rtKey || (rtKey = \"\");\n\n        var rtflag = rt.rtflag;\n        // rtflag && delete rt.rtflag;\n        rtflag || (rtflag = 1);\n\n        options.data || (options.data = {});\n        options.data.tsxId = tsxId;\n\n        self.ctx && (options.data.ctx = self.ctx);\n        self.convertRtcOptions(options);\n\n        var streamType = options.streamType || self.singalStreamType || \"VIDEO\"; // \"VIDEO\"; //VOICE, VIDEO\n        if (options.data.op == 102) {\n            self.singalStreamType = streamType;\n        }\n\n        var id = rt.id || _conn.getUniqueId(\"CONFR_\");\n        var iq = $iq({\n            // xmlns: CONFERENCE_XMLNS,\n            id: id,\n            to: to,\n            from: _conn.context.jid,\n            type: rt.type || \"get\"\n        }).c(\"query\", {\n            xmlns: CONFERENCE_XMLNS\n        }).c(\"MediaReqExt\").c('rtkey').t(rtKey).up().c('rtflag').t(rtflag).up().c('stream_type').t(streamType).up().c('sid').t(sid).up().c('content').t(_util.stringifyJSON(options.data));\n\n        if (options.data.op == 107 && options.reason) {\n            iq.up().c('reason').t(options.reason);\n        }\n        _logger.debug(\"Send [op = \" + options.data.op + \"] : \\r\\n\", iq.tree());\n\n        callback && (self._apiCallbacks[tsxId] = {\n            callback: callback\n        });\n\n        var completeFn = function (result) {\n            rt.success(result);\n        } || function (result) {\n            _logger.debug(\"send result. op:\" + options.data.op + \".\", result);\n        };\n\n        var errFn = function (ele) {\n            rt.fail(ele);\n        } || function (ele) {\n            _logger.debug(ele);\n        };\n\n        _conn.context.stropheConn.sendIQ(iq.tree(), completeFn, errFn);\n\n        //onTermC\n        if (options.data.op == 107 && self._connectedSid) {\n            if (!rt.sid || self._connectedSid == rt.sid) {\n                self._connectedSid = '';\n                self._fromSessionID = {};\n            }\n        }\n    }\n};\n\nvar RTCIQHandler = function RTCIQHandler(initConfigs) {\n    _util.extend(true, this, _RtcHandler, initConfigs || {});\n\n    this.init();\n};\nmodule.exports = RTCIQHandler;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjU0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnJ0Yy9zcmMvY29tcG9uZW50cy9pcS5qcz9kYjM1Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBJUSBNZXNzYWdl77yMSU0gLT4gQ01TZXJ2ZXIgLS0+IElNXHJcbiAqL1xyXG5cclxudmFyIF91dGlsID0gcmVxdWlyZSgnLi91dGlscycpO1xyXG52YXIgX2xvZ2dlciA9IF91dGlsLmxvZ2dlcjtcclxudmFyIEFQSSA9IHJlcXVpcmUoJy4vYXBpJyk7XHJcbnZhciBSb3V0ZVRvID0gQVBJLlJvdXRlVG87XHJcblxyXG52YXIgQ09ORkVSRU5DRV9YTUxOUyA9IFwidXJuOnhtcHA6bWVkaWEtY29uZmVyZW5jZVwiO1xyXG5cclxuXHJcbnZhciBfUnRjSGFuZGxlciA9IHtcclxuICAgIF9hcGlDYWxsYmFja3M6IHt9LFxyXG5cclxuICAgIGltQ29ubmVjdGlvbjogbnVsbCxcclxuXHJcbiAgICBfY29ubmVjdGVkU2lkOiAnJyxcclxuXHJcblxyXG4gICAgaW5pdDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIF9jb25uID0gc2VsZi5pbUNvbm5lY3Rpb247XHJcblxyXG4gICAgICAgIF9jb25uLnJlZ2lzdGVyQ29uZnJJUUhhbmRsZXIgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgaGFuZGxlQ29uZmVyZW5jZUlRID0gZnVuY3Rpb24gKG1zZ2luZm8pIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVSdGNNZXNzYWdlKG1zZ2luZm8pO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBfbG9nZ2VyLmVycm9yKGVycm9yLnN0YWNrIHx8IGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIF9jb25uLmFkZEhhbmRsZXIoaGFuZGxlQ29uZmVyZW5jZUlRLCBDT05GRVJFTkNFX1hNTE5TLCAnaXEnLCBcInNldFwiKTtcclxuICAgICAgICAgICAgX2Nvbm4uYWRkSGFuZGxlcihoYW5kbGVDb25mZXJlbmNlSVEsIENPTkZFUkVOQ0VfWE1MTlMsICdpcScsIFwiZ2V0XCIpO1xyXG5cclxuICAgICAgICAgICAgX2xvZ2dlci53YXJuKFwiQ29uZmVyZW5jZSBpcSBoYW5kbGVyLiByZWdpc3RlcmVkLlwiKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIGhhbmRsZVJ0Y01lc3NhZ2U6IGZ1bmN0aW9uIChtc2dpbmZvKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgaWQgPSBtc2dpbmZvLmdldEF0dHJpYnV0ZSgnaWQnKTtcclxuICAgICAgICB2YXIgZnJvbSA9IG1zZ2luZm8uZ2V0QXR0cmlidXRlKCdmcm9tJykgfHwgJyc7XHJcblxyXG4gICAgICAgIC8vIHJlbW92ZSByZXNvdXJjZVxyXG4gICAgICAgIGZyb20ubGFzdEluZGV4T2YoXCIvXCIpID49IDAgJiYgKGZyb20gPSBmcm9tLnN1YnN0cmluZygwLCBmcm9tLmxhc3RJbmRleE9mKFwiL1wiKSkpO1xyXG5cclxuXHJcbiAgICAgICAgdmFyIHJ0a2V5ID0gbXNnaW5mby5nZXRFbGVtZW50c0J5VGFnTmFtZSgncnRrZXknKVswXS5pbm5lckhUTUw7XHJcblxyXG4gICAgICAgIHZhciBmcm9tU2Vzc2lvbklkID0gbXNnaW5mby5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2lkJylbMF0uaW5uZXJIVE1MO1xyXG5cclxuICAgICAgICAoc2VsZi5fZnJvbVNlc3Npb25JRCB8fCAoc2VsZi5fZnJvbVNlc3Npb25JRCA9IHt9KSlbZnJvbV0gPSBmcm9tU2Vzc2lvbklkO1xyXG5cclxuICAgICAgICB2YXIgY29udGVudFRhZ3MgPSBtc2dpbmZvLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdjb250ZW50Jyk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgdmFyIGNvbnRlbnRTdHJpbmcgPSBjb250ZW50VGFnc1swXS5pbm5lckhUTUw7XHJcblxyXG4gICAgICAgIHZhciBjb250ZW50ID0gX3V0aWwucGFyc2VKU09OKGNvbnRlbnRTdHJpbmcpO1xyXG5cclxuICAgICAgICB2YXIgcnRjT3B0aW9ucyA9IGNvbnRlbnQ7XHJcblxyXG4gICAgICAgIHZhciBzdHJlYW1UeXBlID0gbXNnaW5mby5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3RyZWFtX3R5cGUnKVswXS5pbm5lckhUTUw7IC8vVk9JQ0UsIFZJREVPXHJcblxyXG4gICAgICAgIGlmKHN0cmVhbVR5cGUgPT0gXCJcIil7XHJcbiAgICAgICAgICAgIHN0cmVhbVR5cGUgPSBcIlZPSUNFXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBydGNPcHRpb25zLnN0cmVhbVR5cGUgPSBzdHJlYW1UeXBlO1xyXG5cclxuICAgICAgICBpZihydGNPcHRpb25zLm9wID09IDEwMil7XHJcbiAgICAgICAgICAgIHNlbGYuc2luZ2FsU3RyZWFtVHlwZSA9IHN0cmVhbVR5cGU7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdmFyIHRzeElkID0gY29udGVudC50c3hJZDtcclxuXHJcbiAgICAgICAgc2VsZi5jdHggPSBjb250ZW50LmN0eDtcclxuXHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZyhcIlJlY3YgW29wID0gXCIgKyBydGNPcHRpb25zLm9wICsgXCJdIFt0c3hJZD1cIiArIHRzeElkICsgXCJdXFxyXFxuIGpzb24gOlwiLCBtc2dpbmZvKTtcclxuXHJcblxyXG4gICAgICAgIC8vaWYgYS0+YiBhbHJlYWR5LCBjLT5hL2Igc2hvdWxkIGJlIHRlcm1pYXRlZCB3aXRoICdidXN5JyByZWFzb25cclxuICAgICAgICBpZiAoZnJvbS5pbmRleE9mKFwiQFwiKSA+PSAwKSB7XHJcbiAgICAgICAgICAgIGlmIChzZWxmLl9jb25uZWN0ZWRTaWQgPT0gJycgJiYgcnRjT3B0aW9ucy5vcCA9PSAxMDIpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuX2Nvbm5lY3RlZFNpZCA9IGZyb21TZXNzaW9uSWQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5fY29ubmVjdGVkU2lkICE9IGZyb21TZXNzaW9uSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBfbG9nZ2VyLmRlYnVnKFwiRXJyb3IgcmVjdiBbb3AgPSBcIiArIHJ0Y09wdGlvbnMub3AgKyBcIl0gW3RzeElkPVwiICsgdHN4SWQgKyBcIl0uIGNhdXNlZCBieSBfY29ubmVjdGVkU2lkICE9IGZyb21TZXNzaW9uSWQgOlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9jb25uZWN0ZWRTaWQsIGZyb21TZXNzaW9uSWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL29uSW5pdENcclxuICAgICAgICAgICAgICAgICAgICBpZiAocnRjT3B0aW9ucy5vcCA9PSAxMDIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJ0ID0gbmV3IFJvdXRlVG8oe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG86IGZyb20sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydEtleTogcnRrZXksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWQ6IGZyb21TZXNzaW9uSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZ2dlci5kZWJ1ZyhcImlxIHRvIHNlcnZlciBzdWNjZXNzXCIsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbDogZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZ2dlci5kZWJ1ZyhcImlxIHRvIHNlcnZlciBlcnJvclwiLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vbkVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcDogMTA3LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3NJZDogcnRjT3B0aW9ucy5zZXNzSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnRjSWQ6IHJ0Y09wdGlvbnMucnRjSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uOiAnYnVzeSdcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uOiAnYnVzeSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kUnRjTWVzc2FnZShydCwgb3B0aW9ucylcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL29uVGVybUNcclxuICAgICAgICBpZiAocnRjT3B0aW9ucy5vcCA9PSAxMDcpIHtcclxuICAgICAgICAgICAgc2VsZi5fY29ubmVjdGVkU2lkID0gJyc7XHJcbiAgICAgICAgICAgIHNlbGYuX2Zyb21TZXNzaW9uSUQgPSB7fTtcclxuXHJcbiAgICAgICAgICAgIHZhciByZWFzb25PYmogPSBtc2dpbmZvLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdyZWFzb24nKTtcclxuICAgICAgICAgICAgLy92YXIgZW5kUmVhc29uID0gbXNnaW5mby5nZXRFbGVtZW50c0J5VGFnTmFtZSgncmVhc29uJylbMF0uaW5uZXJIVE1MO1xyXG4gICAgICAgICAgICByZWFzb25PYmogJiYgcmVhc29uT2JqLmxlbmd0aCA+IDAgJiYgKHJ0Y09wdGlvbnMucmVhc29uID0gcmVhc29uT2JqWzBdLmlubmVySFRNTCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAocnRjT3B0aW9ucy5zZHApIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBydGNPcHRpb25zLnNkcCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJ0Y09wdGlvbnMuc2RwID0gX3V0aWwucGFyc2VKU09OKHJ0Y09wdGlvbnMuc2RwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBydGNPcHRpb25zLnNkcC50eXBlICYmIChydGNPcHRpb25zLnNkcC50eXBlID0gcnRjT3B0aW9ucy5zZHAudHlwZS50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJ0Y09wdGlvbnMuY2FuZHMpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBydGNPcHRpb25zLmNhbmRzID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgcnRjT3B0aW9ucy5jYW5kcyA9IF91dGlsLnBhcnNlSlNPTihydGNPcHRpb25zLmNhbmRzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBydGNPcHRpb25zLmNhbmRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB0eXBlb2YgcnRjT3B0aW9ucy5jYW5kc1tpXSA9PT0gJ3N0cmluZycgJiYgKHJ0Y09wdGlvbnMuY2FuZHNbaV0gPSBfdXRpbC5wYXJzZUpTT04ocnRjT3B0aW9ucy5jYW5kc1tpXSkpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJ0Y09wdGlvbnMuY2FuZHNbaV0uc2RwTUxpbmVJbmRleCA9IHJ0Y09wdGlvbnMuY2FuZHNbaV0ubWxpbmVpbmRleDtcclxuICAgICAgICAgICAgICAgIHJ0Y09wdGlvbnMuY2FuZHNbaV0uc2RwTWlkID0gcnRjT3B0aW9ucy5jYW5kc1tpXS5taWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHJ0Y09wdGlvbnMuY2FuZHNbaV0ubWxpbmVpbmRleDtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBydGNPcHRpb25zLmNhbmRzW2ldLm1pZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcnRjT3B0aW9ucy5ydGNDZmcgJiYgKHR5cGVvZiBydGNPcHRpb25zLnJ0Y0NmZyA9PT0gJ3N0cmluZycpICYmIChydGNPcHRpb25zLnJ0Y0NmZyA9IF91dGlsLnBhcnNlSlNPTihydGNPcHRpb25zLnJ0Y0NmZykpO1xyXG4gICAgICAgIHJ0Y09wdGlvbnMucnRjQ2ZnMiAmJiAodHlwZW9mIHJ0Y09wdGlvbnMucnRjQ2ZnMiA9PT0gJ3N0cmluZycpICYmIChydGNPcHRpb25zLnJ0Y0NmZzIgPSBfdXRpbC5wYXJzZUpTT04ocnRjT3B0aW9ucy5ydGNDZmcyKSk7XHJcbiAgICAgICAgcnRjT3B0aW9ucy5XZWJSVEMgJiYgKHR5cGVvZiBydGNPcHRpb25zLldlYlJUQyA9PT0gJ3N0cmluZycpICYmIChydGNPcHRpb25zLldlYlJUQyA9IF91dGlsLnBhcnNlSlNPTihydGNPcHRpb25zLldlYlJUQykpO1xyXG5cclxuICAgICAgICBpZiAodHN4SWQgJiYgc2VsZi5fYXBpQ2FsbGJhY2tzW3RzeElkXSkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5fYXBpQ2FsbGJhY2tzW3RzeElkXS5jYWxsYmFjayAmJiBzZWxmLl9hcGlDYWxsYmFja3NbdHN4SWRdLmNhbGxiYWNrKGZyb20sIHJ0Y09wdGlvbnMpO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IGVycjtcclxuICAgICAgICAgICAgfSBmaW5hbGx5IHtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBzZWxmLl9hcGlDYWxsYmFja3NbdHN4SWRdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzZWxmLm9uUmVjdlJ0Y01lc3NhZ2UoZnJvbSwgcnRjT3B0aW9ucywgcnRrZXksIHRzeElkLCBmcm9tU2Vzc2lvbklkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSxcclxuXHJcblxyXG4gICAgb25SZWN2UnRjTWVzc2FnZTogZnVuY3Rpb24gKGZyb20sIHJ0Y09wdGlvbnMsIHJ0a2V5LCB0c3hJZCwgZnJvbVNlc3Npb25JZCkge1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoJyBmb3JtIDogJyArIGZyb20gKyBcIiBcXHJcXG4ganNvbiA6XCIgKyBfdXRpbC5zdHJpbmdpZnlKU09OKHJ0Y0pTT04pKTtcclxuICAgIH0sXHJcblxyXG4gICAgY29udmVydFJ0Y09wdGlvbnM6IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgdmFyIHNkcCA9IG9wdGlvbnMuZGF0YS5zZHA7XHJcbiAgICAgICAgaWYgKHNkcCkge1xyXG4gICAgICAgICAgICB2YXIgX3NkcCA9IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IHNkcC50eXBlLFxyXG4gICAgICAgICAgICAgICAgc2RwOiBzZHAuc2RwXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzZHAgPSBfc2RwO1xyXG5cclxuICAgICAgICAgICAgc2RwLnR5cGUgPSBzZHAudHlwZS50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgICAgICBzZHAgPSBfdXRpbC5zdHJpbmdpZnlKU09OKHNkcCk7XHJcblxyXG4gICAgICAgICAgICBvcHRpb25zLmRhdGEuc2RwID0gc2RwO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHZhciBjYW5kcyA9IG9wdGlvbnMuZGF0YS5jYW5kcztcclxuXHJcbiAgICAgICAgaWYgKGNhbmRzKSB7XHJcbiAgICAgICAgICAgIGlmIChfdXRpbC5pc0FycmF5KGNhbmRzKSkge1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBfY2FuZHMgPSBbXTtcclxuICAgICAgICAgICAgICAgIF9jYW5kcy5wdXNoKGNhbmRzKTtcclxuICAgICAgICAgICAgICAgIGNhbmRzID0gX2NhbmRzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIGNhbmRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FuZHNbaV0gaW5zdGFuY2VvZiBSVENJY2VDYW5kaWRhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgX2NhbmQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiY2FuZGlkYXRlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZTogY2FuZHNbaV0uY2FuZGlkYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtbGluZWluZGV4OiBjYW5kc1tpXS5zZHBNTGluZUluZGV4LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtaWQ6IGNhbmRzW2ldLnNkcE1pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VxOiBpXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FuZHNbaV0gPSBfdXRpbC5zdHJpbmdpZnlKU09OKF9jYW5kKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb3B0aW9ucy5kYXRhLmNhbmRzID0gY2FuZHM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gb3B0aW9ucy5kYXRhLmNhbmRzID0gW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgcnRjQ2ZnID0gb3B0aW9ucy5kYXRhLnJ0Y0NmZztcclxuICAgICAgICBpZiAocnRjQ2ZnKSB7XHJcbiAgICAgICAgICAgIHR5cGVvZiBydGNDZmcgIT09ICdzdHJpbmcnICYmIChvcHRpb25zLmRhdGEucnRjQ2ZnID0gX3V0aWwuc3RyaW5naWZ5SlNPTihydGNDZmcpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBfd2VicnRjID0gb3B0aW9ucy5kYXRhLldlYlJUQztcclxuICAgICAgICBpZiAoX3dlYnJ0Yykge1xyXG4gICAgICAgICAgICB0eXBlb2YgX3dlYnJ0YyAhPT0gJ3N0cmluZycgJiYgKG9wdGlvbnMuZGF0YS5XZWJSVEMgPSBfdXRpbC5zdHJpbmdpZnlKU09OKF93ZWJydGMpKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcnQ6IHsgaWQ6ICwgdG86ICwgcnRLZXk6ICwgcnRmbGFnOiAsIHNpZDogLCB0c3hJZDogLCB0eXBlOiAsIH1cclxuICAgICAqXHJcbiAgICAgKiBydGNPcHRpb25zOiB7IGRhdGEgOiB7IG9wIDogJ3JlcVAyUCcsIHZpZGVvIDogMSwgYXVkaW8gOiAxLCBwZWVyIDpcclxuICAgICAqIGN1ckNoYXRVc2VySWQsIC8vYXBwS2V5ICsgXCJfXCIgKyBjdXJDaGF0VXNlcklkICsgXCJAXCIgKyB0aGlzLmRvbWFpbiwgfSB9XHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBzZW5kUnRjTWVzc2FnZTogZnVuY3Rpb24gKHJ0LCBvcHRpb25zLCBjYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIF9jb25uID0gc2VsZi5pbUNvbm5lY3Rpb247XHJcblxyXG4gICAgICAgIHZhciB0c3hJZCA9IHJ0LnRzeElkIHx8IF9jb25uLmdldFVuaXF1ZUlkKCk7XHJcblxyXG4gICAgICAgIHZhciB0byA9IHJ0LnRvIHx8IF9jb25uLmRvbWFpbjtcclxuXHJcbiAgICAgICAgdmFyIHNpZCA9IHJ0LnNpZCB8fCBzZWxmLl9mcm9tU2Vzc2lvbklEICYmIHNlbGYuX2Zyb21TZXNzaW9uSURbdG9dO1xyXG4gICAgICAgIC8vc2lkID0gc2lkIHx8ICgoc2VsZi5fZnJvbVNlc3Npb25JRCB8fCAoc2VsZi5fZnJvbVNlc3Npb25JRCA9IHt9KSlbdG9dID0gX2Nvbm4uZ2V0VW5pcXVlSWQoXCJDT05GUl9cIikpO1xyXG4gICAgICAgIHNpZCA9IHNpZCB8fCBfY29ubi5nZXRVbmlxdWVJZChcIkNPTkZSX1wiKTtcclxuICAgICAgICAoc2VsZi5fZnJvbVNlc3Npb25JRCB8fCAoc2VsZi5fZnJvbVNlc3Npb25JRCA9IHt9KSlbdG9dID0gc2lkO1xyXG5cclxuICAgICAgICBpZiAodG8uaW5kZXhPZihcIkBcIikgPj0gMCkge1xyXG4gICAgICAgICAgICBpZiAoc2VsZi5fY29ubmVjdGVkU2lkID09ICcnICYmIG9wdGlvbnMuZGF0YS5vcCA9PSAxMDIpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuX2Nvbm5lY3RlZFNpZCA9IHNpZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcnRLZXkgPSBydC5ydEtleSB8fCBydC5ydGtleTtcclxuICAgICAgICAvLyBydEtleSAmJiBkZWxldGUgcnQucnRLZXk7XHJcbiAgICAgICAgcnRLZXkgfHwgKHJ0S2V5ID0gXCJcIik7XHJcblxyXG4gICAgICAgIHZhciBydGZsYWcgPSBydC5ydGZsYWc7XHJcbiAgICAgICAgLy8gcnRmbGFnICYmIGRlbGV0ZSBydC5ydGZsYWc7XHJcbiAgICAgICAgcnRmbGFnIHx8IChydGZsYWcgPSAxKTtcclxuXHJcbiAgICAgICAgb3B0aW9ucy5kYXRhIHx8IChvcHRpb25zLmRhdGEgPSB7fSk7XHJcbiAgICAgICAgb3B0aW9ucy5kYXRhLnRzeElkID0gdHN4SWQ7XHJcblxyXG4gICAgICAgIHNlbGYuY3R4ICYmIChvcHRpb25zLmRhdGEuY3R4ID0gc2VsZi5jdHgpO1xyXG4gICAgICAgIHNlbGYuY29udmVydFJ0Y09wdGlvbnMob3B0aW9ucyk7XHJcblxyXG4gICAgICAgIHZhciBzdHJlYW1UeXBlID0gb3B0aW9ucy5zdHJlYW1UeXBlIHx8IHNlbGYuc2luZ2FsU3RyZWFtVHlwZSB8fCBcIlZJREVPXCI7IC8vIFwiVklERU9cIjsgLy9WT0lDRSwgVklERU9cclxuICAgICAgICBpZiAob3B0aW9ucy5kYXRhLm9wID09IDEwMikge1xyXG4gICAgICAgICAgICBzZWxmLnNpbmdhbFN0cmVhbVR5cGUgPSBzdHJlYW1UeXBlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHZhciBpZCA9IHJ0LmlkIHx8IF9jb25uLmdldFVuaXF1ZUlkKFwiQ09ORlJfXCIpO1xyXG4gICAgICAgIHZhciBpcSA9ICRpcSh7XHJcbiAgICAgICAgICAgIC8vIHhtbG5zOiBDT05GRVJFTkNFX1hNTE5TLFxyXG4gICAgICAgICAgICBpZDogaWQsXHJcbiAgICAgICAgICAgIHRvOiB0byxcclxuICAgICAgICAgICAgZnJvbTogX2Nvbm4uY29udGV4dC5qaWQsXHJcbiAgICAgICAgICAgIHR5cGU6IHJ0LnR5cGUgfHwgXCJnZXRcIlxyXG4gICAgICAgIH0pLmMoXCJxdWVyeVwiLCB7XHJcbiAgICAgICAgICAgIHhtbG5zOiBDT05GRVJFTkNFX1hNTE5TXHJcbiAgICAgICAgfSkuYyhcIk1lZGlhUmVxRXh0XCIpLmMoJ3J0a2V5JykudChydEtleSlcclxuICAgICAgICAgICAgLnVwKCkuYygncnRmbGFnJykudChydGZsYWcpXHJcbiAgICAgICAgICAgIC51cCgpLmMoJ3N0cmVhbV90eXBlJykudChzdHJlYW1UeXBlKVxyXG4gICAgICAgICAgICAudXAoKS5jKCdzaWQnKS50KHNpZClcclxuICAgICAgICAgICAgLnVwKCkuYygnY29udGVudCcpLnQoX3V0aWwuc3RyaW5naWZ5SlNPTihvcHRpb25zLmRhdGEpKTtcclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuZGF0YS5vcCA9PSAxMDcgJiYgb3B0aW9ucy5yZWFzb24pIHtcclxuICAgICAgICAgICAgaXEudXAoKS5jKCdyZWFzb24nKS50KG9wdGlvbnMucmVhc29uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZyhcIlNlbmQgW29wID0gXCIgKyBvcHRpb25zLmRhdGEub3AgKyBcIl0gOiBcXHJcXG5cIiwgaXEudHJlZSgpKTtcclxuXHJcblxyXG4gICAgICAgIGNhbGxiYWNrICYmIChcclxuICAgICAgICAgICAgc2VsZi5fYXBpQ2FsbGJhY2tzW3RzeElkXSA9IHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgdmFyIGNvbXBsZXRlRm4gPSBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBydC5zdWNjZXNzKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0gfHwgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgX2xvZ2dlci5kZWJ1ZyhcInNlbmQgcmVzdWx0LiBvcDpcIiArIG9wdGlvbnMuZGF0YS5vcCArIFwiLlwiLCByZXN1bHQpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZXJyRm4gPSBmdW5jdGlvbiAoZWxlKSB7XHJcbiAgICAgICAgICAgICAgICBydC5mYWlsKGVsZSk7XHJcbiAgICAgICAgICAgIH0gfHwgZnVuY3Rpb24gKGVsZSkge1xyXG4gICAgICAgICAgICAgICAgX2xvZ2dlci5kZWJ1ZyhlbGUpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICBfY29ubi5jb250ZXh0LnN0cm9waGVDb25uLnNlbmRJUShpcS50cmVlKCksIGNvbXBsZXRlRm4sIGVyckZuKTtcclxuXHJcbiAgICAgICAgLy9vblRlcm1DXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuZGF0YS5vcCA9PSAxMDcgJiYgc2VsZi5fY29ubmVjdGVkU2lkKSB7XHJcbiAgICAgICAgICAgIGlmICghcnQuc2lkIHx8IHNlbGYuX2Nvbm5lY3RlZFNpZCA9PSBydC5zaWQpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuX2Nvbm5lY3RlZFNpZCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5fZnJvbVNlc3Npb25JRCA9IHt9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuXHJcbnZhciBSVENJUUhhbmRsZXIgPSBmdW5jdGlvbiAoaW5pdENvbmZpZ3MpIHtcclxuICAgIF91dGlsLmV4dGVuZCh0cnVlLCB0aGlzLCBfUnRjSGFuZGxlciwgaW5pdENvbmZpZ3MgfHwge30pO1xyXG5cclxuICAgIHRoaXMuaW5pdCgpO1xyXG59O1xyXG5tb2R1bGUuZXhwb3J0cyA9IFJUQ0lRSGFuZGxlcjtcclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnJ0Yy9zcmMvY29tcG9uZW50cy9pcS5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVkE7QUFDQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQVJBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBREE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBREE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdlVBO0FBQ0E7QUEwVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ 255:
/***/ (function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n/**\r\n * API\r\n */\nvar _util = __webpack_require__(252);\nvar _logger = _util.logger;\n\nvar _RouteTo = {\n    // to : null,\n    // rtKey: null,\n    rtFlag: 1,\n\n    success: function success(result) {},\n    fail: function fail(error) {}\n};\n\nvar RouteTo = function RouteTo(extendCfg) {\n    if (this instanceof RouteTo) {\n        var self = this;\n        _util.extend(true, self, _RouteTo, extendCfg || {});\n    } else {\n        var sub = function sub(extendCfg) {\n            var self = this;\n            _util.extend(true, self, extendCfg || {});\n        };\n\n        _util.extend(true, sub.prototype, _RouteTo, extendCfg || {});\n\n        return sub;\n    }\n};\nexports.RouteTo = RouteTo;\n\nvar _clazz = {\n    imConnection: null,\n    // webRtc: null,\n\n    rtcHandler: null,\n\n    events: {\n        '0': 'onReqP2P',\n        '1': 'onNewCfr',\n        '2': 'onDelCfr',\n        '3': 'onReqTkt',\n\n        '100': 'onPing',\n        '101': 'onPong',\n        '102': 'onInitC',\n        '103': 'onReqC',\n        '104': 'onAcptC',\n        '105': 'onTcklC',\n        '106': 'onAnsC',\n        '107': 'onTermC',\n\n        // '200' : 'onEnter',\n        // '201' : 'onExit',\n        // '202' : 'onInvite',\n        // '203' : 'onGetMems',\n\n        // '205' : 'onSubC',\n        // '206' : 'onUsubC',\n\n        '300': 'onEvEnter',\n        '301': 'onEvExit',\n        '302': 'onEvPub',\n        '303': 'onEvUnpub',\n        '304': 'onEvMems',\n        '204': 'onEvClose',\n        '400': 'onStreamControl',\n        '401': 'onEvJoin',\n\n        'onServerError': 'onServerError'\n    },\n\n    register: function register(listener) {\n        if ((typeof listener === 'undefined' ? 'undefined' : _typeof(listener)) === \"object\") {\n            for (var event in listener) {\n                this.bind(event, listener[event]);\n            }\n        }\n    },\n\n    bind: function bind(event, func) {\n        var self = this;\n\n        var onFunc;\n        if (onFunc = self.events[event]) {\n            self[onFunc] = func;\n        } else {\n            onFunc = self.events[event] = 'on_' + event;\n            self[onFunc] = func;\n        }\n    },\n\n    jid: function jid(shortUserName) {\n        if (/^.+#.+_.+@.+$/g.test(shortUserName)) {\n            return shortUserName;\n        }\n        // if (shortUserName.indexOf(this.imConnection.context.appKey) >= 0) {\n        //     return shortUserName;\n        // }\n        return this.imConnection.context.appKey + \"_\" + shortUserName + \"@\" + this.imConnection.domain;\n    },\n\n    /**\r\n     * ReqP2P 0\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param video\r\n     *            1 0\r\n     * @param audio\r\n     *            1 0\r\n     * @param peer\r\n     *\r\n     */\n    reqP2P: function reqP2P(rt, video, audio, peer, callback) {\n        _logger.debug(\"req p2p ...\");\n\n        var rtcOptions = {\n            data: {\n                op: 0,\n                video: video,\n                audio: audio,\n                peer: peer // appKey + \"_\" + curChatUserId + \"@\" + this.domain,\n            }\n        };\n\n        this.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * NewCfr 1\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param reqTkt\r\n     *            1 null\r\n     * @param password\r\n     *            string null\r\n     *\r\n     */\n    newCfr: function newCfr(rt, reqTkt, password, callback) {\n        _logger.debug(\"newCfr ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 1\n            }\n        };\n\n        reqTkt && (rtcOptions.data.reqTkt = reqTkt);\n        password && (rtcOptions.data.password = password);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * Enter 200\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param WebRTCId\r\n     * @param reqMembers !=\r\n     *            0 members\r\n     * @param tkt\r\n     * @param nonce\r\n     * @param digest\r\n     *\r\n     */\n    enter: function enter(rt, WebRTCId, reqMembers, tkt, nonce, digest, callback) {\n        _logger.debug(\"enter ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 200\n            }\n        };\n\n        WebRTCId && (rtcOptions.data.WebRTCId = WebRTCId);\n        reqMembers && (rtcOptions.data.reqMembers = reqMembers);\n        tkt && (rtcOptions.data.tkt = tkt);\n        nonce && (rtcOptions.data.nonce = nonce);\n        digest && (rtcOptions.data.digest = digest);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * Ping 100\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param sessId\r\n     *\r\n     */\n    ping: function ping(rt, sessId, callback) {\n        _logger.debug(\"ping ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 100\n            }\n        };\n\n        sessId && (rtcOptions.data.sessId = sessId);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * 通知对方 我已经关闭/打开 麦卡，摄像头\r\n     *\r\n     * PAUSE_VOICE(0, 0), RESUME_VOICE(1, 1), PAUSE_VIDEO(2, 2), RESUME_VIDEO(3, 3)\r\n     *\r\n     *\r\n     * @param rt\r\n     * @param sessId\r\n     * @param rtcId\r\n     * @param controlType\r\n     * @param callback\r\n     */\n    streamControl: function streamControl(rt, sessId, rtcId, controlType, callback) {\n        _logger.debug(\"streamControl ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 400\n            }\n        };\n\n        sessId && (rtcOptions.data.sessId = sessId);\n        rtcId && (rtcOptions.data.rtcId = rtcId);\n        typeof controlType !== 'undefined' && controlType != null && (rtcOptions.data.controlType = controlType);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * ReqTkt 3\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param WebRTCId\r\n     * @param success(from,\r\n     *            rtcOptions)\r\n     *\r\n     */\n    reqTkt: function reqTkt(rt, WebRTCId, callback) {\n        _logger.debug(\"reqTkt ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 3\n            }\n        };\n\n        WebRTCId && (rtcOptions.data.WebRTCId = WebRTCId);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * InitC 102\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param WebRTCId\r\n     * @param tkt\r\n     * @param sessId\r\n     * @param rtcId\r\n     * @param pubS\r\n     *            {name: streamName, video:1, audio:1, type: 0}\r\n     * @param subS\r\n     *            {memId: , rtcId: }\r\n     * @param sdp\r\n     *            sdp:sdpstring\r\n     * @param cands [ ]\r\n     *\r\n     */\n    initC: function initC(rt, streamType, WebRTCId, tkt, sessId, rtcId, pubS, subS, sdp, cands, rtcCfg, WebRTC, callback) {\n        _logger.debug(\"initC ...\");\n\n        var rtcOptions = {\n            data: {\n                op: 102\n            }\n        };\n\n        rtcOptions.streamType = streamType || \"VIDEO\";\n\n        WebRTCId && (rtcOptions.data.WebRTCId = WebRTCId);\n        tkt && (rtcOptions.data.tkt = tkt);\n        sessId && (rtcOptions.data.sessId = sessId);\n        rtcId && (rtcOptions.data.rtcId = rtcId);\n        pubS && (rtcOptions.data.pubS = pubS);\n        subS && (rtcOptions.data.subS = subS);\n        sdp && (rtcOptions.data.sdp = sdp);\n        cands && (rtcOptions.data.cands = cands);\n        rtcCfg && (rtcOptions.data.rtcCfg = rtcCfg);\n        WebRTC && (rtcOptions.data.WebRTC = WebRTC);\n\n        this.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * TcklC 105\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param sessId\r\n     * @param rtcId\r\n     * @param cands\r\n     * @param success(from,\r\n     *            rtcOptions)\r\n     *\r\n     */\n    tcklC: function tcklC(rt, sessId, rtcId, sdp, cands, callback) {\n        _logger.debug(\"tcklC ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 105\n            }\n        };\n\n        sessId && (rtcOptions.data.sessId = sessId);\n        rtcId && (rtcOptions.data.rtcId = rtcId);\n        sdp && (rtcOptions.data.sdp = sdp);\n        cands && (rtcOptions.data.cands = cands);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * AnsC 106\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param sessId\r\n     * @param rtcId\r\n     * @param sdp\r\n     * @param cands\r\n     *\r\n     */\n    ansC: function ansC(rt, sessId, rtcId, sdp, cands, callback, enableVoice, enableVideo) {\n        _logger.debug(\"ansC ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 106\n            }\n        };\n\n        sessId && (rtcOptions.data.sessId = sessId);\n        rtcId && (rtcOptions.data.rtcId = rtcId);\n        sdp && (rtcOptions.data.sdp = sdp);\n        cands && (rtcOptions.data.cands = cands);\n\n        enableVoice === false && (rtcOptions.data.enableVoice = enableVoice);\n        enableVideo === false && (rtcOptions.data.enableVideo = enableVideo);\n\n        // rtcOptions.data.enableVoice = false;\n        // rtcOptions.data.enableVideo = false;\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * AcptC 104\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param sessId\r\n     * @param rtcId\r\n     * @param sdp\r\n     * @param ans\r\n     *            1\r\n     *\r\n     */\n    acptC: function acptC(rt, sessId, rtcId, sdp, cands, ans, callback, enableVoice, enableVideo) {\n        _logger.debug(\"acptC ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 104\n            }\n        };\n\n        sessId && (rtcOptions.data.sessId = sessId);\n        rtcId && (rtcOptions.data.rtcId = rtcId);\n        sdp && (rtcOptions.data.sdp = sdp);\n        cands && (rtcOptions.data.cands = cands);\n        ans && (rtcOptions.data.ans = ans);\n\n        enableVoice === false && (rtcOptions.data.enableVoice = enableVoice);\n        enableVideo === false && (rtcOptions.data.enableVideo = enableVideo);\n\n        // rtcOptions.data.enableVoice = false;\n        // rtcOptions.data.enableVideo = false;\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * GetMems 203\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param WebRTCId\r\n     * @param sessId\r\n     * @param success(from,\r\n     *            rtcOptions)\r\n     *\r\n     */\n    getMems: function getMems(rt, WebRTCId, sessId, callback) {\n        _logger.debug(\"getMems ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 203\n            }\n        };\n\n        WebRTCId && (rtcOptions.data.WebRTCId = WebRTCId);\n        sessId && (rtcOptions.data.sessId = sessId);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * SubC 205\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param sessId\r\n     * @param rtcId\r\n     * @param subS\r\n     *            {memId:m001, rtcId:r001}\r\n     *\r\n     */\n    subC: function subC(rt, sessId, rtcId, subS, callback) {\n        _logger.debug(\"subC ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 205\n            }\n        };\n\n        sessId && (rtcOptions.data.sessId = sessId);\n        rtcId && (rtcOptions.data.rtcId = rtcId);\n        subS && (rtcOptions.data.subS = subS);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * UsubC 206\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param sessId\r\n     * @param rtcId\r\n     *\r\n     */\n    usubC: function usubC(rt, sessId, rtcId, callback) {\n        _logger.debug(\"usubC ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 206\n            }\n        };\n\n        sessId && (rtcOptions.data.sessId = sessId);\n        rtcId && (rtcOptions.data.rtcId = rtcId);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * TermC 107\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param sessId\r\n     * @param rtcId\r\n     * @param reason\r\n     *               \"ok\"      -> 'HANGUP'     \"success\" -> 'HANGUP'   \"timeout\"          -> 'NORESPONSE'\r\n     *               \"decline\" -> 'REJECT'     \"busy\"    -> 'BUSY'     \"failed-transport\" -> 'FAIL'\r\n     *\r\n     */\n    termC: function termC(rt, sessId, rtcId, reason, callback) {\n        _logger.debug(\"termC ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 107\n            }\n        };\n\n        sessId && (rtcOptions.data.sessId = sessId);\n        rtcId && (rtcOptions.data.rtcId = rtcId);\n        reason && (rtcOptions.reason = reason);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * Exit 201\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param WebRTCId\r\n     * @param sessId\r\n     * @param success(from,\r\n     *            rtcOptions)\r\n     *\r\n     */\n    exit: function exit(rt, WebRTCId, sessId, callback) {\n        _logger.debug(\"exit ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 201\n            }\n        };\n\n        WebRTCId && (rtcOptions.data.WebRTCId = WebRTCId);\n        sessId && (rtcOptions.data.sessId = sessId);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    },\n\n    /**\r\n     * DelCfr 2\r\n     *\r\n     * @param rt\r\n     *            {to: , rtKey: , rtflag: , success(result), fail(error)}\r\n     *\r\n     * @param callback(from, rtcOptions)\r\n     *\r\n     *\r\n     * @param WebRTCId\r\n     * @param admtok\r\n     * @param success(from,\r\n     *            rtcOptions)\r\n     *\r\n     */\n    delCfr: function delCfr(rt, WebRTCId, admtok, callback) {\n        _logger.debug(\"delCfr ...\");\n\n        var self = this;\n\n        var rtcOptions = {\n            data: {\n                op: 2\n            }\n        };\n\n        WebRTCId && (rtcOptions.data.WebRTCId = WebRTCId);\n        admtok && (rtcOptions.data.admtok = admtok);\n\n        self.rtcHandler.sendRtcMessage(rt, rtcOptions, callback);\n    }\n};\n\nexports.Api = function (initConfigs) {\n    var self = this;\n\n    _util.extend(true, this, _clazz, initConfigs || {});\n\n    function _onRecvRtcMessage(from, rtcOptions, rtkey, tsxId, fromSessionId) {\n        if (rtcOptions.result != 0 && self['onServerError']) {\n            self['onServerError'].call(self, from, rtcOptions, rtkey, tsxId, fromSessionId);\n        } else {\n            var onFunction;\n\n            if (self.events[rtcOptions.op] && (onFunction = self[self.events[rtcOptions.op]])) {\n                onFunction.call(self, from, rtcOptions, rtkey, tsxId, fromSessionId);\n            } else {\n                _logger.info(\"can not handle(recvRtcMessage) the op: \" + rtcOptions.op, rtcOptions);\n            }\n        }\n    }\n\n    this.rtcHandler.onRecvRtcMessage = _onRecvRtcMessage;\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjU1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnJ0Yy9zcmMvY29tcG9uZW50cy9hcGkuanM/YjA2MiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQVBJXHJcbiAqL1xyXG52YXIgX3V0aWwgPSByZXF1aXJlKCcuL3V0aWxzJyk7XHJcbnZhciBfbG9nZ2VyID0gX3V0aWwubG9nZ2VyO1xyXG5cclxuXHJcbnZhciBfUm91dGVUbyA9IHtcclxuICAgIC8vIHRvIDogbnVsbCxcclxuICAgIC8vIHJ0S2V5OiBudWxsLFxyXG4gICAgcnRGbGFnOiAxLFxyXG5cclxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuXHJcbiAgICB9LFxyXG4gICAgZmFpbDogZnVuY3Rpb24gKGVycm9yKSB7XHJcblxyXG4gICAgfVxyXG59O1xyXG5cclxudmFyIFJvdXRlVG8gPSBmdW5jdGlvbiAoZXh0ZW5kQ2ZnKSB7XHJcbiAgICBpZiAodGhpcyBpbnN0YW5jZW9mIFJvdXRlVG8pIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgX3V0aWwuZXh0ZW5kKHRydWUsIHNlbGYsIF9Sb3V0ZVRvLCBleHRlbmRDZmcgfHwge30pO1xyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdmFyIHN1YiA9IGZ1bmN0aW9uIChleHRlbmRDZmcpIHtcclxuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICBfdXRpbC5leHRlbmQodHJ1ZSwgc2VsZiwgZXh0ZW5kQ2ZnIHx8IHt9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBfdXRpbC5leHRlbmQodHJ1ZSwgc3ViLnByb3RvdHlwZSwgX1JvdXRlVG8sIGV4dGVuZENmZyB8fCB7fSk7XHJcblxyXG4gICAgICAgIHJldHVybiBzdWI7XHJcbiAgICB9XHJcbn07XHJcbmV4cG9ydHMuUm91dGVUbyA9IFJvdXRlVG87XHJcblxyXG5cclxudmFyIF9jbGF6eiA9IHtcclxuICAgIGltQ29ubmVjdGlvbjogbnVsbCxcclxuICAgIC8vIHdlYlJ0YzogbnVsbCxcclxuXHJcbiAgICBydGNIYW5kbGVyOiBudWxsLFxyXG5cclxuICAgIGV2ZW50czoge1xyXG4gICAgICAgICcwJzogJ29uUmVxUDJQJyxcclxuICAgICAgICAnMSc6ICdvbk5ld0NmcicsXHJcbiAgICAgICAgJzInOiAnb25EZWxDZnInLFxyXG4gICAgICAgICczJzogJ29uUmVxVGt0JyxcclxuXHJcbiAgICAgICAgJzEwMCc6ICdvblBpbmcnLFxyXG4gICAgICAgICcxMDEnOiAnb25Qb25nJyxcclxuICAgICAgICAnMTAyJzogJ29uSW5pdEMnLFxyXG4gICAgICAgICcxMDMnOiAnb25SZXFDJyxcclxuICAgICAgICAnMTA0JzogJ29uQWNwdEMnLFxyXG4gICAgICAgICcxMDUnOiAnb25UY2tsQycsXHJcbiAgICAgICAgJzEwNic6ICdvbkFuc0MnLFxyXG4gICAgICAgICcxMDcnOiAnb25UZXJtQycsXHJcblxyXG4gICAgICAgIC8vICcyMDAnIDogJ29uRW50ZXInLFxyXG4gICAgICAgIC8vICcyMDEnIDogJ29uRXhpdCcsXHJcbiAgICAgICAgLy8gJzIwMicgOiAnb25JbnZpdGUnLFxyXG4gICAgICAgIC8vICcyMDMnIDogJ29uR2V0TWVtcycsXHJcblxyXG4gICAgICAgIC8vICcyMDUnIDogJ29uU3ViQycsXHJcbiAgICAgICAgLy8gJzIwNicgOiAnb25Vc3ViQycsXHJcblxyXG4gICAgICAgICczMDAnOiAnb25FdkVudGVyJyxcclxuICAgICAgICAnMzAxJzogJ29uRXZFeGl0JyxcclxuICAgICAgICAnMzAyJzogJ29uRXZQdWInLFxyXG4gICAgICAgICczMDMnOiAnb25FdlVucHViJyxcclxuICAgICAgICAnMzA0JzogJ29uRXZNZW1zJyxcclxuICAgICAgICAnMjA0JzogJ29uRXZDbG9zZScsXHJcbiAgICAgICAgJzQwMCc6ICdvblN0cmVhbUNvbnRyb2wnLFxyXG4gICAgICAgICc0MDEnOiAnb25FdkpvaW4nLFxyXG5cclxuICAgICAgICAnb25TZXJ2ZXJFcnJvcic6ICdvblNlcnZlckVycm9yJ1xyXG4gICAgfSxcclxuXHJcbiAgICByZWdpc3RlcjogZnVuY3Rpb24gKGxpc3RlbmVyKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lciA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBldmVudCBpbiBsaXN0ZW5lcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iaW5kKGV2ZW50LCBsaXN0ZW5lcltldmVudF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBiaW5kOiBmdW5jdGlvbiAoZXZlbnQsIGZ1bmMpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciBvbkZ1bmM7XHJcbiAgICAgICAgaWYgKChvbkZ1bmMgPSBzZWxmLmV2ZW50c1tldmVudF0pKSB7XHJcbiAgICAgICAgICAgIHNlbGZbb25GdW5jXSA9IGZ1bmM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb25GdW5jID0gc2VsZi5ldmVudHNbZXZlbnRdID0gJ29uXycgKyBldmVudDtcclxuICAgICAgICAgICAgc2VsZltvbkZ1bmNdID0gZnVuYztcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIGppZDogZnVuY3Rpb24gKHNob3J0VXNlck5hbWUpIHtcclxuICAgICAgICBpZigvXi4rIy4rXy4rQC4rJC9nLnRlc3Qoc2hvcnRVc2VyTmFtZSkpe1xyXG4gICAgICAgICAgICByZXR1cm4gc2hvcnRVc2VyTmFtZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYgKHNob3J0VXNlck5hbWUuaW5kZXhPZih0aGlzLmltQ29ubmVjdGlvbi5jb250ZXh0LmFwcEtleSkgPj0gMCkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gc2hvcnRVc2VyTmFtZTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW1Db25uZWN0aW9uLmNvbnRleHQuYXBwS2V5ICsgXCJfXCIgKyBzaG9ydFVzZXJOYW1lICsgXCJAXCIgKyB0aGlzLmltQ29ubmVjdGlvbi5kb21haW47XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVxUDJQIDBcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcnRcclxuICAgICAqICAgICAgICAgICAge3RvOiAsIHJ0S2V5OiAsIHJ0ZmxhZzogLCBzdWNjZXNzKHJlc3VsdCksIGZhaWwoZXJyb3IpfVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayhmcm9tLCBydGNPcHRpb25zKVxyXG4gICAgICpcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdmlkZW9cclxuICAgICAqICAgICAgICAgICAgMSAwXHJcbiAgICAgKiBAcGFyYW0gYXVkaW9cclxuICAgICAqICAgICAgICAgICAgMSAwXHJcbiAgICAgKiBAcGFyYW0gcGVlclxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgcmVxUDJQOiBmdW5jdGlvbiAocnQsIHZpZGVvLCBhdWRpbywgcGVlciwgY2FsbGJhY2spIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKFwicmVxIHAycCAuLi5cIik7XHJcblxyXG5cclxuICAgICAgICB2YXIgcnRjT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgb3A6IDAsXHJcbiAgICAgICAgICAgICAgICB2aWRlbzogdmlkZW8sXHJcbiAgICAgICAgICAgICAgICBhdWRpbzogYXVkaW8sXHJcbiAgICAgICAgICAgICAgICBwZWVyOiBwZWVyIC8vIGFwcEtleSArIFwiX1wiICsgY3VyQ2hhdFVzZXJJZCArIFwiQFwiICsgdGhpcy5kb21haW4sXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLnJ0Y0hhbmRsZXIuc2VuZFJ0Y01lc3NhZ2UocnQsIHJ0Y09wdGlvbnMsIGNhbGxiYWNrKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBOZXdDZnIgMVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBydFxyXG4gICAgICogICAgICAgICAgICB7dG86ICwgcnRLZXk6ICwgcnRmbGFnOiAsIHN1Y2Nlc3MocmVzdWx0KSwgZmFpbChlcnJvcil9XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrKGZyb20sIHJ0Y09wdGlvbnMpXHJcbiAgICAgKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSByZXFUa3RcclxuICAgICAqICAgICAgICAgICAgMSBudWxsXHJcbiAgICAgKiBAcGFyYW0gcGFzc3dvcmRcclxuICAgICAqICAgICAgICAgICAgc3RyaW5nIG51bGxcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIG5ld0NmcjogZnVuY3Rpb24gKHJ0LCByZXFUa3QsIHBhc3N3b3JkLCBjYWxsYmFjaykge1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoXCJuZXdDZnIgLi4uXCIpO1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciBydGNPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBvcDogMVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmVxVGt0ICYmIChydGNPcHRpb25zLmRhdGEucmVxVGt0ID0gcmVxVGt0KTtcclxuICAgICAgICBwYXNzd29yZCAmJiAocnRjT3B0aW9ucy5kYXRhLnBhc3N3b3JkID0gcGFzc3dvcmQpO1xyXG5cclxuICAgICAgICBzZWxmLnJ0Y0hhbmRsZXIuc2VuZFJ0Y01lc3NhZ2UocnQsIHJ0Y09wdGlvbnMsIGNhbGxiYWNrKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFbnRlciAyMDBcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcnRcclxuICAgICAqICAgICAgICAgICAge3RvOiAsIHJ0S2V5OiAsIHJ0ZmxhZzogLCBzdWNjZXNzKHJlc3VsdCksIGZhaWwoZXJyb3IpfVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayhmcm9tLCBydGNPcHRpb25zKVxyXG4gICAgICpcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gV2ViUlRDSWRcclxuICAgICAqIEBwYXJhbSByZXFNZW1iZXJzICE9XHJcbiAgICAgKiAgICAgICAgICAgIDAgbWVtYmVyc1xyXG4gICAgICogQHBhcmFtIHRrdFxyXG4gICAgICogQHBhcmFtIG5vbmNlXHJcbiAgICAgKiBAcGFyYW0gZGlnZXN0XHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBlbnRlcjogZnVuY3Rpb24gKHJ0LCBXZWJSVENJZCwgcmVxTWVtYmVycywgdGt0LCBub25jZSwgZGlnZXN0LCBjYWxsYmFjaykge1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoXCJlbnRlciAuLi5cIik7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIHJ0Y09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgIG9wOiAyMDBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIFdlYlJUQ0lkICYmIChydGNPcHRpb25zLmRhdGEuV2ViUlRDSWQgPSBXZWJSVENJZCk7XHJcbiAgICAgICAgcmVxTWVtYmVycyAmJiAocnRjT3B0aW9ucy5kYXRhLnJlcU1lbWJlcnMgPSByZXFNZW1iZXJzKTtcclxuICAgICAgICB0a3QgJiYgKHJ0Y09wdGlvbnMuZGF0YS50a3QgPSB0a3QpO1xyXG4gICAgICAgIG5vbmNlICYmIChydGNPcHRpb25zLmRhdGEubm9uY2UgPSBub25jZSk7XHJcbiAgICAgICAgZGlnZXN0ICYmIChydGNPcHRpb25zLmRhdGEuZGlnZXN0ID0gZGlnZXN0KTtcclxuXHJcbiAgICAgICAgc2VsZi5ydGNIYW5kbGVyLnNlbmRSdGNNZXNzYWdlKHJ0LCBydGNPcHRpb25zLCBjYWxsYmFjayk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUGluZyAxMDBcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcnRcclxuICAgICAqICAgICAgICAgICAge3RvOiAsIHJ0S2V5OiAsIHJ0ZmxhZzogLCBzdWNjZXNzKHJlc3VsdCksIGZhaWwoZXJyb3IpfVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayhmcm9tLCBydGNPcHRpb25zKVxyXG4gICAgICpcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc2Vzc0lkXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBwaW5nOiBmdW5jdGlvbiAocnQsIHNlc3NJZCwgY2FsbGJhY2spIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKFwicGluZyAuLi5cIik7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIHJ0Y09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgIG9wOiAxMDBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNlc3NJZCAmJiAocnRjT3B0aW9ucy5kYXRhLnNlc3NJZCA9IHNlc3NJZCk7XHJcblxyXG4gICAgICAgIHNlbGYucnRjSGFuZGxlci5zZW5kUnRjTWVzc2FnZShydCwgcnRjT3B0aW9ucywgY2FsbGJhY2spO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIOmAmuefpeWvueaWuSDmiJHlt7Lnu4/lhbPpl60v5omT5byAIOm6puWNoe+8jOaRhOWDj+WktFxyXG4gICAgICpcclxuICAgICAqIFBBVVNFX1ZPSUNFKDAsIDApLCBSRVNVTUVfVk9JQ0UoMSwgMSksIFBBVVNFX1ZJREVPKDIsIDIpLCBSRVNVTUVfVklERU8oMywgMylcclxuICAgICAqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHJ0XHJcbiAgICAgKiBAcGFyYW0gc2Vzc0lkXHJcbiAgICAgKiBAcGFyYW0gcnRjSWRcclxuICAgICAqIEBwYXJhbSBjb250cm9sVHlwZVxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrXHJcbiAgICAgKi9cclxuICAgIHN0cmVhbUNvbnRyb2w6IGZ1bmN0aW9uIChydCwgc2Vzc0lkLCBydGNJZCwgY29udHJvbFR5cGUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZyhcInN0cmVhbUNvbnRyb2wgLi4uXCIpO1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciBydGNPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBvcDogNDAwXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzZXNzSWQgJiYgKHJ0Y09wdGlvbnMuZGF0YS5zZXNzSWQgPSBzZXNzSWQpO1xyXG4gICAgICAgIHJ0Y0lkICYmIChydGNPcHRpb25zLmRhdGEucnRjSWQgPSBydGNJZCk7XHJcbiAgICAgICAgKHR5cGVvZiBjb250cm9sVHlwZSAhPT0gJ3VuZGVmaW5lZCcgJiYgIGNvbnRyb2xUeXBlICE9IG51bGwgKSAmJiAocnRjT3B0aW9ucy5kYXRhLmNvbnRyb2xUeXBlID0gY29udHJvbFR5cGUpO1xyXG5cclxuICAgICAgICBzZWxmLnJ0Y0hhbmRsZXIuc2VuZFJ0Y01lc3NhZ2UocnQsIHJ0Y09wdGlvbnMsIGNhbGxiYWNrKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXFUa3QgM1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBydFxyXG4gICAgICogICAgICAgICAgICB7dG86ICwgcnRLZXk6ICwgcnRmbGFnOiAsIHN1Y2Nlc3MocmVzdWx0KSwgZmFpbChlcnJvcil9XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrKGZyb20sIHJ0Y09wdGlvbnMpXHJcbiAgICAgKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBXZWJSVENJZFxyXG4gICAgICogQHBhcmFtIHN1Y2Nlc3MoZnJvbSxcclxuICAgICAqICAgICAgICAgICAgcnRjT3B0aW9ucylcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIHJlcVRrdDogZnVuY3Rpb24gKHJ0LCBXZWJSVENJZCwgY2FsbGJhY2spIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKFwicmVxVGt0IC4uLlwiKTtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgcnRjT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgb3A6IDNcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIFdlYlJUQ0lkICYmIChydGNPcHRpb25zLmRhdGEuV2ViUlRDSWQgPSBXZWJSVENJZCk7XHJcblxyXG4gICAgICAgIHNlbGYucnRjSGFuZGxlci5zZW5kUnRjTWVzc2FnZShydCwgcnRjT3B0aW9ucywgY2FsbGJhY2spO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIEluaXRDIDEwMlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBydFxyXG4gICAgICogICAgICAgICAgICB7dG86ICwgcnRLZXk6ICwgcnRmbGFnOiAsIHN1Y2Nlc3MocmVzdWx0KSwgZmFpbChlcnJvcil9XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrKGZyb20sIHJ0Y09wdGlvbnMpXHJcbiAgICAgKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBXZWJSVENJZFxyXG4gICAgICogQHBhcmFtIHRrdFxyXG4gICAgICogQHBhcmFtIHNlc3NJZFxyXG4gICAgICogQHBhcmFtIHJ0Y0lkXHJcbiAgICAgKiBAcGFyYW0gcHViU1xyXG4gICAgICogICAgICAgICAgICB7bmFtZTogc3RyZWFtTmFtZSwgdmlkZW86MSwgYXVkaW86MSwgdHlwZTogMH1cclxuICAgICAqIEBwYXJhbSBzdWJTXHJcbiAgICAgKiAgICAgICAgICAgIHttZW1JZDogLCBydGNJZDogfVxyXG4gICAgICogQHBhcmFtIHNkcFxyXG4gICAgICogICAgICAgICAgICBzZHA6c2Rwc3RyaW5nXHJcbiAgICAgKiBAcGFyYW0gY2FuZHMgWyBdXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBpbml0QzogZnVuY3Rpb24gKHJ0LCBzdHJlYW1UeXBlLCBXZWJSVENJZCwgdGt0LCBzZXNzSWQsIHJ0Y0lkLCBwdWJTLCBzdWJTLCBzZHAsIGNhbmRzLCBydGNDZmcsIFdlYlJUQywgY2FsbGJhY2spIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKFwiaW5pdEMgLi4uXCIpO1xyXG5cclxuXHJcbiAgICAgICAgdmFyIHJ0Y09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgIG9wOiAxMDJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJ0Y09wdGlvbnMuc3RyZWFtVHlwZSA9IHN0cmVhbVR5cGUgfHwgXCJWSURFT1wiO1xyXG5cclxuICAgICAgICBXZWJSVENJZCAmJiAocnRjT3B0aW9ucy5kYXRhLldlYlJUQ0lkID0gV2ViUlRDSWQpO1xyXG4gICAgICAgIHRrdCAmJiAocnRjT3B0aW9ucy5kYXRhLnRrdCA9IHRrdCk7XHJcbiAgICAgICAgc2Vzc0lkICYmIChydGNPcHRpb25zLmRhdGEuc2Vzc0lkID0gc2Vzc0lkKTtcclxuICAgICAgICBydGNJZCAmJiAocnRjT3B0aW9ucy5kYXRhLnJ0Y0lkID0gcnRjSWQpO1xyXG4gICAgICAgIHB1YlMgJiYgKHJ0Y09wdGlvbnMuZGF0YS5wdWJTID0gcHViUyk7XHJcbiAgICAgICAgc3ViUyAmJiAocnRjT3B0aW9ucy5kYXRhLnN1YlMgPSBzdWJTKTtcclxuICAgICAgICBzZHAgJiYgKHJ0Y09wdGlvbnMuZGF0YS5zZHAgPSBzZHApO1xyXG4gICAgICAgIGNhbmRzICYmIChydGNPcHRpb25zLmRhdGEuY2FuZHMgPSBjYW5kcyk7XHJcbiAgICAgICAgcnRjQ2ZnICYmIChydGNPcHRpb25zLmRhdGEucnRjQ2ZnID0gcnRjQ2ZnKTtcclxuICAgICAgICBXZWJSVEMgJiYgKHJ0Y09wdGlvbnMuZGF0YS5XZWJSVEMgPSBXZWJSVEMpO1xyXG5cclxuICAgICAgICB0aGlzLnJ0Y0hhbmRsZXIuc2VuZFJ0Y01lc3NhZ2UocnQsIHJ0Y09wdGlvbnMsIGNhbGxiYWNrKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBUY2tsQyAxMDVcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcnRcclxuICAgICAqICAgICAgICAgICAge3RvOiAsIHJ0S2V5OiAsIHJ0ZmxhZzogLCBzdWNjZXNzKHJlc3VsdCksIGZhaWwoZXJyb3IpfVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayhmcm9tLCBydGNPcHRpb25zKVxyXG4gICAgICpcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc2Vzc0lkXHJcbiAgICAgKiBAcGFyYW0gcnRjSWRcclxuICAgICAqIEBwYXJhbSBjYW5kc1xyXG4gICAgICogQHBhcmFtIHN1Y2Nlc3MoZnJvbSxcclxuICAgICAqICAgICAgICAgICAgcnRjT3B0aW9ucylcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIHRja2xDOiBmdW5jdGlvbiAocnQsIHNlc3NJZCwgcnRjSWQsIHNkcCwgY2FuZHMsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZyhcInRja2xDIC4uLlwiKTtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgcnRjT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgb3A6IDEwNVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2Vzc0lkICYmIChydGNPcHRpb25zLmRhdGEuc2Vzc0lkID0gc2Vzc0lkKTtcclxuICAgICAgICBydGNJZCAmJiAocnRjT3B0aW9ucy5kYXRhLnJ0Y0lkID0gcnRjSWQpO1xyXG4gICAgICAgIHNkcCAmJiAocnRjT3B0aW9ucy5kYXRhLnNkcCA9IHNkcCk7XHJcbiAgICAgICAgY2FuZHMgJiYgKHJ0Y09wdGlvbnMuZGF0YS5jYW5kcyA9IGNhbmRzKTtcclxuXHJcbiAgICAgICAgc2VsZi5ydGNIYW5kbGVyLnNlbmRSdGNNZXNzYWdlKHJ0LCBydGNPcHRpb25zLCBjYWxsYmFjayk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQW5zQyAxMDZcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcnRcclxuICAgICAqICAgICAgICAgICAge3RvOiAsIHJ0S2V5OiAsIHJ0ZmxhZzogLCBzdWNjZXNzKHJlc3VsdCksIGZhaWwoZXJyb3IpfVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayhmcm9tLCBydGNPcHRpb25zKVxyXG4gICAgICpcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc2Vzc0lkXHJcbiAgICAgKiBAcGFyYW0gcnRjSWRcclxuICAgICAqIEBwYXJhbSBzZHBcclxuICAgICAqIEBwYXJhbSBjYW5kc1xyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgYW5zQzogZnVuY3Rpb24gKHJ0LCBzZXNzSWQsIHJ0Y0lkLCBzZHAsIGNhbmRzLCBjYWxsYmFjaywgZW5hYmxlVm9pY2UsIGVuYWJsZVZpZGVvKSB7XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZyhcImFuc0MgLi4uXCIpO1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciBydGNPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBvcDogMTA2XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzZXNzSWQgJiYgKHJ0Y09wdGlvbnMuZGF0YS5zZXNzSWQgPSBzZXNzSWQpO1xyXG4gICAgICAgIHJ0Y0lkICYmIChydGNPcHRpb25zLmRhdGEucnRjSWQgPSBydGNJZCk7XHJcbiAgICAgICAgc2RwICYmIChydGNPcHRpb25zLmRhdGEuc2RwID0gc2RwKTtcclxuICAgICAgICBjYW5kcyAmJiAocnRjT3B0aW9ucy5kYXRhLmNhbmRzID0gY2FuZHMpO1xyXG5cclxuICAgICAgICBlbmFibGVWb2ljZSA9PT0gZmFsc2UgJiYgKHJ0Y09wdGlvbnMuZGF0YS5lbmFibGVWb2ljZSA9IGVuYWJsZVZvaWNlKTtcclxuICAgICAgICBlbmFibGVWaWRlbyA9PT0gZmFsc2UgJiYgKHJ0Y09wdGlvbnMuZGF0YS5lbmFibGVWaWRlbyA9IGVuYWJsZVZpZGVvKTtcclxuXHJcblxyXG5cclxuICAgICAgICAvLyBydGNPcHRpb25zLmRhdGEuZW5hYmxlVm9pY2UgPSBmYWxzZTtcclxuICAgICAgICAvLyBydGNPcHRpb25zLmRhdGEuZW5hYmxlVmlkZW8gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgc2VsZi5ydGNIYW5kbGVyLnNlbmRSdGNNZXNzYWdlKHJ0LCBydGNPcHRpb25zLCBjYWxsYmFjayk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQWNwdEMgMTA0XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHJ0XHJcbiAgICAgKiAgICAgICAgICAgIHt0bzogLCBydEtleTogLCBydGZsYWc6ICwgc3VjY2VzcyhyZXN1bHQpLCBmYWlsKGVycm9yKX1cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2soZnJvbSwgcnRjT3B0aW9ucylcclxuICAgICAqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHNlc3NJZFxyXG4gICAgICogQHBhcmFtIHJ0Y0lkXHJcbiAgICAgKiBAcGFyYW0gc2RwXHJcbiAgICAgKiBAcGFyYW0gYW5zXHJcbiAgICAgKiAgICAgICAgICAgIDFcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIGFjcHRDOiBmdW5jdGlvbiAocnQsIHNlc3NJZCwgcnRjSWQsIHNkcCwgY2FuZHMsIGFucywgY2FsbGJhY2ssIGVuYWJsZVZvaWNlLCBlbmFibGVWaWRlbykge1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoXCJhY3B0QyAuLi5cIik7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIHJ0Y09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgIG9wOiAxMDRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNlc3NJZCAmJiAocnRjT3B0aW9ucy5kYXRhLnNlc3NJZCA9IHNlc3NJZCk7XHJcbiAgICAgICAgcnRjSWQgJiYgKHJ0Y09wdGlvbnMuZGF0YS5ydGNJZCA9IHJ0Y0lkKTtcclxuICAgICAgICBzZHAgJiYgKHJ0Y09wdGlvbnMuZGF0YS5zZHAgPSBzZHApO1xyXG4gICAgICAgIGNhbmRzICYmIChydGNPcHRpb25zLmRhdGEuY2FuZHMgPSBjYW5kcyk7XHJcbiAgICAgICAgYW5zICYmIChydGNPcHRpb25zLmRhdGEuYW5zID0gYW5zKTtcclxuXHJcbiAgICAgICAgZW5hYmxlVm9pY2UgPT09IGZhbHNlICYmIChydGNPcHRpb25zLmRhdGEuZW5hYmxlVm9pY2UgPSBlbmFibGVWb2ljZSk7XHJcbiAgICAgICAgZW5hYmxlVmlkZW8gPT09IGZhbHNlICYmIChydGNPcHRpb25zLmRhdGEuZW5hYmxlVmlkZW8gPSBlbmFibGVWaWRlbyk7XHJcblxyXG4gICAgICAgIC8vIHJ0Y09wdGlvbnMuZGF0YS5lbmFibGVWb2ljZSA9IGZhbHNlO1xyXG4gICAgICAgIC8vIHJ0Y09wdGlvbnMuZGF0YS5lbmFibGVWaWRlbyA9IGZhbHNlO1xyXG5cclxuICAgICAgICBzZWxmLnJ0Y0hhbmRsZXIuc2VuZFJ0Y01lc3NhZ2UocnQsIHJ0Y09wdGlvbnMsIGNhbGxiYWNrKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRNZW1zIDIwM1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBydFxyXG4gICAgICogICAgICAgICAgICB7dG86ICwgcnRLZXk6ICwgcnRmbGFnOiAsIHN1Y2Nlc3MocmVzdWx0KSwgZmFpbChlcnJvcil9XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrKGZyb20sIHJ0Y09wdGlvbnMpXHJcbiAgICAgKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBXZWJSVENJZFxyXG4gICAgICogQHBhcmFtIHNlc3NJZFxyXG4gICAgICogQHBhcmFtIHN1Y2Nlc3MoZnJvbSxcclxuICAgICAqICAgICAgICAgICAgcnRjT3B0aW9ucylcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIGdldE1lbXM6IGZ1bmN0aW9uIChydCwgV2ViUlRDSWQsIHNlc3NJZCwgY2FsbGJhY2spIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKFwiZ2V0TWVtcyAuLi5cIik7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIHJ0Y09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgIG9wOiAyMDNcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIFdlYlJUQ0lkICYmIChydGNPcHRpb25zLmRhdGEuV2ViUlRDSWQgPSBXZWJSVENJZCk7XHJcbiAgICAgICAgc2Vzc0lkICYmIChydGNPcHRpb25zLmRhdGEuc2Vzc0lkID0gc2Vzc0lkKTtcclxuXHJcbiAgICAgICAgc2VsZi5ydGNIYW5kbGVyLnNlbmRSdGNNZXNzYWdlKHJ0LCBydGNPcHRpb25zLCBjYWxsYmFjayk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3ViQyAyMDVcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcnRcclxuICAgICAqICAgICAgICAgICAge3RvOiAsIHJ0S2V5OiAsIHJ0ZmxhZzogLCBzdWNjZXNzKHJlc3VsdCksIGZhaWwoZXJyb3IpfVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayhmcm9tLCBydGNPcHRpb25zKVxyXG4gICAgICpcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc2Vzc0lkXHJcbiAgICAgKiBAcGFyYW0gcnRjSWRcclxuICAgICAqIEBwYXJhbSBzdWJTXHJcbiAgICAgKiAgICAgICAgICAgIHttZW1JZDptMDAxLCBydGNJZDpyMDAxfVxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgc3ViQzogZnVuY3Rpb24gKHJ0LCBzZXNzSWQsIHJ0Y0lkLCBzdWJTLCBjYWxsYmFjaykge1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoXCJzdWJDIC4uLlwiKTtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgcnRjT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgb3A6IDIwNVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2Vzc0lkICYmIChydGNPcHRpb25zLmRhdGEuc2Vzc0lkID0gc2Vzc0lkKTtcclxuICAgICAgICBydGNJZCAmJiAocnRjT3B0aW9ucy5kYXRhLnJ0Y0lkID0gcnRjSWQpO1xyXG4gICAgICAgIHN1YlMgJiYgKHJ0Y09wdGlvbnMuZGF0YS5zdWJTID0gc3ViUyk7XHJcblxyXG4gICAgICAgIHNlbGYucnRjSGFuZGxlci5zZW5kUnRjTWVzc2FnZShydCwgcnRjT3B0aW9ucywgY2FsbGJhY2spO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIFVzdWJDIDIwNlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBydFxyXG4gICAgICogICAgICAgICAgICB7dG86ICwgcnRLZXk6ICwgcnRmbGFnOiAsIHN1Y2Nlc3MocmVzdWx0KSwgZmFpbChlcnJvcil9XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrKGZyb20sIHJ0Y09wdGlvbnMpXHJcbiAgICAgKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzZXNzSWRcclxuICAgICAqIEBwYXJhbSBydGNJZFxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgdXN1YkM6IGZ1bmN0aW9uIChydCwgc2Vzc0lkLCBydGNJZCwgY2FsbGJhY2spIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKFwidXN1YkMgLi4uXCIpO1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciBydGNPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBvcDogMjA2XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzZXNzSWQgJiYgKHJ0Y09wdGlvbnMuZGF0YS5zZXNzSWQgPSBzZXNzSWQpO1xyXG4gICAgICAgIHJ0Y0lkICYmIChydGNPcHRpb25zLmRhdGEucnRjSWQgPSBydGNJZCk7XHJcblxyXG4gICAgICAgIHNlbGYucnRjSGFuZGxlci5zZW5kUnRjTWVzc2FnZShydCwgcnRjT3B0aW9ucywgY2FsbGJhY2spO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIFRlcm1DIDEwN1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBydFxyXG4gICAgICogICAgICAgICAgICB7dG86ICwgcnRLZXk6ICwgcnRmbGFnOiAsIHN1Y2Nlc3MocmVzdWx0KSwgZmFpbChlcnJvcil9XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrKGZyb20sIHJ0Y09wdGlvbnMpXHJcbiAgICAgKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzZXNzSWRcclxuICAgICAqIEBwYXJhbSBydGNJZFxyXG4gICAgICogQHBhcmFtIHJlYXNvblxyXG4gICAgICogICAgICAgICAgICAgICBcIm9rXCIgICAgICAtPiAnSEFOR1VQJyAgICAgXCJzdWNjZXNzXCIgLT4gJ0hBTkdVUCcgICBcInRpbWVvdXRcIiAgICAgICAgICAtPiAnTk9SRVNQT05TRSdcclxuICAgICAqICAgICAgICAgICAgICAgXCJkZWNsaW5lXCIgLT4gJ1JFSkVDVCcgICAgIFwiYnVzeVwiICAgIC0+ICdCVVNZJyAgICAgXCJmYWlsZWQtdHJhbnNwb3J0XCIgLT4gJ0ZBSUwnXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICB0ZXJtQzogZnVuY3Rpb24gKHJ0LCBzZXNzSWQsIHJ0Y0lkLCByZWFzb24sIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZyhcInRlcm1DIC4uLlwiKTtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgcnRjT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgb3A6IDEwN1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2Vzc0lkICYmIChydGNPcHRpb25zLmRhdGEuc2Vzc0lkID0gc2Vzc0lkKTtcclxuICAgICAgICBydGNJZCAmJiAocnRjT3B0aW9ucy5kYXRhLnJ0Y0lkID0gcnRjSWQpO1xyXG4gICAgICAgIHJlYXNvbiAmJiAocnRjT3B0aW9ucy5yZWFzb24gPSByZWFzb24pO1xyXG5cclxuICAgICAgICBzZWxmLnJ0Y0hhbmRsZXIuc2VuZFJ0Y01lc3NhZ2UocnQsIHJ0Y09wdGlvbnMsIGNhbGxiYWNrKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeGl0IDIwMVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBydFxyXG4gICAgICogICAgICAgICAgICB7dG86ICwgcnRLZXk6ICwgcnRmbGFnOiAsIHN1Y2Nlc3MocmVzdWx0KSwgZmFpbChlcnJvcil9XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrKGZyb20sIHJ0Y09wdGlvbnMpXHJcbiAgICAgKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBXZWJSVENJZFxyXG4gICAgICogQHBhcmFtIHNlc3NJZFxyXG4gICAgICogQHBhcmFtIHN1Y2Nlc3MoZnJvbSxcclxuICAgICAqICAgICAgICAgICAgcnRjT3B0aW9ucylcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIGV4aXQ6IGZ1bmN0aW9uIChydCwgV2ViUlRDSWQsIHNlc3NJZCwgY2FsbGJhY2spIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKFwiZXhpdCAuLi5cIik7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIHJ0Y09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgIG9wOiAyMDFcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIFdlYlJUQ0lkICYmIChydGNPcHRpb25zLmRhdGEuV2ViUlRDSWQgPSBXZWJSVENJZCk7XHJcbiAgICAgICAgc2Vzc0lkICYmIChydGNPcHRpb25zLmRhdGEuc2Vzc0lkID0gc2Vzc0lkKTtcclxuXHJcbiAgICAgICAgc2VsZi5ydGNIYW5kbGVyLnNlbmRSdGNNZXNzYWdlKHJ0LCBydGNPcHRpb25zLCBjYWxsYmFjayk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRGVsQ2ZyIDJcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcnRcclxuICAgICAqICAgICAgICAgICAge3RvOiAsIHJ0S2V5OiAsIHJ0ZmxhZzogLCBzdWNjZXNzKHJlc3VsdCksIGZhaWwoZXJyb3IpfVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayhmcm9tLCBydGNPcHRpb25zKVxyXG4gICAgICpcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gV2ViUlRDSWRcclxuICAgICAqIEBwYXJhbSBhZG10b2tcclxuICAgICAqIEBwYXJhbSBzdWNjZXNzKGZyb20sXHJcbiAgICAgKiAgICAgICAgICAgIHJ0Y09wdGlvbnMpXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBkZWxDZnI6IGZ1bmN0aW9uIChydCwgV2ViUlRDSWQsIGFkbXRvaywgY2FsbGJhY2spIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKFwiZGVsQ2ZyIC4uLlwiKTtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgcnRjT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgb3A6IDJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIFdlYlJUQ0lkICYmIChydGNPcHRpb25zLmRhdGEuV2ViUlRDSWQgPSBXZWJSVENJZCk7XHJcbiAgICAgICAgYWRtdG9rICYmIChydGNPcHRpb25zLmRhdGEuYWRtdG9rID0gYWRtdG9rKTtcclxuXHJcbiAgICAgICAgc2VsZi5ydGNIYW5kbGVyLnNlbmRSdGNNZXNzYWdlKHJ0LCBydGNPcHRpb25zLCBjYWxsYmFjayk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5leHBvcnRzLkFwaSA9IGZ1bmN0aW9uIChpbml0Q29uZmlncykge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgIF91dGlsLmV4dGVuZCh0cnVlLCB0aGlzLCBfY2xhenosIGluaXRDb25maWdzIHx8IHt9KTtcclxuXHJcblxyXG4gICAgZnVuY3Rpb24gX29uUmVjdlJ0Y01lc3NhZ2UoZnJvbSwgcnRjT3B0aW9ucywgcnRrZXksIHRzeElkLCBmcm9tU2Vzc2lvbklkKSB7XHJcbiAgICAgICAgaWYgKHJ0Y09wdGlvbnMucmVzdWx0ICE9IDAgJiYgc2VsZlsnb25TZXJ2ZXJFcnJvciddKSB7XHJcbiAgICAgICAgICAgIHNlbGZbJ29uU2VydmVyRXJyb3InXS5jYWxsKHNlbGYsIGZyb20sIHJ0Y09wdGlvbnMsIHJ0a2V5LCB0c3hJZCwgZnJvbVNlc3Npb25JZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIG9uRnVuY3Rpb247XHJcblxyXG4gICAgICAgICAgICBpZiAoc2VsZi5ldmVudHNbcnRjT3B0aW9ucy5vcF0gJiYgKG9uRnVuY3Rpb24gPSBzZWxmW3NlbGYuZXZlbnRzW3J0Y09wdGlvbnMub3BdXSkpIHtcclxuICAgICAgICAgICAgICAgIG9uRnVuY3Rpb24uY2FsbChzZWxmLCBmcm9tLCBydGNPcHRpb25zLCBydGtleSwgdHN4SWQsIGZyb21TZXNzaW9uSWQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX2xvZ2dlci5pbmZvKFwiY2FuIG5vdCBoYW5kbGUocmVjdlJ0Y01lc3NhZ2UpIHRoZSBvcDogXCIgKyBydGNPcHRpb25zLm9wLCBydGNPcHRpb25zKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnJ0Y0hhbmRsZXIub25SZWN2UnRjTWVzc2FnZSA9IF9vblJlY3ZSdGNNZXNzYWdlO1xyXG59O1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicnRjL3NyYy9jb21wb25lbnRzL2FwaS5qcyJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBOzs7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQVJBO0FBQ0E7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBaENBO0FBQ0E7QUFrQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQkE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFEQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7OztBQWVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQURBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBREE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFEQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFEQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFEQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBc0JBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQURBO0FBREE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBREE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O0FBZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBREE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFEQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7OztBQWVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQURBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O0FBZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBREE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFEQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBREE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7OztBQWVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQURBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O0FBZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBREE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUExbUJBO0FBQ0E7QUE0bUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ 256:
/***/ (function(module, exports, __webpack_require__) {

	eval("\"use strict\";\n\n/**\r\n * WebRTC\r\n *\r\n *                              A                   |                                       B\r\n *                                                  |\r\n *   1.createMedia:got streamA                      | 1.createMedia:got streamB\r\n *   2.new RTCPeerConnection: APeerConnection       | 2.new RTCPeerConnection: BPeerConnection\r\n *   3.APeerConnection.createOffer:got offerA       |\r\n *      APeerConnection.setLocalDescription(offerA) |\r\n *      send offerA ---> ---> ---> --->        ---> |\r\n *                                                  | ---> 3.got offerA | offerA = new RTCSessionDescription(offerA);\r\n *                                                  | BPeerConnection.setRemoteDescription(offerA)\r\n *                                                  |\r\n *                                                  |\r\n *                                                  | 4.BPeerConnection.createAnswer: got answerB\r\n *                                                  | BPeerConnection.setLocalDescription(answerB)\r\n *                                                  | <---- send answerB\r\n *                                                  | 5.got answerB <--- <--- <--- <---\r\n *                                                  | answerB = new RTCSessionDescription(answerB)\r\n *                                                  |\r\n * APeerConnection.setRemoteDescription(answerB)    |\r\n *                                                  |\r\n * 6.got candidateA ---> --->  ---> --->            | ---> got candidateA\r\n *                                                  | BPeerConnection.addIceCandidate(new RTCIceCandidate(candidateA))\r\n *                                                  |\r\n *                                                  |\r\n *                                                  | got candidateB <--- <--- <--- <---\r\n *                                                  | <--- 6.got candidateB APeerConnection.addIceCandidate(candidateB)\r\n *                                                  |\r\n *                                                  |\r\n *                                                  | 7. APeerConnection.addStream(streamA)\r\n *                                                  | 7.BPeerConnection.addStream(streamB)\r\n *                                                  |\r\n *                              streamA >>>>>>>>>>> |  <<<<< see A\r\n *                              seeB <<<<<<<<<<<    | <<<<< streamB\r\n *                                                  |\r\n *\r\n */\nvar _util = __webpack_require__(252);\nvar _logger = _util.logger;\n\nvar _WebrtcStatistics = {\n    bytesPrev: null,\n    timestampPrev: null,\n    sentBytesPrev: null,\n    sentTimestampPrev: null,\n\n    printStats: function printStats(rtcPeerConnection) {\n        var self = this;\n\n        rtcPeerConnection.getStats(null, function (results) {\n            self.parseRecvStatistics(results, function (name, value) {\n                _logger.info(new Date(), \"RECV \", name, value);\n            }, function (name, value) {\n                _logger.info(new Date(), \"SEND \", name, value);\n            });\n        });\n    },\n\n    stopIntervalPrintStats: function stopIntervalPrintStats() {\n        var self = this;\n\n        self._printIntervalId && window.clearInterval(self._printIntervalId);\n        self._printIntervalId = null;\n    },\n\n    intervalPrintStats: function intervalPrintStats(rtcPeerConnection, seconds) {},\n\n    _intervalPrintStats: function _intervalPrintStats(rtcPeerConnection, seconds) {\n        var self = this;\n\n        self._printIntervalId && window.clearInterval(self._printIntervalId);\n        self._printIntervalId = window.setInterval(function () {\n            self.printStats(rtcPeerConnection);\n        }, seconds * 1000);\n    },\n\n    parseRecvStatistics: function parseRecvStatistics(results, callback, callbackSent) {\n        var self = this;\n\n        // calculate video bitrate\n        var bitrate;\n        var remoteWidth;\n        var remoteHeight;\n\n        var activeCandidatePair = null;\n        var remoteCandidate = null;\n\n        Object.keys(results).forEach(function (result) {\n            var report = results[result];\n            var now = report.timestamp;\n\n            if (report.type === 'inboundrtp' && report.mediaType === 'audio') {\n                // firefox calculates the bitrate for us\n                // https://bugzilla.mozilla.org/show_bug.cgi?id=951496\n                bitrate = Math.floor(report.bitrateMean / 1024);\n            } else if (report.type === 'ssrc' && report.bytesReceived) {\n                if (report.mediaType === 'video') {\n                    // remoteWidth = report.googFrameWidthReceived;\n                    // remoteHeight = report.googFrameHeightReceived;\n                    // // chrome does not so we need to do it ourselves\n                    // var bytes = report.bytesReceived;\n                    // if (self.timestampPrev) {\n                    //     bitrate = 8 * (bytes - self.bytesPrev) / (now - self.timestampPrev);\n                    //     bitrate = Math.floor(bitrate);\n                    // }\n                    // self.bytesPrev = bytes;\n                    // self.timestampPrev = now;\n                } else {\n                    // chrome does not so we need to do it ourselves\n                    var bytes = report.bytesReceived;\n                    if (self.timestampPrev) {\n                        bitrate = 8 * (bytes - self.bytesPrev) / (now - self.timestampPrev);\n                        bitrate = Math.floor(bitrate);\n                    }\n                    self.bytesPrev = bytes;\n                    self.timestampPrev = now;\n                }\n            }\n\n            if (report.type === 'candidatepair' && report.selected || report.type === 'googCandidatePair' && report.googActiveConnection === 'true') {\n                activeCandidatePair = report;\n            }\n\n            if (report.type === 'outboundrtp' && report.mediaType === 'audio') {\n                callbackSent('audio Bitrate', Math.floor(report.bitrateMean / 1024) + ' kbps');\n            } else if (report.type === 'ssrc' && report.bytesSent && report.googFrameHeightSent) {\n                // chrome does not so we need to do it ourselves\n                var bytes = report.bytesSent;\n                if (self.sentTimestampPrev) {\n                    var br = 8 * (bytes - self.sentBytesPrev) / (now - self.sentTimestampPrev);\n                    br = Math.floor(br);\n                    callbackSent('audio Bitrate', br + ' kbps');\n                    callbackSent('audio Size', report.googFrameWidthSent + 'x' + report.googFrameHeightSent);\n                }\n                self.sentBytesPrev = bytes;\n                self.sentTimestampPrev = now;\n            }\n        });\n\n        if (activeCandidatePair && activeCandidatePair.remoteCandidateId) {\n            remoteCandidate = results[activeCandidatePair.remoteCandidateId];\n        }\n        if (remoteCandidate && remoteCandidate.ipAddress && remoteCandidate.portNumber) {\n            callback('Peer', remoteCandidate.ipAddress + ':' + remoteCandidate.portNumber);\n        }\n\n        callback('audio Bitrate', bitrate + ' kbps');\n\n        if (remoteHeight) {\n            callback('audio Size', remoteWidth + 'x' + remoteHeight);\n        }\n    }\n};\n\nvar WebrtcStatisticsHelper = function WebrtcStatisticsHelper(cfg) {\n    _util.extend(this, _WebrtcStatistics, cfg || {});\n};\n\nvar webrtcStatisticsHelper = new WebrtcStatisticsHelper();\n\nvar _SDPSection = {\n    headerSection: null,\n\n    audioSection: null,\n    videoSection: null,\n\n    _parseHeaderSection: function _parseHeaderSection(sdp) {\n        var index = sdp.indexOf('m=audio');\n        if (index >= 0) {\n            return sdp.slice(0, index);\n        }\n\n        index = sdp.indexOf('m=video');\n        if (index >= 0) {\n            return sdp.slice(0, index);\n        }\n\n        return sdp;\n    },\n\n    _parseAudioSection: function _parseAudioSection(sdp) {\n        var index = sdp.indexOf('m=audio');\n        if (index >= 0) {\n            var endIndex = sdp.indexOf('m=video');\n            return sdp.slice(index, endIndex < 0 ? sdp.length : endIndex);\n        }\n    },\n\n    _parseVideoSection: function _parseVideoSection(sdp) {\n        var index = sdp.indexOf('m=video');\n        if (index >= 0) {\n            return sdp.slice(index);\n        }\n    },\n\n    spiltSection: function spiltSection(sdp) {\n        var self = this;\n\n        self.headerSection = self._parseHeaderSection(sdp);\n        self.audioSection = self._parseAudioSection(sdp);\n        self.videoSection = self._parseVideoSection(sdp);\n    },\n\n    removeSSRC: function removeSSRC(section) {\n        var arr = [];\n\n        var _arr = section.split(/a=ssrc:[^\\n]+/g);\n        for (var i = 0; i < _arr.length; i++) {\n            _arr[i] != '\\n' && arr.push(_arr[i]);\n        }\n        // arr.push('');\n\n        return arr.join('\\n');\n    },\n\n    removeField_msid: function removeField_msid(section) {\n        var arr = [];\n\n        var _arr = section.split(/a=msid:[^\\n]+/g);\n        for (var i = 0; i < _arr.length; i++) {\n            _arr[i] != '\\n' && arr.push(_arr[i]);\n        }\n        // arr.push('');\n\n        section = arr.join('\\n');\n        arr = [];\n\n        _arr = section.split(/[\\n]+/g);\n        for (var i = 0; i < _arr.length; i++) {\n            _arr[i] != '\\n' && arr.push(_arr[i]);\n        }\n\n        return arr.join('\\n');\n    },\n\n    updateHeaderMsidSemantic: function updateHeaderMsidSemantic(wms) {\n\n        var self = this;\n\n        var line = \"a=msid-semantic: WMS \" + wms;\n\n        var _arr = self.headerSection.split(/a=msid\\-semantic: WMS.*/g);\n        var arr = [];\n        switch (_arr.length) {\n            case 1:\n                arr.push(_arr[0]);\n                break;\n            case 2:\n                arr.push(_arr[0]);\n                arr.push(line);\n                arr.push('\\n');\n                break;\n            case 3:\n                arr.push(_arr[0]);\n                arr.push(line);\n                arr.push('\\n');\n                arr.push(_arr[2]);\n                arr.push('\\n');\n                break;\n        }\n\n        return self.headerSection = arr.join('');\n    },\n\n    updateAudioSSRCSection: function updateAudioSSRCSection(ssrc, cname, msid, label) {\n        var self = this;\n\n        self.audioSection && (self.audioSection = self.removeSSRC(self.audioSection));\n        self.audioSection && (self.audioSection = self.removeField_msid(self.audioSection));\n        self.audioSection && (self.audioSection = self.audioSection + self.ssrcSection(ssrc, cname, msid, label));\n    },\n\n    updateVideoSSRCSection: function updateVideoSSRCSection(ssrc, cname, msid, label) {\n        var self = this;\n\n        self.videoSection && (self.videoSection = self.removeSSRC(self.videoSection));\n        self.videoSection && (self.videoSection = self.removeField_msid(self.videoSection));\n        self.videoSection && (self.videoSection = self.videoSection + self.ssrcSection(ssrc, cname, msid, label));\n    },\n\n    getUpdatedSDP: function getUpdatedSDP() {\n        var self = this;\n\n        var sdp = \"\";\n\n        self.headerSection && (sdp += self.headerSection);\n        self.audioSection && (sdp += self.audioSection);\n        self.videoSection && (sdp += self.videoSection);\n\n        return sdp;\n    },\n\n    parseMsidSemantic: function parseMsidSemantic(header) {\n        var self = this;\n\n        var regexp = /a=msid\\-semantic:\\s*WMS (\\S+)/ig;\n        var arr = self._parseLine(header, regexp);\n\n        arr && arr.length == 2 && (self.msidSemantic = {\n            line: arr[0],\n            WMS: arr[1]\n        });\n\n        return self.msidSemantic;\n    },\n\n    ssrcSection: function ssrcSection(ssrc, cname, msid, label) {\n        var lines = ['a=ssrc:' + ssrc + ' cname:' + cname, 'a=ssrc:' + ssrc + ' msid:' + msid + ' ' + label, 'a=ssrc:' + ssrc + ' mslabel:' + msid, 'a=ssrc:' + ssrc + ' label:' + label, ''];\n\n        return lines.join('\\n');\n    },\n\n    parseSSRC: function parseSSRC(section) {\n        var self = this;\n\n        var regexp = new RegExp(\"a=(ssrc):(\\\\d+) (\\\\S+):(\\\\S+)\", \"ig\");\n\n        var arr = self._parseLine(section, regexp);\n        if (arr) {\n            var ssrc = {\n                lines: [],\n                updateSSRCSection: self.ssrcSection\n            };\n\n            for (var i = 0; i < arr.length; i++) {\n                var e = arr[i];\n                if (e.indexOf(\"a=ssrc\") >= 0) {\n                    ssrc.lines.push(e);\n                } else {\n                    switch (e) {\n                        case 'ssrc':\n                        case 'cname':\n                        case 'msid':\n                        case 'mslabel':\n                        case 'label':\n                            ssrc[e] = arr[++i];\n                    }\n                }\n            }\n\n            return ssrc;\n        }\n    },\n\n    _parseLine: function _parseLine(str, regexp) {\n        var arr = [];\n\n        var _arr;\n        while ((_arr = regexp.exec(str)) != null) {\n            for (var i = 0; i < _arr.length; i++) {\n                arr.push(_arr[i]);\n            }\n        }\n\n        if (arr.length > 0) {\n            return arr;\n        }\n    }\n};\n\nvar SDPSection = function SDPSection(sdp) {\n    _util.extend(this, _SDPSection);\n    this.spiltSection(sdp);\n};\n\n/**\r\n * Abstract\r\n */\nvar _WebRTC = {\n    streamType: \"VIDEO\", // VIDEO or VOICE\n\n    mediaStreamConstaints: {\n        audio: true,\n        video: true\n    },\n\n    localStream: null,\n    rtcPeerConnection: null,\n\n    offerOptions: {\n        offerToReceiveAudio: 1,\n        offerToReceiveVideo: 1\n    },\n\n    createMedia: function createMedia(constaints, onGotStream) {\n        var self = this;\n\n        if (constaints && typeof constaints === \"function\") {\n            onGotStream = constaints;\n            constaints = null;\n        }\n\n        _logger.debug('[WebRTC-API] begin create media ......');\n\n        function gotStream(stream) {\n            _logger.debug('[WebRTC-API] got local stream');\n\n            self.localStream = stream;\n\n            var videoTracks = self.localStream.getVideoTracks();\n            var audioTracks = self.localStream.getAudioTracks();\n\n            if (videoTracks.length > 0) {\n                _logger.debug('[WebRTC-API] Using video device: ' + videoTracks[0].label);\n            }\n            if (audioTracks.length > 0) {\n                _logger.debug('[WebRTC-API] Using audio device: ' + audioTracks[0].label);\n            }\n\n            onGotStream ? onGotStream(self, stream, self.streamType) : self.onGotStream(stream, self.streamType);\n        }\n\n        return navigator.mediaDevices.getUserMedia(constaints || self.mediaStreamConstaints).then(gotStream).then(self.onCreateMedia).catch(function (e) {\n            _logger.debug('[WebRTC-API] getUserMedia() error: ', e);\n            self.onError(e);\n        });\n    },\n\n    setLocalVideoSrcObject: function setLocalVideoSrcObject(stream) {\n        this.onGotLocalStream(stream, this.streamType);\n        _logger.debug('[WebRTC-API] you can see yourself !');\n    },\n\n    createRtcPeerConnection: function createRtcPeerConnection(iceServerConfig) {\n        _logger.debug('[WebRTC-API] begin create RtcPeerConnection ......');\n\n        var self = this;\n\n        // if (iceServerConfig && iceServerConfig.iceServers) {\n        // } else {\n        //     iceServerConfig = null;\n        // }\n\n        if (iceServerConfig) {\n            //reduce icecandidate number:add default value\n            !iceServerConfig.iceServers && (iceServerConfig.iceServers = []);\n\n            iceServerConfig.rtcpMuxPolicy = \"require\";\n            iceServerConfig.bundlePolicy = \"max-bundle\";\n\n            //iceServerConfig.iceTransportPolicy = 'relay';\n            if (iceServerConfig.relayOnly) {\n                iceServerConfig.iceTransportPolicy = 'relay';\n            }\n        } else {\n            iceServerConfig = null;\n        }\n        _logger.debug('[WebRTC-API] RtcPeerConnection config:', iceServerConfig);\n\n        self.startTime = window.performance.now();\n\n        var rtcPeerConnection = self.rtcPeerConnection = new RTCPeerConnection(iceServerConfig);\n        _logger.debug('[WebRTC-API] Created local peer connection object', rtcPeerConnection);\n\n        rtcPeerConnection.onicecandidate = function (event) {\n            //reduce icecandidate number: don't deal with tcp, udp only\n            if (event.type == \"icecandidate\" && (event.candidate == null || / tcp /.test(event.candidate.candidate))) {\n                return;\n            }\n            self.onIceCandidate(event);\n        };\n\n        rtcPeerConnection.onicestatechange = function (event) {\n            self.onIceStateChange(event);\n        };\n\n        rtcPeerConnection.oniceconnectionstatechange = function (event) {\n            self.onIceStateChange(event);\n\n            if (\"connected\" == event.target.iceConnectionState) {\n                webrtcStatisticsHelper.intervalPrintStats(rtcPeerConnection, 1);\n            }\n\n            if (\"closed\" == event.target.iceConnectionState) {\n                webrtcStatisticsHelper.stopIntervalPrintStats();\n            }\n        };\n\n        rtcPeerConnection.onaddstream = function (event) {\n            self._onGotRemoteStream(event);\n        };\n    },\n\n    _uploadLocalStream: function _uploadLocalStream() {\n        this.rtcPeerConnection.addStream(this.localStream);\n        _logger.debug('[WebRTC-API] Added local stream to RtcPeerConnection');\n    },\n\n    createOffer: function createOffer(onCreateOfferSuccess, onCreateOfferError) {\n        var self = this;\n\n        self._uploadLocalStream();\n\n        _logger.debug('[WebRTC-API] createOffer start...');\n\n        return self.rtcPeerConnection.createOffer(self.offerOptions).then(function (desc) {\n            self.offerDescription = desc;\n\n            _logger.debug('[WebRTC-API] Offer '); //_logger.debug('from \\n' + desc.sdp);\n            _logger.debug('[WebRTC-API] setLocalDescription start');\n\n            self.rtcPeerConnection.setLocalDescription(desc).then(self.onSetLocalSessionDescriptionSuccess, self.onSetSessionDescriptionError).then(function () {\n                (onCreateOfferSuccess || self.onCreateOfferSuccess)(desc);\n            });\n        }, onCreateOfferError || self.onCreateSessionDescriptionError);\n    },\n\n    createPRAnswer: function createPRAnswer(onCreatePRAnswerSuccess, onCreatePRAnswerError) {\n        var self = this;\n\n        _logger.info(' createPRAnswer start');\n        // Since the 'remote' side has no media stream we need\n        // to pass in the right constraints in order for it to\n        // accept the incoming offer of audio and video.\n        return self.rtcPeerConnection.createAnswer().then(function (desc) {\n            _logger.debug('[WebRTC-API] _____________PRAnswer ', desc.sdp); //_logger.debug('from :\\n' + desc.sdp);\n\n            desc.type = \"pranswer\";\n            desc.sdp = desc.sdp.replace(/a=recvonly/g, 'a=inactive');\n\n            self.prAnswerDescription = desc;\n\n            _logger.debug('[WebRTC-API] inactive PRAnswer ', desc.sdp); //_logger.debug('from :\\n' + desc.sdp);\n            _logger.debug('[WebRTC-API] setLocalDescription start');\n\n            self.rtcPeerConnection.setLocalDescription(desc).then(self.onSetLocalSuccess, self.onSetSessionDescriptionError).then(function () {\n                var sdpSection = new SDPSection(desc.sdp);\n                sdpSection.updateHeaderMsidSemantic(\"MS_0000\");\n                sdpSection.updateAudioSSRCSection(1000, \"CHROME0000\", \"MS_0000\", \"LABEL_AUDIO_1000\");\n                sdpSection.updateVideoSSRCSection(2000, \"CHROME0000\", \"MS_0000\", \"LABEL_VIDEO_2000\");\n\n                desc.sdp = sdpSection.getUpdatedSDP();\n\n                _logger.debug('[WebRTC-API] Send PRAnswer ', desc.sdp); //_logger.debug('from :\\n' + desc.sdp);\n\n                (onCreatePRAnswerSuccess || self.onCreatePRAnswerSuccess)(desc);\n            });\n        }, onCreatePRAnswerError || self.onCreateSessionDescriptionError);\n    },\n\n    createAnswer: function createAnswer(onCreateAnswerSuccess, onCreateAnswerError) {\n        var self = this;\n\n        self._uploadLocalStream();\n\n        _logger.info('[WebRTC-API] createAnswer start');\n        // Since the 'remote' side has no media stream we need\n        // to pass in the right constraints in order for it to\n        // accept the incoming offer of audio and video.\n        return self.rtcPeerConnection.createAnswer().then(function (desc) {\n            _logger.debug('[WebRTC-API] _____________________Answer ', desc.sdp); //_logger.debug('from :\\n' + desc.sdp);\n\n            desc.type = 'answer';\n\n            if (WebIM.WebRTC.supportPRAnswer) {\n                var sdpSection = new SDPSection(desc.sdp);\n                var ms = sdpSection.parseMsidSemantic(sdpSection.headerSection);\n                if (ms.WMS == '*') {\n                    sdpSection.updateHeaderMsidSemantic(ms.WMS = \"MS_0000\");\n                }\n                var audioSSRC = sdpSection.parseSSRC(sdpSection.audioSection);\n                var videoSSRC = sdpSection.parseSSRC(sdpSection.videoSection);\n\n                sdpSection.updateAudioSSRCSection(1000, \"CHROME0000\", ms.WMS, audioSSRC.label || \"LABEL_AUDIO_1000\");\n                if (videoSSRC) {\n                    sdpSection.updateVideoSSRCSection(2000, \"CHROME0000\", ms.WMS, videoSSRC.label || \"LABEL_VIDEO_2000\");\n                }\n                // mslabel cname\n\n                desc.sdp = sdpSection.getUpdatedSDP();\n            }\n\n            self.answerDescription = desc;\n\n            _logger.debug('[WebRTC-API] Answer ', desc.sdp); //_logger.debug('from :\\n' + desc.sdp);\n            _logger.debug('[WebRTC-API] setLocalDescription start');\n\n            self.rtcPeerConnection.setLocalDescription(desc).then(self.onSetLocalSuccess, self.onSetSessionDescriptionError).then(function () {\n                if (WebIM.WebRTC.supportPRAnswer) {\n                    var sdpSection = new SDPSection(desc.sdp);\n\n                    sdpSection.updateHeaderMsidSemantic(\"MS_0000\");\n                    sdpSection.updateAudioSSRCSection(1000, \"CHROME0000\", \"MS_0000\", \"LABEL_AUDIO_1000\");\n                    sdpSection.updateVideoSSRCSection(2000, \"CHROME0000\", \"MS_0000\", \"LABEL_VIDEO_2000\");\n\n                    desc.sdp = sdpSection.getUpdatedSDP();\n                }\n\n                _logger.debug('[WebRTC-API] Send Answer ', desc.sdp); //_logger.debug('from :\\n' + desc.sdp);\n\n                (onCreateAnswerSuccess || self.onCreateAnswerSuccess)(desc);\n            });\n        }, onCreateAnswerError || self.onCreateSessionDescriptionError);\n    },\n\n    close: function close() {\n        var self = this;\n        try {\n            webrtcStatisticsHelper.stopIntervalPrintStats();\n\n            self.rtcPeerConnection && self.rtcPeerConnection.close();\n        } catch (e) {}\n\n        if (self.localStream) {\n            self.localStream.getTracks().forEach(function (track) {\n                track.stop();\n            });\n        }\n        self.localStream = null;\n    },\n\n    addIceCandidate: function addIceCandidate(candidate) {\n        var self = this;\n\n        if (!self.rtcPeerConnection) {\n            return;\n        }\n\n        _logger.debug('[WebRTC-API] Add ICE candidate: \\n', candidate);\n\n        var _cands = _util.isArray(candidate) ? candidate : [];\n        !_util.isArray(candidate) && _cands.push(candidate);\n\n        for (var i = 0; i < _cands.length; i++) {\n            candidate = _cands[i];\n\n            self.rtcPeerConnection.addIceCandidate(new RTCIceCandidate(candidate)).then(self.onAddIceCandidateSuccess, self.onAddIceCandidateError);\n        }\n    },\n\n    setRemoteDescription: function setRemoteDescription(desc) {\n        var self = this;\n\n        _logger.debug('[WebRTC-API] setRemoteDescription start. ');\n\n        desc.sdp = desc.sdp.replace(/UDP\\/TLS\\/RTP\\/SAVPF/g, \"RTP/SAVPF\");\n        _logger.debug('[WebRTC-API] setRemoteDescription.', desc);\n\n        desc = new RTCSessionDescription(desc);\n\n        return self.rtcPeerConnection.setRemoteDescription(desc).then(self.onSetRemoteSuccess, self.onSetSessionDescriptionError);\n    },\n\n    iceConnectionState: function iceConnectionState() {\n        var self = this;\n\n        return self.rtcPeerConnection.iceConnectionState;\n    },\n\n    onCreateMedia: function onCreateMedia() {\n        _logger.debug('[WebRTC-API] media created.');\n    },\n\n    _onGotRemoteStream: function _onGotRemoteStream(event) {\n        _logger.debug('[WebRTC-API] onGotRemoteStream.', event);\n\n        event.stream.getAudioTracks()[0].enabled = true;\n        event.stream.getVideoTracks()[0] && (event.stream.getVideoTracks()[0].enabled = this.streamType == \"VIDEO\");\n\n        this.onGotRemoteStream(event.stream, this.streamType);\n        _logger.debug('[WebRTC-API] received remote stream, you will see the other.');\n    },\n\n    onGotStream: function onGotStream(stream, streamType) {\n        _logger.debug('[WebRTC-API] on got a local stream : ' + streamType);\n    },\n\n    onSetRemoteSuccess: function onSetRemoteSuccess() {\n        _logger.info('[WebRTC-API] onSetRemoteSuccess complete');\n    },\n\n    onSetLocalSuccess: function onSetLocalSuccess() {\n        _logger.info('[WebRTC-API] setLocalDescription complete');\n    },\n\n    onAddIceCandidateSuccess: function onAddIceCandidateSuccess() {\n        _logger.debug('[WebRTC-API] addIceCandidate success');\n    },\n\n    onAddIceCandidateError: function onAddIceCandidateError(error) {\n        _logger.debug('[WebRTC-API] failed to add ICE Candidate: ' + error.toString());\n    },\n\n    onIceCandidate: function onIceCandidate(event) {\n        _logger.debug('[WebRTC-API] onIceCandidate : ICE candidate: \\n' + event.candidate);\n    },\n\n    onIceStateChange: function onIceStateChange(event) {\n        _logger.debug('[WebRTC-API] onIceStateChange : ICE state change event: ', event);\n    },\n\n    onCreateSessionDescriptionError: function onCreateSessionDescriptionError(error) {\n        _logger.error('[WebRTC-API] Failed to create session description: ' + error.toString());\n    },\n\n    onCreateOfferSuccess: function onCreateOfferSuccess(desc) {\n        _logger.debug('[WebRTC-API] create offer success');\n    },\n\n    onCreatePRAnswerSuccess: function onCreatePRAnswerSuccess(desc) {\n        _logger.debug('[WebRTC-API] create answer success');\n    },\n\n    onCreateAnswerSuccess: function onCreateAnswerSuccess(desc) {\n        _logger.debug('[WebRTC-API] create answer success');\n    },\n\n    onSetSessionDescriptionError: function onSetSessionDescriptionError(error) {\n        _logger.error('[WebRTC-API] onSetSessionDescriptionError : Failed to set session description: ' + error.toString());\n    },\n\n    onSetLocalSessionDescriptionSuccess: function onSetLocalSessionDescriptionSuccess() {\n        _logger.debug('[WebRTC-API] onSetLocalSessionDescriptionSuccess : setLocalDescription complete');\n    }\n\n};\n\nmodule.exports = function (initConfigs) {\n    _util.extend(true, this, _WebRTC, initConfigs || {});\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjU2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnJ0Yy9zcmMvY29tcG9uZW50cy93ZWJydGMuanM/ZWU2ZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogV2ViUlRDXHJcbiAqXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxyXG4gKiAgIDEuY3JlYXRlTWVkaWE6Z290IHN0cmVhbUEgICAgICAgICAgICAgICAgICAgICAgfCAxLmNyZWF0ZU1lZGlhOmdvdCBzdHJlYW1CXHJcbiAqICAgMi5uZXcgUlRDUGVlckNvbm5lY3Rpb246IEFQZWVyQ29ubmVjdGlvbiAgICAgICB8IDIubmV3IFJUQ1BlZXJDb25uZWN0aW9uOiBCUGVlckNvbm5lY3Rpb25cclxuICogICAzLkFQZWVyQ29ubmVjdGlvbi5jcmVhdGVPZmZlcjpnb3Qgb2ZmZXJBICAgICAgIHxcclxuICogICAgICBBUGVlckNvbm5lY3Rpb24uc2V0TG9jYWxEZXNjcmlwdGlvbihvZmZlckEpIHxcclxuICogICAgICBzZW5kIG9mZmVyQSAtLS0+IC0tLT4gLS0tPiAtLS0+ICAgICAgICAtLS0+IHxcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgLS0tPiAzLmdvdCBvZmZlckEgfCBvZmZlckEgPSBuZXcgUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKG9mZmVyQSk7XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IEJQZWVyQ29ubmVjdGlvbi5zZXRSZW1vdGVEZXNjcmlwdGlvbihvZmZlckEpXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IDQuQlBlZXJDb25uZWN0aW9uLmNyZWF0ZUFuc3dlcjogZ290IGFuc3dlckJcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgQlBlZXJDb25uZWN0aW9uLnNldExvY2FsRGVzY3JpcHRpb24oYW5zd2VyQilcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgPC0tLS0gc2VuZCBhbnN3ZXJCXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IDUuZ290IGFuc3dlckIgPC0tLSA8LS0tIDwtLS0gPC0tLVxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBhbnN3ZXJCID0gbmV3IFJUQ1Nlc3Npb25EZXNjcmlwdGlvbihhbnN3ZXJCKVxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxyXG4gKiBBUGVlckNvbm5lY3Rpb24uc2V0UmVtb3RlRGVzY3JpcHRpb24oYW5zd2VyQikgICAgfFxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxyXG4gKiA2LmdvdCBjYW5kaWRhdGVBIC0tLT4gLS0tPiAgLS0tPiAtLS0+ICAgICAgICAgICAgfCAtLS0+IGdvdCBjYW5kaWRhdGVBXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IEJQZWVyQ29ubmVjdGlvbi5hZGRJY2VDYW5kaWRhdGUobmV3IFJUQ0ljZUNhbmRpZGF0ZShjYW5kaWRhdGVBKSlcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgZ290IGNhbmRpZGF0ZUIgPC0tLSA8LS0tIDwtLS0gPC0tLVxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCA8LS0tIDYuZ290IGNhbmRpZGF0ZUIgQVBlZXJDb25uZWN0aW9uLmFkZEljZUNhbmRpZGF0ZShjYW5kaWRhdGVCKVxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCA3LiBBUGVlckNvbm5lY3Rpb24uYWRkU3RyZWFtKHN0cmVhbUEpXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IDcuQlBlZXJDb25uZWN0aW9uLmFkZFN0cmVhbShzdHJlYW1CKVxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbUEgPj4+Pj4+Pj4+Pj4gfCAgPDw8PDwgc2VlIEFcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWVCIDw8PDw8PDw8PDw8ICAgIHwgPDw8PDwgc3RyZWFtQlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxyXG4gKlxyXG4gKi9cclxudmFyIF91dGlsID0gcmVxdWlyZSgnLi91dGlscycpO1xyXG52YXIgX2xvZ2dlciA9IF91dGlsLmxvZ2dlcjtcclxuXHJcblxyXG52YXIgX1dlYnJ0Y1N0YXRpc3RpY3MgPSB7XHJcbiAgICBieXRlc1ByZXY6IG51bGwsXHJcbiAgICB0aW1lc3RhbXBQcmV2OiBudWxsLFxyXG4gICAgc2VudEJ5dGVzUHJldjogbnVsbCxcclxuICAgIHNlbnRUaW1lc3RhbXBQcmV2OiBudWxsLFxyXG5cclxuICAgIHByaW50U3RhdHM6IGZ1bmN0aW9uKHJ0Y1BlZXJDb25uZWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBydGNQZWVyQ29ubmVjdGlvbi5nZXRTdGF0cyhudWxsLCBmdW5jdGlvbiAocmVzdWx0cykge1xyXG4gICAgICAgICAgICBzZWxmLnBhcnNlUmVjdlN0YXRpc3RpY3MocmVzdWx0cywgZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBfbG9nZ2VyLmluZm8obmV3IERhdGUoKSwgXCJSRUNWIFwiLCBuYW1lLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgX2xvZ2dlci5pbmZvKG5ldyBEYXRlKCksIFwiU0VORCBcIiwgbmFtZSwgdmFsdWUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgc3RvcEludGVydmFsUHJpbnRTdGF0czogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2VsZi5fcHJpbnRJbnRlcnZhbElkICYmICB3aW5kb3cuY2xlYXJJbnRlcnZhbChzZWxmLl9wcmludEludGVydmFsSWQpO1xyXG4gICAgICAgIHNlbGYuX3ByaW50SW50ZXJ2YWxJZCA9IG51bGw7XHJcbiAgICB9LFxyXG5cclxuICAgIGludGVydmFsUHJpbnRTdGF0czogZnVuY3Rpb24ocnRjUGVlckNvbm5lY3Rpb24sIHNlY29uZHMpe1xyXG5cclxuICAgIH0sXHJcblxyXG4gICAgX2ludGVydmFsUHJpbnRTdGF0czogZnVuY3Rpb24ocnRjUGVlckNvbm5lY3Rpb24sIHNlY29uZHMpe1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2VsZi5fcHJpbnRJbnRlcnZhbElkICYmICB3aW5kb3cuY2xlYXJJbnRlcnZhbChzZWxmLl9wcmludEludGVydmFsSWQpO1xyXG4gICAgICAgIHNlbGYuX3ByaW50SW50ZXJ2YWxJZCA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlbGYucHJpbnRTdGF0cyhydGNQZWVyQ29ubmVjdGlvbik7XHJcbiAgICAgICAgfSwgc2Vjb25kcyAqIDEwMDApO1xyXG4gICAgfSxcclxuXHJcbiAgICBwYXJzZVJlY3ZTdGF0aXN0aWNzOiBmdW5jdGlvbiAocmVzdWx0cywgY2FsbGJhY2ssIGNhbGxiYWNrU2VudCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgLy8gY2FsY3VsYXRlIHZpZGVvIGJpdHJhdGVcclxuICAgICAgICB2YXIgYml0cmF0ZTtcclxuICAgICAgICB2YXIgcmVtb3RlV2lkdGg7XHJcbiAgICAgICAgdmFyIHJlbW90ZUhlaWdodDtcclxuXHJcbiAgICAgICAgdmFyIGFjdGl2ZUNhbmRpZGF0ZVBhaXIgPSBudWxsO1xyXG4gICAgICAgIHZhciByZW1vdGVDYW5kaWRhdGUgPSBudWxsO1xyXG5cclxuICAgICAgICBPYmplY3Qua2V5cyhyZXN1bHRzKS5mb3JFYWNoKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgdmFyIHJlcG9ydCA9IHJlc3VsdHNbcmVzdWx0XTtcclxuICAgICAgICAgICAgdmFyIG5vdyA9IHJlcG9ydC50aW1lc3RhbXA7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKHJlcG9ydC50eXBlID09PSAnaW5ib3VuZHJ0cCcgJiYgcmVwb3J0Lm1lZGlhVHlwZSA9PT0gJ2F1ZGlvJykge1xyXG4gICAgICAgICAgICAgICAgLy8gZmlyZWZveCBjYWxjdWxhdGVzIHRoZSBiaXRyYXRlIGZvciB1c1xyXG4gICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9OTUxNDk2XHJcbiAgICAgICAgICAgICAgICBiaXRyYXRlID0gTWF0aC5mbG9vcihyZXBvcnQuYml0cmF0ZU1lYW4gLyAxMDI0KTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXBvcnQudHlwZSA9PT0gJ3NzcmMnICYmIHJlcG9ydC5ieXRlc1JlY2VpdmVkICl7XHJcbiAgICAgICAgICAgICAgICBpZihyZXBvcnQubWVkaWFUeXBlID09PSAndmlkZW8nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3RlV2lkdGggPSByZXBvcnQuZ29vZ0ZyYW1lV2lkdGhSZWNlaXZlZDtcclxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdGVIZWlnaHQgPSByZXBvcnQuZ29vZ0ZyYW1lSGVpZ2h0UmVjZWl2ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gLy8gY2hyb21lIGRvZXMgbm90IHNvIHdlIG5lZWQgdG8gZG8gaXQgb3Vyc2VsdmVzXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdmFyIGJ5dGVzID0gcmVwb3J0LmJ5dGVzUmVjZWl2ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKHNlbGYudGltZXN0YW1wUHJldikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBiaXRyYXRlID0gOCAqIChieXRlcyAtIHNlbGYuYnl0ZXNQcmV2KSAvIChub3cgLSBzZWxmLnRpbWVzdGFtcFByZXYpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBiaXRyYXRlID0gTWF0aC5mbG9vcihiaXRyYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2VsZi5ieXRlc1ByZXYgPSBieXRlcztcclxuICAgICAgICAgICAgICAgICAgICAvLyBzZWxmLnRpbWVzdGFtcFByZXYgPSBub3c7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjaHJvbWUgZG9lcyBub3Qgc28gd2UgbmVlZCB0byBkbyBpdCBvdXJzZWx2ZXNcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYnl0ZXMgPSByZXBvcnQuYnl0ZXNSZWNlaXZlZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi50aW1lc3RhbXBQcmV2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpdHJhdGUgPSA4ICogKGJ5dGVzIC0gc2VsZi5ieXRlc1ByZXYpIC8gKG5vdyAtIHNlbGYudGltZXN0YW1wUHJldik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpdHJhdGUgPSBNYXRoLmZsb29yKGJpdHJhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmJ5dGVzUHJldiA9IGJ5dGVzO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYudGltZXN0YW1wUHJldiA9IG5vdztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHJlcG9ydC50eXBlID09PSAnY2FuZGlkYXRlcGFpcicgJiYgcmVwb3J0LnNlbGVjdGVkIHx8XHJcbiAgICAgICAgICAgICAgICByZXBvcnQudHlwZSA9PT0gJ2dvb2dDYW5kaWRhdGVQYWlyJyAmJlxyXG4gICAgICAgICAgICAgICAgcmVwb3J0Lmdvb2dBY3RpdmVDb25uZWN0aW9uID09PSAndHJ1ZScpIHtcclxuICAgICAgICAgICAgICAgIGFjdGl2ZUNhbmRpZGF0ZVBhaXIgPSByZXBvcnQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChyZXBvcnQudHlwZSA9PT0gJ291dGJvdW5kcnRwJyAmJiByZXBvcnQubWVkaWFUeXBlID09PSAnYXVkaW8nKSB7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFja1NlbnQoJ2F1ZGlvIEJpdHJhdGUnLCBNYXRoLmZsb29yKHJlcG9ydC5iaXRyYXRlTWVhbiAvIDEwMjQpICsgJyBrYnBzJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVwb3J0LnR5cGUgPT09ICdzc3JjJyAmJiByZXBvcnQuYnl0ZXNTZW50ICYmXHJcbiAgICAgICAgICAgICAgICByZXBvcnQuZ29vZ0ZyYW1lSGVpZ2h0U2VudCkge1xyXG4gICAgICAgICAgICAgICAgLy8gY2hyb21lIGRvZXMgbm90IHNvIHdlIG5lZWQgdG8gZG8gaXQgb3Vyc2VsdmVzXHJcbiAgICAgICAgICAgICAgICB2YXIgYnl0ZXMgPSByZXBvcnQuYnl0ZXNTZW50O1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuc2VudFRpbWVzdGFtcFByZXYpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYnIgPSA4ICogKGJ5dGVzIC0gc2VsZi5zZW50Qnl0ZXNQcmV2KSAvIChub3cgLSBzZWxmLnNlbnRUaW1lc3RhbXBQcmV2KTtcclxuICAgICAgICAgICAgICAgICAgICBiciA9IE1hdGguZmxvb3IoYnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrU2VudCgnYXVkaW8gQml0cmF0ZScsIGJyICsgJyBrYnBzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tTZW50KCdhdWRpbyBTaXplJywgcmVwb3J0Lmdvb2dGcmFtZVdpZHRoU2VudCArICd4JyArIHJlcG9ydC5nb29nRnJhbWVIZWlnaHRTZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNlbGYuc2VudEJ5dGVzUHJldiA9IGJ5dGVzO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5zZW50VGltZXN0YW1wUHJldiA9IG5vdztcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChhY3RpdmVDYW5kaWRhdGVQYWlyICYmIGFjdGl2ZUNhbmRpZGF0ZVBhaXIucmVtb3RlQ2FuZGlkYXRlSWQpIHtcclxuICAgICAgICAgICAgcmVtb3RlQ2FuZGlkYXRlID0gcmVzdWx0c1thY3RpdmVDYW5kaWRhdGVQYWlyLnJlbW90ZUNhbmRpZGF0ZUlkXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJlbW90ZUNhbmRpZGF0ZSAmJiByZW1vdGVDYW5kaWRhdGUuaXBBZGRyZXNzICYmXHJcbiAgICAgICAgICAgIHJlbW90ZUNhbmRpZGF0ZS5wb3J0TnVtYmVyKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKCdQZWVyJywgcmVtb3RlQ2FuZGlkYXRlLmlwQWRkcmVzcyArICc6JyArIHJlbW90ZUNhbmRpZGF0ZS5wb3J0TnVtYmVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNhbGxiYWNrKCdhdWRpbyBCaXRyYXRlJywgYml0cmF0ZSArICcga2JwcycpO1xyXG5cclxuICAgICAgICBpZiAocmVtb3RlSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKCdhdWRpbyBTaXplJywgcmVtb3RlV2lkdGggKyAneCcgKyByZW1vdGVIZWlnaHQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxudmFyIFdlYnJ0Y1N0YXRpc3RpY3NIZWxwZXIgPSBmdW5jdGlvbiAoY2ZnKSB7XHJcbiAgICBfdXRpbC5leHRlbmQodGhpcywgX1dlYnJ0Y1N0YXRpc3RpY3MsIGNmZyB8fCB7fSk7XHJcbn07XHJcblxyXG52YXIgd2VicnRjU3RhdGlzdGljc0hlbHBlciA9IG5ldyBXZWJydGNTdGF0aXN0aWNzSGVscGVyKCk7XHJcblxyXG52YXIgX1NEUFNlY3Rpb24gPSB7XHJcbiAgICBoZWFkZXJTZWN0aW9uOiBudWxsLFxyXG5cclxuICAgIGF1ZGlvU2VjdGlvbjogbnVsbCxcclxuICAgIHZpZGVvU2VjdGlvbjogbnVsbCxcclxuXHJcblxyXG4gICAgX3BhcnNlSGVhZGVyU2VjdGlvbjogZnVuY3Rpb24gKHNkcCkge1xyXG4gICAgICAgIHZhciBpbmRleCA9IHNkcC5pbmRleE9mKCdtPWF1ZGlvJyk7XHJcbiAgICAgICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNkcC5zbGljZSgwLCBpbmRleCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbmRleCA9IHNkcC5pbmRleE9mKCdtPXZpZGVvJyk7XHJcbiAgICAgICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNkcC5zbGljZSgwLCBpbmRleCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2RwO1xyXG4gICAgfSxcclxuXHJcbiAgICBfcGFyc2VBdWRpb1NlY3Rpb246IGZ1bmN0aW9uIChzZHApIHtcclxuICAgICAgICB2YXIgaW5kZXggPSBzZHAuaW5kZXhPZignbT1hdWRpbycpO1xyXG4gICAgICAgIGlmIChpbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgIHZhciBlbmRJbmRleCA9IHNkcC5pbmRleE9mKCdtPXZpZGVvJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBzZHAuc2xpY2UoaW5kZXgsIGVuZEluZGV4IDwgMCA/IHNkcC5sZW5ndGggOiBlbmRJbmRleCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBfcGFyc2VWaWRlb1NlY3Rpb246IGZ1bmN0aW9uIChzZHApIHtcclxuICAgICAgICB2YXIgaW5kZXggPSBzZHAuaW5kZXhPZignbT12aWRlbycpO1xyXG4gICAgICAgIGlmIChpbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZHAuc2xpY2UoaW5kZXgpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgc3BpbHRTZWN0aW9uOiBmdW5jdGlvbiAoc2RwKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBzZWxmLmhlYWRlclNlY3Rpb24gPSBzZWxmLl9wYXJzZUhlYWRlclNlY3Rpb24oc2RwKTtcclxuICAgICAgICBzZWxmLmF1ZGlvU2VjdGlvbiA9IHNlbGYuX3BhcnNlQXVkaW9TZWN0aW9uKHNkcCk7XHJcbiAgICAgICAgc2VsZi52aWRlb1NlY3Rpb24gPSBzZWxmLl9wYXJzZVZpZGVvU2VjdGlvbihzZHApO1xyXG4gICAgfSxcclxuXHJcbiAgICByZW1vdmVTU1JDOiBmdW5jdGlvbiAoc2VjdGlvbikge1xyXG4gICAgICAgIHZhciBhcnIgPSBbXTtcclxuXHJcbiAgICAgICAgdmFyIF9hcnIgPSBzZWN0aW9uLnNwbGl0KC9hPXNzcmM6W15cXG5dKy9nKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF9hcnIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgX2FycltpXSAhPSAnXFxuJyAmJiBhcnIucHVzaChfYXJyW2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYXJyLnB1c2goJycpO1xyXG5cclxuICAgICAgICByZXR1cm4gYXJyLmpvaW4oJ1xcbicpO1xyXG4gICAgfSxcclxuXHJcbiAgICByZW1vdmVGaWVsZF9tc2lkOiBmdW5jdGlvbiAoc2VjdGlvbikge1xyXG4gICAgICAgIHZhciBhcnIgPSBbXTtcclxuXHJcbiAgICAgICAgdmFyIF9hcnIgPSBzZWN0aW9uLnNwbGl0KC9hPW1zaWQ6W15cXG5dKy9nKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF9hcnIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgX2FycltpXSAhPSAnXFxuJyAmJiBhcnIucHVzaChfYXJyW2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYXJyLnB1c2goJycpO1xyXG5cclxuICAgICAgICBzZWN0aW9uID0gYXJyLmpvaW4oJ1xcbicpO1xyXG4gICAgICAgIGFyciA9IFtdO1xyXG5cclxuICAgICAgICBfYXJyID0gc2VjdGlvbi5zcGxpdCgvW1xcbl0rL2cpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX2Fyci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAoX2FycltpXSAhPSAnXFxuJykgJiYgYXJyLnB1c2goX2FycltpXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gYXJyLmpvaW4oJ1xcbicpO1xyXG4gICAgfSxcclxuXHJcbiAgICB1cGRhdGVIZWFkZXJNc2lkU2VtYW50aWM6IGZ1bmN0aW9uICh3bXMpIHtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgbGluZSA9IFwiYT1tc2lkLXNlbWFudGljOiBXTVMgXCIgKyB3bXM7XHJcblxyXG4gICAgICAgIHZhciBfYXJyID0gc2VsZi5oZWFkZXJTZWN0aW9uLnNwbGl0KC9hPW1zaWRcXC1zZW1hbnRpYzogV01TLiovZyk7XHJcbiAgICAgICAgdmFyIGFyciA9IFtdO1xyXG4gICAgICAgIHN3aXRjaCAoX2Fyci5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2goX2FyclswXSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2goX2FyclswXSk7XHJcbiAgICAgICAgICAgICAgICBhcnIucHVzaChsaW5lKTtcclxuICAgICAgICAgICAgICAgIGFyci5wdXNoKCdcXG4nKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICBhcnIucHVzaChfYXJyWzBdKTtcclxuICAgICAgICAgICAgICAgIGFyci5wdXNoKGxpbmUpO1xyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2goJ1xcbicpO1xyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2goX2FyclsyXSk7XHJcbiAgICAgICAgICAgICAgICBhcnIucHVzaCgnXFxuJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZWxmLmhlYWRlclNlY3Rpb24gPSBhcnIuam9pbignJyk7XHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZUF1ZGlvU1NSQ1NlY3Rpb246IGZ1bmN0aW9uIChzc3JjLCBjbmFtZSwgbXNpZCwgbGFiZWwpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNlbGYuYXVkaW9TZWN0aW9uICYmIChzZWxmLmF1ZGlvU2VjdGlvbiA9IHNlbGYucmVtb3ZlU1NSQyhzZWxmLmF1ZGlvU2VjdGlvbikpO1xyXG4gICAgICAgIHNlbGYuYXVkaW9TZWN0aW9uICYmIChzZWxmLmF1ZGlvU2VjdGlvbiA9IHNlbGYucmVtb3ZlRmllbGRfbXNpZChzZWxmLmF1ZGlvU2VjdGlvbikpO1xyXG4gICAgICAgIHNlbGYuYXVkaW9TZWN0aW9uICYmIChzZWxmLmF1ZGlvU2VjdGlvbiA9IHNlbGYuYXVkaW9TZWN0aW9uICsgc2VsZi5zc3JjU2VjdGlvbihzc3JjLCBjbmFtZSwgbXNpZCwgbGFiZWwpKTtcclxuICAgIH0sXHJcblxyXG5cclxuICAgIHVwZGF0ZVZpZGVvU1NSQ1NlY3Rpb246IGZ1bmN0aW9uIChzc3JjLCBjbmFtZSwgbXNpZCwgbGFiZWwpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNlbGYudmlkZW9TZWN0aW9uICYmIChzZWxmLnZpZGVvU2VjdGlvbiA9IHNlbGYucmVtb3ZlU1NSQyhzZWxmLnZpZGVvU2VjdGlvbikpO1xyXG4gICAgICAgIHNlbGYudmlkZW9TZWN0aW9uICYmIChzZWxmLnZpZGVvU2VjdGlvbiA9IHNlbGYucmVtb3ZlRmllbGRfbXNpZChzZWxmLnZpZGVvU2VjdGlvbikpO1xyXG4gICAgICAgIHNlbGYudmlkZW9TZWN0aW9uICYmIChzZWxmLnZpZGVvU2VjdGlvbiA9IHNlbGYudmlkZW9TZWN0aW9uICsgc2VsZi5zc3JjU2VjdGlvbihzc3JjLCBjbmFtZSwgbXNpZCwgbGFiZWwpKVxyXG4gICAgfSxcclxuXHJcbiAgICBnZXRVcGRhdGVkU0RQOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgc2RwID0gXCJcIjtcclxuXHJcbiAgICAgICAgc2VsZi5oZWFkZXJTZWN0aW9uICYmIChzZHAgKz0gc2VsZi5oZWFkZXJTZWN0aW9uKTtcclxuICAgICAgICBzZWxmLmF1ZGlvU2VjdGlvbiAmJiAoc2RwICs9IHNlbGYuYXVkaW9TZWN0aW9uKTtcclxuICAgICAgICBzZWxmLnZpZGVvU2VjdGlvbiAmJiAoc2RwICs9IHNlbGYudmlkZW9TZWN0aW9uKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNkcDtcclxuICAgIH0sXHJcblxyXG4gICAgcGFyc2VNc2lkU2VtYW50aWM6IGZ1bmN0aW9uIChoZWFkZXIpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciByZWdleHAgPSAvYT1tc2lkXFwtc2VtYW50aWM6XFxzKldNUyAoXFxTKykvaWc7XHJcbiAgICAgICAgdmFyIGFyciA9IHNlbGYuX3BhcnNlTGluZShoZWFkZXIsIHJlZ2V4cCk7XHJcblxyXG4gICAgICAgIGFyciAmJiBhcnIubGVuZ3RoID09IDIgJiYgKHNlbGYubXNpZFNlbWFudGljID0ge1xyXG4gICAgICAgICAgICBsaW5lOiBhcnJbMF0sXHJcbiAgICAgICAgICAgIFdNUzogYXJyWzFdXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBzZWxmLm1zaWRTZW1hbnRpYztcclxuICAgIH0sXHJcblxyXG4gICAgc3NyY1NlY3Rpb246IGZ1bmN0aW9uIChzc3JjLCBjbmFtZSwgbXNpZCwgbGFiZWwpIHtcclxuICAgICAgICB2YXIgbGluZXMgPSBbXHJcbiAgICAgICAgICAgICdhPXNzcmM6JyArIHNzcmMgKyAnIGNuYW1lOicgKyBjbmFtZSxcclxuICAgICAgICAgICAgJ2E9c3NyYzonICsgc3NyYyArICcgbXNpZDonICsgbXNpZCArICcgJyArIGxhYmVsLFxyXG4gICAgICAgICAgICAnYT1zc3JjOicgKyBzc3JjICsgJyBtc2xhYmVsOicgKyBtc2lkLFxyXG4gICAgICAgICAgICAnYT1zc3JjOicgKyBzc3JjICsgJyBsYWJlbDonICsgbGFiZWwsXHJcbiAgICAgICAgICAgICcnXHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGxpbmVzLmpvaW4oJ1xcbicpO1xyXG4gICAgfSxcclxuXHJcbiAgICBwYXJzZVNTUkM6IGZ1bmN0aW9uIChzZWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgcmVnZXhwID0gbmV3IFJlZ0V4cChcImE9KHNzcmMpOihcXFxcZCspIChcXFxcUyspOihcXFxcUyspXCIsIFwiaWdcIik7XHJcblxyXG4gICAgICAgIHZhciBhcnIgPSBzZWxmLl9wYXJzZUxpbmUoc2VjdGlvbiwgcmVnZXhwKTtcclxuICAgICAgICBpZiAoYXJyKSB7XHJcbiAgICAgICAgICAgIHZhciBzc3JjID0ge1xyXG4gICAgICAgICAgICAgICAgbGluZXM6IFtdLFxyXG4gICAgICAgICAgICAgICAgdXBkYXRlU1NSQ1NlY3Rpb246IHNlbGYuc3NyY1NlY3Rpb25cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZSA9IGFycltpXTtcclxuICAgICAgICAgICAgICAgIGlmIChlLmluZGV4T2YoXCJhPXNzcmNcIikgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNzcmMubGluZXMucHVzaChlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NzcmMnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjbmFtZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21zaWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdtc2xhYmVsJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbGFiZWwnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3NyY1tlXSA9IGFyclsrK2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHNzcmM7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBfcGFyc2VMaW5lOiBmdW5jdGlvbiAoc3RyLCByZWdleHApIHtcclxuICAgICAgICB2YXIgYXJyID0gW107XHJcblxyXG4gICAgICAgIHZhciBfYXJyO1xyXG4gICAgICAgIHdoaWxlICgoX2FyciA9IHJlZ2V4cC5leGVjKHN0cikpICE9IG51bGwpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfYXJyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBhcnIucHVzaChfYXJyW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGFyci5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhcnI7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxufTtcclxuXHJcbnZhciBTRFBTZWN0aW9uID0gZnVuY3Rpb24gKHNkcCkge1xyXG4gICAgX3V0aWwuZXh0ZW5kKHRoaXMsIF9TRFBTZWN0aW9uKTtcclxuICAgIHRoaXMuc3BpbHRTZWN0aW9uKHNkcCk7XHJcbn07XHJcblxyXG5cclxuLyoqXHJcbiAqIEFic3RyYWN0XHJcbiAqL1xyXG52YXIgX1dlYlJUQyA9IHtcclxuICAgIHN0cmVhbVR5cGU6IFwiVklERU9cIiwgLy8gVklERU8gb3IgVk9JQ0VcclxuXHJcbiAgICBtZWRpYVN0cmVhbUNvbnN0YWludHM6IHtcclxuICAgICAgICBhdWRpbzogdHJ1ZSxcclxuICAgICAgICB2aWRlbzogdHJ1ZVxyXG4gICAgfSxcclxuXHJcbiAgICBsb2NhbFN0cmVhbTogbnVsbCxcclxuICAgIHJ0Y1BlZXJDb25uZWN0aW9uOiBudWxsLFxyXG5cclxuICAgIG9mZmVyT3B0aW9uczoge1xyXG4gICAgICAgIG9mZmVyVG9SZWNlaXZlQXVkaW86IDEsXHJcbiAgICAgICAgb2ZmZXJUb1JlY2VpdmVWaWRlbzogMVxyXG4gICAgfSxcclxuXHJcblxyXG4gICAgY3JlYXRlTWVkaWE6IGZ1bmN0aW9uIChjb25zdGFpbnRzLCBvbkdvdFN0cmVhbSkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgaWYgKGNvbnN0YWludHMgJiYgKHR5cGVvZiBjb25zdGFpbnRzID09PSBcImZ1bmN0aW9uXCIpKSB7XHJcbiAgICAgICAgICAgIG9uR290U3RyZWFtID0gY29uc3RhaW50cztcclxuICAgICAgICAgICAgY29uc3RhaW50cyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gYmVnaW4gY3JlYXRlIG1lZGlhIC4uLi4uLicpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnb3RTdHJlYW0oc3RyZWFtKSB7XHJcbiAgICAgICAgICAgIF9sb2dnZXIuZGVidWcoJ1tXZWJSVEMtQVBJXSBnb3QgbG9jYWwgc3RyZWFtJyk7XHJcblxyXG4gICAgICAgICAgICBzZWxmLmxvY2FsU3RyZWFtID0gc3RyZWFtO1xyXG5cclxuICAgICAgICAgICAgdmFyIHZpZGVvVHJhY2tzID0gc2VsZi5sb2NhbFN0cmVhbS5nZXRWaWRlb1RyYWNrcygpO1xyXG4gICAgICAgICAgICB2YXIgYXVkaW9UcmFja3MgPSBzZWxmLmxvY2FsU3RyZWFtLmdldEF1ZGlvVHJhY2tzKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodmlkZW9UcmFja3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgX2xvZ2dlci5kZWJ1ZygnW1dlYlJUQy1BUEldIFVzaW5nIHZpZGVvIGRldmljZTogJyArIHZpZGVvVHJhY2tzWzBdLmxhYmVsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYXVkaW9UcmFja3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgX2xvZ2dlci5kZWJ1ZygnW1dlYlJUQy1BUEldIFVzaW5nIGF1ZGlvIGRldmljZTogJyArIGF1ZGlvVHJhY2tzWzBdLmxhYmVsKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb25Hb3RTdHJlYW0gPyBvbkdvdFN0cmVhbShzZWxmLCBzdHJlYW0sIHNlbGYuc3RyZWFtVHlwZSkgOiBzZWxmLm9uR290U3RyZWFtKHN0cmVhbSwgc2VsZi5zdHJlYW1UeXBlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25zdGFpbnRzIHx8IHNlbGYubWVkaWFTdHJlYW1Db25zdGFpbnRzKVxyXG4gICAgICAgICAgICAudGhlbihnb3RTdHJlYW0pXHJcbiAgICAgICAgICAgIC50aGVuKHNlbGYub25DcmVhdGVNZWRpYSlcclxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gZ2V0VXNlck1lZGlhKCkgZXJyb3I6ICcsIGUpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5vbkVycm9yKGUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgc2V0TG9jYWxWaWRlb1NyY09iamVjdDogZnVuY3Rpb24gKHN0cmVhbSkge1xyXG4gICAgICAgIHRoaXMub25Hb3RMb2NhbFN0cmVhbShzdHJlYW0sIHRoaXMuc3RyZWFtVHlwZSk7XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZygnW1dlYlJUQy1BUEldIHlvdSBjYW4gc2VlIHlvdXJzZWxmICEnKTtcclxuICAgIH0sXHJcblxyXG4gICAgY3JlYXRlUnRjUGVlckNvbm5lY3Rpb246IGZ1bmN0aW9uIChpY2VTZXJ2ZXJDb25maWcpIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gYmVnaW4gY3JlYXRlIFJ0Y1BlZXJDb25uZWN0aW9uIC4uLi4uLicpO1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIC8vIGlmIChpY2VTZXJ2ZXJDb25maWcgJiYgaWNlU2VydmVyQ29uZmlnLmljZVNlcnZlcnMpIHtcclxuICAgICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAgIC8vICAgICBpY2VTZXJ2ZXJDb25maWcgPSBudWxsO1xyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgaWYgKGljZVNlcnZlckNvbmZpZyl7IC8vcmVkdWNlIGljZWNhbmRpZGF0ZSBudW1iZXI6YWRkIGRlZmF1bHQgdmFsdWVcclxuICAgICAgICAgICAgIWljZVNlcnZlckNvbmZpZy5pY2VTZXJ2ZXJzICYmIChpY2VTZXJ2ZXJDb25maWcuaWNlU2VydmVycyA9IFtdKTtcclxuXHJcbiAgICAgICAgICAgIGljZVNlcnZlckNvbmZpZy5ydGNwTXV4UG9saWN5ID0gXCJyZXF1aXJlXCI7XHJcbiAgICAgICAgICAgIGljZVNlcnZlckNvbmZpZy5idW5kbGVQb2xpY3kgPSBcIm1heC1idW5kbGVcIjtcclxuXHJcbiAgICAgICAgICAgIC8vaWNlU2VydmVyQ29uZmlnLmljZVRyYW5zcG9ydFBvbGljeSA9ICdyZWxheSc7XHJcbiAgICAgICAgICAgIGlmKGljZVNlcnZlckNvbmZpZy5yZWxheU9ubHkpe1xyXG4gICAgICAgICAgICAgICAgaWNlU2VydmVyQ29uZmlnLmljZVRyYW5zcG9ydFBvbGljeSA9ICdyZWxheSc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpY2VTZXJ2ZXJDb25maWcgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gUnRjUGVlckNvbm5lY3Rpb24gY29uZmlnOicsIGljZVNlcnZlckNvbmZpZyk7XHJcblxyXG4gICAgICAgIHNlbGYuc3RhcnRUaW1lID0gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpO1xyXG5cclxuICAgICAgICB2YXIgcnRjUGVlckNvbm5lY3Rpb24gPSBzZWxmLnJ0Y1BlZXJDb25uZWN0aW9uID0gbmV3IFJUQ1BlZXJDb25uZWN0aW9uKGljZVNlcnZlckNvbmZpZyk7XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZygnW1dlYlJUQy1BUEldIENyZWF0ZWQgbG9jYWwgcGVlciBjb25uZWN0aW9uIG9iamVjdCcsIHJ0Y1BlZXJDb25uZWN0aW9uKTtcclxuXHJcblxyXG4gICAgICAgIHJ0Y1BlZXJDb25uZWN0aW9uLm9uaWNlY2FuZGlkYXRlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIC8vcmVkdWNlIGljZWNhbmRpZGF0ZSBudW1iZXI6IGRvbid0IGRlYWwgd2l0aCB0Y3AsIHVkcCBvbmx5XHJcbiAgICAgICAgICAgIGlmIChldmVudC50eXBlID09IFwiaWNlY2FuZGlkYXRlXCIgJiYgKChldmVudC5jYW5kaWRhdGUgPT0gbnVsbCkgfHwgLyB0Y3AgLy50ZXN0KGV2ZW50LmNhbmRpZGF0ZS5jYW5kaWRhdGUpKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNlbGYub25JY2VDYW5kaWRhdGUoZXZlbnQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJ0Y1BlZXJDb25uZWN0aW9uLm9uaWNlc3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgc2VsZi5vbkljZVN0YXRlQ2hhbmdlKGV2ZW50KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBydGNQZWVyQ29ubmVjdGlvbi5vbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBzZWxmLm9uSWNlU3RhdGVDaGFuZ2UoZXZlbnQpO1xyXG5cclxuICAgICAgICAgICAgaWYoXCJjb25uZWN0ZWRcIiA9PSBldmVudC50YXJnZXQuaWNlQ29ubmVjdGlvblN0YXRlKXtcclxuICAgICAgICAgICAgICAgIHdlYnJ0Y1N0YXRpc3RpY3NIZWxwZXIuaW50ZXJ2YWxQcmludFN0YXRzKHJ0Y1BlZXJDb25uZWN0aW9uLCAxKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYoXCJjbG9zZWRcIiA9PSBldmVudC50YXJnZXQuaWNlQ29ubmVjdGlvblN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICB3ZWJydGNTdGF0aXN0aWNzSGVscGVyLnN0b3BJbnRlcnZhbFByaW50U3RhdHMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJ0Y1BlZXJDb25uZWN0aW9uLm9uYWRkc3RyZWFtID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHNlbGYuX29uR290UmVtb3RlU3RyZWFtKGV2ZW50KTtcclxuICAgICAgICB9O1xyXG4gICAgfSxcclxuXHJcbiAgICBfdXBsb2FkTG9jYWxTdHJlYW06IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnJ0Y1BlZXJDb25uZWN0aW9uLmFkZFN0cmVhbSh0aGlzLmxvY2FsU3RyZWFtKTtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gQWRkZWQgbG9jYWwgc3RyZWFtIHRvIFJ0Y1BlZXJDb25uZWN0aW9uJyk7XHJcbiAgICB9LFxyXG5cclxuICAgIGNyZWF0ZU9mZmVyOiBmdW5jdGlvbiAob25DcmVhdGVPZmZlclN1Y2Nlc3MsIG9uQ3JlYXRlT2ZmZXJFcnJvcikge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2VsZi5fdXBsb2FkTG9jYWxTdHJlYW0oKTtcclxuXHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZygnW1dlYlJUQy1BUEldIGNyZWF0ZU9mZmVyIHN0YXJ0Li4uJyk7XHJcblxyXG4gICAgICAgIHJldHVybiBzZWxmLnJ0Y1BlZXJDb25uZWN0aW9uLmNyZWF0ZU9mZmVyKHNlbGYub2ZmZXJPcHRpb25zKS50aGVuKFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZGVzYykge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5vZmZlckRlc2NyaXB0aW9uID0gZGVzYztcclxuXHJcbiAgICAgICAgICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gT2ZmZXIgJyk7Ly9fbG9nZ2VyLmRlYnVnKCdmcm9tIFxcbicgKyBkZXNjLnNkcCk7XHJcbiAgICAgICAgICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gc2V0TG9jYWxEZXNjcmlwdGlvbiBzdGFydCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNlbGYucnRjUGVlckNvbm5lY3Rpb24uc2V0TG9jYWxEZXNjcmlwdGlvbihkZXNjKS50aGVuKFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYub25TZXRMb2NhbFNlc3Npb25EZXNjcmlwdGlvblN1Y2Nlc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5vblNldFNlc3Npb25EZXNjcmlwdGlvbkVycm9yXHJcbiAgICAgICAgICAgICAgICApLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIChvbkNyZWF0ZU9mZmVyU3VjY2VzcyB8fCBzZWxmLm9uQ3JlYXRlT2ZmZXJTdWNjZXNzKShkZXNjKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAob25DcmVhdGVPZmZlckVycm9yIHx8IHNlbGYub25DcmVhdGVTZXNzaW9uRGVzY3JpcHRpb25FcnJvcilcclxuICAgICAgICApO1xyXG4gICAgfSxcclxuXHJcbiAgICBjcmVhdGVQUkFuc3dlcjogZnVuY3Rpb24gKG9uQ3JlYXRlUFJBbnN3ZXJTdWNjZXNzLCBvbkNyZWF0ZVBSQW5zd2VyRXJyb3IpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIF9sb2dnZXIuaW5mbygnIGNyZWF0ZVBSQW5zd2VyIHN0YXJ0Jyk7XHJcbiAgICAgICAgLy8gU2luY2UgdGhlICdyZW1vdGUnIHNpZGUgaGFzIG5vIG1lZGlhIHN0cmVhbSB3ZSBuZWVkXHJcbiAgICAgICAgLy8gdG8gcGFzcyBpbiB0aGUgcmlnaHQgY29uc3RyYWludHMgaW4gb3JkZXIgZm9yIGl0IHRvXHJcbiAgICAgICAgLy8gYWNjZXB0IHRoZSBpbmNvbWluZyBvZmZlciBvZiBhdWRpbyBhbmQgdmlkZW8uXHJcbiAgICAgICAgcmV0dXJuIHNlbGYucnRjUGVlckNvbm5lY3Rpb24uY3JlYXRlQW5zd2VyKCkudGhlbihcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGRlc2MpIHtcclxuICAgICAgICAgICAgICAgIF9sb2dnZXIuZGVidWcoJ1tXZWJSVEMtQVBJXSBfX19fX19fX19fX19fUFJBbnN3ZXIgJywgZGVzYy5zZHApOy8vX2xvZ2dlci5kZWJ1ZygnZnJvbSA6XFxuJyArIGRlc2Muc2RwKTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZXNjLnR5cGUgPSBcInByYW5zd2VyXCI7XHJcbiAgICAgICAgICAgICAgICBkZXNjLnNkcCA9IGRlc2Muc2RwLnJlcGxhY2UoL2E9cmVjdm9ubHkvZywgJ2E9aW5hY3RpdmUnKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZi5wckFuc3dlckRlc2NyaXB0aW9uID0gZGVzYztcclxuXHJcbiAgICAgICAgICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gaW5hY3RpdmUgUFJBbnN3ZXIgJywgZGVzYy5zZHApOy8vX2xvZ2dlci5kZWJ1ZygnZnJvbSA6XFxuJyArIGRlc2Muc2RwKTtcclxuICAgICAgICAgICAgICAgIF9sb2dnZXIuZGVidWcoJ1tXZWJSVEMtQVBJXSBzZXRMb2NhbERlc2NyaXB0aW9uIHN0YXJ0Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZi5ydGNQZWVyQ29ubmVjdGlvbi5zZXRMb2NhbERlc2NyaXB0aW9uKGRlc2MpLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5vblNldExvY2FsU3VjY2VzcyxcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9uU2V0U2Vzc2lvbkRlc2NyaXB0aW9uRXJyb3JcclxuICAgICAgICAgICAgICAgICkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNkcFNlY3Rpb24gPSBuZXcgU0RQU2VjdGlvbihkZXNjLnNkcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2RwU2VjdGlvbi51cGRhdGVIZWFkZXJNc2lkU2VtYW50aWMoXCJNU18wMDAwXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNkcFNlY3Rpb24udXBkYXRlQXVkaW9TU1JDU2VjdGlvbigxMDAwLCBcIkNIUk9NRTAwMDBcIiwgXCJNU18wMDAwXCIsIFwiTEFCRUxfQVVESU9fMTAwMFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBzZHBTZWN0aW9uLnVwZGF0ZVZpZGVvU1NSQ1NlY3Rpb24oMjAwMCwgXCJDSFJPTUUwMDAwXCIsIFwiTVNfMDAwMFwiLCBcIkxBQkVMX1ZJREVPXzIwMDBcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2Muc2RwID0gc2RwU2VjdGlvbi5nZXRVcGRhdGVkU0RQKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIF9sb2dnZXIuZGVidWcoJ1tXZWJSVEMtQVBJXSBTZW5kIFBSQW5zd2VyICcsIGRlc2Muc2RwKTsvL19sb2dnZXIuZGVidWcoJ2Zyb20gOlxcbicgKyBkZXNjLnNkcCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIChvbkNyZWF0ZVBSQW5zd2VyU3VjY2VzcyB8fCBzZWxmLm9uQ3JlYXRlUFJBbnN3ZXJTdWNjZXNzKShkZXNjKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAob25DcmVhdGVQUkFuc3dlckVycm9yIHx8IHNlbGYub25DcmVhdGVTZXNzaW9uRGVzY3JpcHRpb25FcnJvcilcclxuICAgICAgICApO1xyXG4gICAgfSxcclxuXHJcbiAgICBjcmVhdGVBbnN3ZXI6IGZ1bmN0aW9uIChvbkNyZWF0ZUFuc3dlclN1Y2Nlc3MsIG9uQ3JlYXRlQW5zd2VyRXJyb3IpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNlbGYuX3VwbG9hZExvY2FsU3RyZWFtKCk7XHJcblxyXG4gICAgICAgIF9sb2dnZXIuaW5mbygnW1dlYlJUQy1BUEldIGNyZWF0ZUFuc3dlciBzdGFydCcpO1xyXG4gICAgICAgIC8vIFNpbmNlIHRoZSAncmVtb3RlJyBzaWRlIGhhcyBubyBtZWRpYSBzdHJlYW0gd2UgbmVlZFxyXG4gICAgICAgIC8vIHRvIHBhc3MgaW4gdGhlIHJpZ2h0IGNvbnN0cmFpbnRzIGluIG9yZGVyIGZvciBpdCB0b1xyXG4gICAgICAgIC8vIGFjY2VwdCB0aGUgaW5jb21pbmcgb2ZmZXIgb2YgYXVkaW8gYW5kIHZpZGVvLlxyXG4gICAgICAgIHJldHVybiBzZWxmLnJ0Y1BlZXJDb25uZWN0aW9uLmNyZWF0ZUFuc3dlcigpLnRoZW4oXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkZXNjKSB7XHJcbiAgICAgICAgICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gX19fX19fX19fX19fX19fX19fX19fQW5zd2VyICcsIGRlc2Muc2RwKTsvL19sb2dnZXIuZGVidWcoJ2Zyb20gOlxcbicgKyBkZXNjLnNkcCk7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVzYy50eXBlID0gJ2Fuc3dlcic7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoV2ViSU0uV2ViUlRDLnN1cHBvcnRQUkFuc3dlcil7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNkcFNlY3Rpb24gPSBuZXcgU0RQU2VjdGlvbihkZXNjLnNkcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1zID0gc2RwU2VjdGlvbi5wYXJzZU1zaWRTZW1hbnRpYyhzZHBTZWN0aW9uLmhlYWRlclNlY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKG1zLldNUyA9PSAnKicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2RwU2VjdGlvbi51cGRhdGVIZWFkZXJNc2lkU2VtYW50aWMobXMuV01TID0gXCJNU18wMDAwXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgYXVkaW9TU1JDID0gc2RwU2VjdGlvbi5wYXJzZVNTUkMoc2RwU2VjdGlvbi5hdWRpb1NlY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2aWRlb1NTUkMgPSBzZHBTZWN0aW9uLnBhcnNlU1NSQyhzZHBTZWN0aW9uLnZpZGVvU2VjdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNkcFNlY3Rpb24udXBkYXRlQXVkaW9TU1JDU2VjdGlvbigxMDAwLCBcIkNIUk9NRTAwMDBcIiwgbXMuV01TLCBhdWRpb1NTUkMubGFiZWwgfHwgXCJMQUJFTF9BVURJT18xMDAwXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHZpZGVvU1NSQyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNkcFNlY3Rpb24udXBkYXRlVmlkZW9TU1JDU2VjdGlvbigyMDAwLCBcIkNIUk9NRTAwMDBcIiwgbXMuV01TLCB2aWRlb1NTUkMubGFiZWwgfHwgXCJMQUJFTF9WSURFT18yMDAwXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBtc2xhYmVsIGNuYW1lXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2Muc2RwID0gc2RwU2VjdGlvbi5nZXRVcGRhdGVkU0RQKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHNlbGYuYW5zd2VyRGVzY3JpcHRpb24gPSBkZXNjO1xyXG5cclxuICAgICAgICAgICAgICAgIF9sb2dnZXIuZGVidWcoJ1tXZWJSVEMtQVBJXSBBbnN3ZXIgJywgZGVzYy5zZHApOy8vX2xvZ2dlci5kZWJ1ZygnZnJvbSA6XFxuJyArIGRlc2Muc2RwKTtcclxuICAgICAgICAgICAgICAgIF9sb2dnZXIuZGVidWcoJ1tXZWJSVEMtQVBJXSBzZXRMb2NhbERlc2NyaXB0aW9uIHN0YXJ0Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZi5ydGNQZWVyQ29ubmVjdGlvbi5zZXRMb2NhbERlc2NyaXB0aW9uKGRlc2MpLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5vblNldExvY2FsU3VjY2VzcyxcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9uU2V0U2Vzc2lvbkRlc2NyaXB0aW9uRXJyb3JcclxuICAgICAgICAgICAgICAgICkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoV2ViSU0uV2ViUlRDLnN1cHBvcnRQUkFuc3dlcil7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZHBTZWN0aW9uID0gbmV3IFNEUFNlY3Rpb24oZGVzYy5zZHApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2RwU2VjdGlvbi51cGRhdGVIZWFkZXJNc2lkU2VtYW50aWMoXCJNU18wMDAwXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZHBTZWN0aW9uLnVwZGF0ZUF1ZGlvU1NSQ1NlY3Rpb24oMTAwMCwgXCJDSFJPTUUwMDAwXCIsIFwiTVNfMDAwMFwiLCBcIkxBQkVMX0FVRElPXzEwMDBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNkcFNlY3Rpb24udXBkYXRlVmlkZW9TU1JDU2VjdGlvbigyMDAwLCBcIkNIUk9NRTAwMDBcIiwgXCJNU18wMDAwXCIsIFwiTEFCRUxfVklERU9fMjAwMFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2Muc2RwID0gc2RwU2VjdGlvbi5nZXRVcGRhdGVkU0RQKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gU2VuZCBBbnN3ZXIgJywgZGVzYy5zZHApOy8vX2xvZ2dlci5kZWJ1ZygnZnJvbSA6XFxuJyArIGRlc2Muc2RwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgKG9uQ3JlYXRlQW5zd2VyU3VjY2VzcyB8fCBzZWxmLm9uQ3JlYXRlQW5zd2VyU3VjY2VzcykoZGVzYyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgKG9uQ3JlYXRlQW5zd2VyRXJyb3IgfHwgc2VsZi5vbkNyZWF0ZVNlc3Npb25EZXNjcmlwdGlvbkVycm9yKVxyXG4gICAgICAgICk7XHJcbiAgICB9LFxyXG5cclxuICAgIGNsb3NlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHdlYnJ0Y1N0YXRpc3RpY3NIZWxwZXIuc3RvcEludGVydmFsUHJpbnRTdGF0cygpO1xyXG5cclxuICAgICAgICAgICAgc2VsZi5ydGNQZWVyQ29ubmVjdGlvbiAmJiBzZWxmLnJ0Y1BlZXJDb25uZWN0aW9uLmNsb3NlKCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHNlbGYubG9jYWxTdHJlYW0pIHtcclxuICAgICAgICAgICAgc2VsZi5sb2NhbFN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uICh0cmFjaykge1xyXG4gICAgICAgICAgICAgICAgdHJhY2suc3RvcCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZi5sb2NhbFN0cmVhbSA9IG51bGw7XHJcbiAgICB9LFxyXG5cclxuICAgIGFkZEljZUNhbmRpZGF0ZTogZnVuY3Rpb24gKGNhbmRpZGF0ZSkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgaWYgKCFzZWxmLnJ0Y1BlZXJDb25uZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gQWRkIElDRSBjYW5kaWRhdGU6IFxcbicsIGNhbmRpZGF0ZSk7XHJcblxyXG4gICAgICAgIHZhciBfY2FuZHMgPSBfdXRpbC5pc0FycmF5KGNhbmRpZGF0ZSkgPyBjYW5kaWRhdGUgOiBbXTtcclxuICAgICAgICAhX3V0aWwuaXNBcnJheShjYW5kaWRhdGUpICYmIF9jYW5kcy5wdXNoKGNhbmRpZGF0ZSk7XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX2NhbmRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNhbmRpZGF0ZSA9IF9jYW5kc1tpXTtcclxuXHJcbiAgICAgICAgICAgIHNlbGYucnRjUGVlckNvbm5lY3Rpb24uYWRkSWNlQ2FuZGlkYXRlKG5ldyBSVENJY2VDYW5kaWRhdGUoY2FuZGlkYXRlKSkudGhlbihcclxuICAgICAgICAgICAgICAgIHNlbGYub25BZGRJY2VDYW5kaWRhdGVTdWNjZXNzLFxyXG4gICAgICAgICAgICAgICAgc2VsZi5vbkFkZEljZUNhbmRpZGF0ZUVycm9yXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBzZXRSZW1vdGVEZXNjcmlwdGlvbjogZnVuY3Rpb24gKGRlc2MpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoJ1tXZWJSVEMtQVBJXSBzZXRSZW1vdGVEZXNjcmlwdGlvbiBzdGFydC4gJyk7XHJcblxyXG4gICAgICAgIGRlc2Muc2RwID0gZGVzYy5zZHAucmVwbGFjZSgvVURQXFwvVExTXFwvUlRQXFwvU0FWUEYvZywgXCJSVFAvU0FWUEZcIik7XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZygnW1dlYlJUQy1BUEldIHNldFJlbW90ZURlc2NyaXB0aW9uLicsIGRlc2MpO1xyXG5cclxuICAgICAgICBkZXNjID0gbmV3IFJUQ1Nlc3Npb25EZXNjcmlwdGlvbihkZXNjKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlbGYucnRjUGVlckNvbm5lY3Rpb24uc2V0UmVtb3RlRGVzY3JpcHRpb24oZGVzYykudGhlbihcclxuICAgICAgICAgICAgc2VsZi5vblNldFJlbW90ZVN1Y2Nlc3MsXHJcbiAgICAgICAgICAgIHNlbGYub25TZXRTZXNzaW9uRGVzY3JpcHRpb25FcnJvclxyXG4gICAgICAgICk7XHJcbiAgICB9LFxyXG5cclxuICAgIGljZUNvbm5lY3Rpb25TdGF0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlbGYucnRjUGVlckNvbm5lY3Rpb24uaWNlQ29ubmVjdGlvblN0YXRlO1xyXG4gICAgfSxcclxuXHJcbiAgICBvbkNyZWF0ZU1lZGlhOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZygnW1dlYlJUQy1BUEldIG1lZGlhIGNyZWF0ZWQuJyk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9vbkdvdFJlbW90ZVN0cmVhbTogZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZygnW1dlYlJUQy1BUEldIG9uR290UmVtb3RlU3RyZWFtLicsIGV2ZW50KTtcclxuXHJcbiAgICAgICAgZXZlbnQuc3RyZWFtLmdldEF1ZGlvVHJhY2tzKClbMF0uZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgZXZlbnQuc3RyZWFtLmdldFZpZGVvVHJhY2tzKClbMF0gJiYgKGV2ZW50LnN0cmVhbS5nZXRWaWRlb1RyYWNrcygpWzBdLmVuYWJsZWQgPSAodGhpcy5zdHJlYW1UeXBlID09IFwiVklERU9cIikpO1xyXG5cclxuICAgICAgICB0aGlzLm9uR290UmVtb3RlU3RyZWFtKGV2ZW50LnN0cmVhbSwgdGhpcy5zdHJlYW1UeXBlKTtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gcmVjZWl2ZWQgcmVtb3RlIHN0cmVhbSwgeW91IHdpbGwgc2VlIHRoZSBvdGhlci4nKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25Hb3RTdHJlYW06IGZ1bmN0aW9uIChzdHJlYW0sIHN0cmVhbVR5cGUpIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gb24gZ290IGEgbG9jYWwgc3RyZWFtIDogJyArIHN0cmVhbVR5cGUpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvblNldFJlbW90ZVN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBfbG9nZ2VyLmluZm8oJ1tXZWJSVEMtQVBJXSBvblNldFJlbW90ZVN1Y2Nlc3MgY29tcGxldGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25TZXRMb2NhbFN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBfbG9nZ2VyLmluZm8oJ1tXZWJSVEMtQVBJXSBzZXRMb2NhbERlc2NyaXB0aW9uIGNvbXBsZXRlJyk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQWRkSWNlQ2FuZGlkYXRlU3VjY2VzczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoJ1tXZWJSVEMtQVBJXSBhZGRJY2VDYW5kaWRhdGUgc3VjY2VzcycpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvbkFkZEljZUNhbmRpZGF0ZUVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gZmFpbGVkIHRvIGFkZCBJQ0UgQ2FuZGlkYXRlOiAnICsgZXJyb3IudG9TdHJpbmcoKSk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uSWNlQ2FuZGlkYXRlOiBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gb25JY2VDYW5kaWRhdGUgOiBJQ0UgY2FuZGlkYXRlOiBcXG4nICsgZXZlbnQuY2FuZGlkYXRlKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25JY2VTdGF0ZUNoYW5nZTogZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZygnW1dlYlJUQy1BUEldIG9uSWNlU3RhdGVDaGFuZ2UgOiBJQ0Ugc3RhdGUgY2hhbmdlIGV2ZW50OiAnLCBldmVudCk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ3JlYXRlU2Vzc2lvbkRlc2NyaXB0aW9uRXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgIF9sb2dnZXIuZXJyb3IoJ1tXZWJSVEMtQVBJXSBGYWlsZWQgdG8gY3JlYXRlIHNlc3Npb24gZGVzY3JpcHRpb246ICcgKyBlcnJvci50b1N0cmluZygpKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25DcmVhdGVPZmZlclN1Y2Nlc3M6IGZ1bmN0aW9uIChkZXNjKSB7XHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZygnW1dlYlJUQy1BUEldIGNyZWF0ZSBvZmZlciBzdWNjZXNzJyk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ3JlYXRlUFJBbnN3ZXJTdWNjZXNzOiBmdW5jdGlvbiAoZGVzYykge1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoJ1tXZWJSVEMtQVBJXSBjcmVhdGUgYW5zd2VyIHN1Y2Nlc3MnKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25DcmVhdGVBbnN3ZXJTdWNjZXNzOiBmdW5jdGlvbiAoZGVzYykge1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoJ1tXZWJSVEMtQVBJXSBjcmVhdGUgYW5zd2VyIHN1Y2Nlc3MnKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25TZXRTZXNzaW9uRGVzY3JpcHRpb25FcnJvcjogZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgX2xvZ2dlci5lcnJvcignW1dlYlJUQy1BUEldIG9uU2V0U2Vzc2lvbkRlc2NyaXB0aW9uRXJyb3IgOiBGYWlsZWQgdG8gc2V0IHNlc3Npb24gZGVzY3JpcHRpb246ICcgKyBlcnJvci50b1N0cmluZygpKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25TZXRMb2NhbFNlc3Npb25EZXNjcmlwdGlvblN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKCdbV2ViUlRDLUFQSV0gb25TZXRMb2NhbFNlc3Npb25EZXNjcmlwdGlvblN1Y2Nlc3MgOiBzZXRMb2NhbERlc2NyaXB0aW9uIGNvbXBsZXRlJyk7XHJcbiAgICB9XHJcblxyXG5cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGluaXRDb25maWdzKSB7XHJcbiAgICBfdXRpbC5leHRlbmQodHJ1ZSwgdGhpcywgX1dlYlJUQywgaW5pdENvbmZpZ3MgfHwge30pO1xyXG59O1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicnRjL3NyYy9jb21wb25lbnRzL3dlYnJ0Yy5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF4SEE7QUFDQTtBQTBIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFmQTtBQUNBO0FBaUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBN01BO0FBQ0E7QUErTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBMVhBO0FBQ0E7QUE2WEE7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ 257:
/***/ (function(module, exports, __webpack_require__) {

	eval("'use strict';\n\n/**\r\n * P2P\r\n */\nvar _util = __webpack_require__(252);\nvar RouteTo = __webpack_require__(255).RouteTo;\nvar _logger = _util.logger;\n\nvar P2PRouteTo = RouteTo({\n    success: function success(result) {\n        _logger.debug(\"iq to server success\", result);\n    },\n    fail: function fail(error) {\n        _logger.debug(\"iq to server error\", error);\n    }\n});\n\nvar CommonPattern = {\n    _pingIntervalId: null,\n    _p2pConfig: null,\n    _rtcCfg: null,\n    _rtcCfg2: null,\n    _rtKey: null,\n    _rtFlag: null,\n\n    webRtc: null,\n    api: null,\n\n    callee: null,\n\n    isCaller: false,\n    accepted: false,\n\n    setLocalSDP: false,\n    setRemoteSDP: false,\n\n    hangup: false,\n\n    init: function init() {\n        var self = this;\n\n        self.api.onPing = function () {\n            self._onPing.apply(self, arguments);\n        };\n        self.api.onTcklC = function () {\n            self._onTcklC.apply(self, arguments);\n        };\n        self.api.onAcptC = function () {\n            self._onAcptC.apply(self, arguments);\n        };\n        self.api.onAnsC = function () {\n            self._onAnsC.apply(self, arguments);\n        };\n        self.api.onTermC = function () {\n            self._onTermC.apply(self, arguments);\n        };\n        self.api.onEvJoin = function () {\n            self._onEvJoin.apply(self, arguments);\n        };\n        self.api.onStreamControl = function () {\n            self._onStreamControl.apply(self, arguments);\n        };\n        self.webRtc.onIceCandidate = function () {\n            self._onIceCandidate.apply(self, arguments);\n        };\n        self.webRtc.onIceStateChange = function () {\n            self._onIceStateChange.apply(self, arguments);\n        };\n    },\n\n    _ping: function _ping() {\n        var self = this;\n\n        var index = 0;\n\n        function ping() {\n            var rt = new P2PRouteTo({\n                to: self.callee,\n                rtKey: self._rtKey\n            });\n\n            self.api.ping(rt, self._sessId, function (from, rtcOptions) {\n                _logger.debug(\"ping result\", rtcOptions);\n            });\n            // self.api.streamControl(rt, self._sessId, \"rtcId\", (index++) % 4, function (from, rtcOptions) {\n            //     _logger.debug(\"streamControl result\", rtcOptions);\n            //\n            // });\n        }\n\n        self._pingIntervalId = window.setInterval(ping, 50000);\n    },\n\n    _onPing: function _onPing(from, options, rtkey, tsxId, fromSid) {\n        _logger.debug('_onPing from', fromSid);\n    },\n\n    initC: function initC(mediaStreamConstaints, accessSid) {\n        var self = this;\n        self.sid = accessSid;\n\n        self.isCaller = true;\n        self.accepted = false;\n        self.setLocalSDP = false;\n        self.setRemoteSDP = false;\n        self.hangup = false;\n\n        self.streamType = mediaStreamConstaints.audio && mediaStreamConstaints.video ? \"VIDEO\" : \"VOICE\";\n\n        self.createLocalMedia(mediaStreamConstaints);\n    },\n\n    createLocalMedia: function createLocalMedia(mediaStreamConstaints) {\n        var self = this;\n\n        this.webRtc.createMedia(mediaStreamConstaints, function (webrtc, stream) {\n            webrtc.setLocalVideoSrcObject(stream);\n\n            self.webRtc.createRtcPeerConnection(self._rtcCfg);\n\n            self.webRtc.createOffer(function (offer) {\n                self._onGotWebRtcOffer(offer);\n            });\n        });\n    },\n\n    _onGotWebRtcOffer: function _onGotWebRtcOffer(offer) {\n        var self = this;\n\n        var rt = new P2PRouteTo({\n            sid: self.sid,\n            to: self.callee,\n            rtKey: self._rtKey\n        });\n\n        self.api.initC(rt, self.streamType, null, null, self._sessId, self._rtcId, null, null, offer, null, self._rtcCfg2, null, function (from, rtcOptions) {\n            _logger.debug(\"initc result\", rtcOptions);\n        });\n\n        self.setLocalSDP = true;\n\n        self._ping();\n    },\n\n    _onAcptC: function _onAcptC(from, options) {\n        var self = this;\n\n        if (options.ans && options.ans == 1) {\n            _logger.info(\"[WebRTC-API] _onAcptC : 104, ans = 1, it is a answer. will onAcceptCall\");\n            self.onAcceptCall(from, options, options.enableVoice !== false, options.enableVideo !== false);\n            self._onAnsC(from, options);\n        } else if (!WebIM.WebRTC.supportPRAnswer) {\n            _logger.info(\"[WebRTC-API] _onAcptC : not supported pranswer. drop it. will onAcceptCall\");\n\n            self.setRemoteSDP = false;\n            self._handRecvCandsOrSend(from, options);\n\n            self.onAcceptCall(from, options, options.enableVoice !== false, options.enableVideo !== false);\n        } else {\n            _logger.info(\"[WebRTC-API] _onAcptC : recv pranswer. \");\n\n            if (options.sdp || options.cands) {\n                // options.sdp && (options.sdp.type = \"pranswer\");\n                options.sdp && self.webRtc.setRemoteDescription(options.sdp);\n\n                self.setRemoteSDP = true;\n                self._handRecvCandsOrSend(from, options);\n\n                self.onAcceptCall(from, options, options.enableVoice !== false, options.enableVideo !== false);\n            }\n        }\n    },\n\n    _onEvJoin: function _onEvJoin(from, options, rtkey, tsxId, fromSid) {\n        var self = this;\n\n        _logger.debug('_onEvJoin from', fromSid, from);\n\n        self.onAcceptCall(from, options, options.enableVoice !== false, options.enableVideo !== false);\n    },\n\n    onAcceptCall: function onAcceptCall(from, options, enableVoice, enableVideo) {},\n\n    __onVoiceOrVideo: function __onVoiceOrVideo(from, options, fromSid) {\n        var self = this;\n\n        options.enableVoice === false ? self.onOtherUserOpenVoice(from, false) : self.onOtherUserOpenVoice(from, true);\n        options.enableVideo === false ? self.onOtherUserOpenVideo(from, false) : self.onOtherUserOpenVideo(from, true);\n    },\n\n    /*\r\n     * { verison : MSYNC_V1, compress_algorimth : 0, command : SYNC, payload : { meta : { id : 2326, to : easemob-demo#chatdemoui_xyj002@easemob.com, ns : CONFERENCE, payload : { session_id : xyj0011494320598055, operation : MEDIA_REQUEST, peer_name : xyj001, route_flag : 1, route_key : --X--, content : {\"op\":400,\"callVersion\":\"2.0.0\",\"sessId\":\"128542826909667328\",\"rtcId\":\"Channel1494320598056\",\"tsxId\":\"1494320622866-6\",\"controlType\":0}, control_type : PAUSE_VOICE } } } }\r\n     * PAUSE_VOICE(0, 0), RESUME_VOICE(1, 1), PAUSE_VIDEO(2, 2), RESUME_VIDEO(3, 3)\r\n     *\r\n     */\n    _onStreamControl: function _onStreamControl(from, options, rtkey, tsxId, fromSid) {\n        var self = this;\n        var controlType = options.controlType;\n\n        controlType === 0 && self.onOtherUserOpenVoice(from, false);\n        controlType === 1 && self.onOtherUserOpenVoice(from, true);\n        controlType === 2 && self.onOtherUserOpenVideo(from, false);\n        controlType === 3 && self.onOtherUserOpenVideo(from, true);\n\n        self.onStreamControl(from, options, rtkey, tsxId, fromSid);\n    },\n    onStreamControl: function onStreamControl(from, options, rtkey, tsxId, fromSid) {},\n\n    onOtherUserOpenVoice: function onOtherUserOpenVoice(from, opened) {\n        _logger.debug(\"from open:\", opened, \" voice .\", from);\n    },\n    onOtherUserOpenVideo: function onOtherUserOpenVideo(from, opened) {\n        _logger.debug(\"from open:\", opened, \" voideo .\", from);\n    },\n\n    _onAnsC: function _onAnsC(from, options) {\n        // answer\n        var self = this;\n\n        _logger.info(\"[WebRTC-API] _onAnsC : recv answer. \");\n\n        self.accepted = true;\n\n        options.sdp && self.webRtc.setRemoteDescription(options.sdp);\n\n        self.setRemoteSDP = true;\n        self._handRecvCandsOrSend(from, options);\n\n        self.__onVoiceOrVideo(from, options);\n    },\n\n    _onInitC: function _onInitC(from, options, rtkey, tsxId, fromSid) {\n        var self = this;\n\n        self.isCaller = false;\n        self.accepted = false;\n        self.setLocalSDP = false;\n        self.setRemoteSDP = false;\n        self.hangup = false;\n\n        self.callee = from;\n        self._rtcCfg2 = options.rtcCfg;\n        self._rtKey = rtkey;\n        self._tsxId = tsxId;\n        self._fromSid = fromSid;\n\n        self._rtcId = options.rtcId;\n        self._sessId = options.sessId;\n\n        self.streamType = options.streamType;\n\n        self.webRtc.createRtcPeerConnection(self._rtcCfg2);\n\n        options.sdp && _logger.debug(options.sdp.sdp);\n\n        options.sdp && self.webRtc.setRemoteDescription(options.sdp).then(function () {\n\n            self.setRemoteSDP = true;\n            self._handRecvCandsOrSend(from, options);\n\n            /*\r\n             * chrome 版本 大于 50时，可以使用pranswer。\r\n             * 小于50 不支持pranswer，此时处理逻辑是，直接进入振铃状态\r\n             *\r\n             */\n            if (WebIM.WebRTC.supportPRAnswer) {\n                self.webRtc.createPRAnswer(function (prAnswer) {\n                    self._onGotWebRtcPRAnswer(prAnswer);\n\n                    setTimeout(function () {\n                        //由于 chrome 在 pranswer时，ice状态只是 checking，并不能像sdk那样 期待 connected 振铃；所以目前改为 发送完pranswer后，直接振铃\n                        _logger.info(\"[WebRTC-API] onRinging : after send pranswer. \", self.callee);\n                        self.onRinging(self.callee, self.streamType);\n                    }, 500);\n                });\n            } else {\n                setTimeout(function () {\n                    _logger.info(\"[WebRTC-API] onRinging : After iniC, cause by: not supported pranswer. \", self.callee);\n                    self.onRinging(self.callee, self.streamType);\n                }, 500);\n                self._ping();\n            }\n        });\n    },\n\n    _onGotWebRtcPRAnswer: function _onGotWebRtcPRAnswer(prAnswer) {\n        var self = this;\n\n        var rt = new P2PRouteTo({\n            //tsxId: self._tsxId,\n            to: self.callee,\n            rtKey: self._rtKey\n        });\n\n        //self.api.acptC(rt, self._sessId, self._rtcId, prAnswer, null, 1);\n        self.api.acptC(rt, self._sessId, self._rtcId, prAnswer);\n\n        self.setLocalSDP = true;\n        self._handRecvCandsOrSend();\n\n        self._ping();\n    },\n\n    onRinging: function onRinging(caller, streamType) {},\n\n    accept: function accept() {\n        var self = this;\n\n        function createAndSendAnswer() {\n            _logger.info(\"createAndSendAnswer : ...... \");\n\n            self.webRtc.createAnswer(function (answer) {\n                var rt = new P2PRouteTo({\n                    //tsxId: self._tsxId,\n                    to: self.callee,\n                    rtKey: self._rtKey\n                });\n\n                if (WebIM.WebRTC.supportPRAnswer) {\n                    self.api.ansC(rt, self._sessId, self._rtcId, answer);\n                } else {\n                    self.api.acptC(rt, self._sessId, self._rtcId, answer, null, 1);\n                }\n\n                if (!WebIM.WebRTC.supportPRAnswer) {\n                    self.setLocalSDP = true;\n                }\n                self._handRecvCandsOrSend();\n\n                self.accepted = true;\n            });\n        }\n\n        var constaints = {\n            audio: true\n        };\n        if (self.streamType == \"VIDEO\") {\n            constaints.video = true;\n        }\n\n        self.webRtc.createMedia(constaints, function (webrtc, stream) {\n            webrtc.setLocalVideoSrcObject(stream);\n\n            createAndSendAnswer();\n        });\n    },\n\n    _handRecvCandsOrSend: function _handRecvCandsOrSend(from, options) {\n        var self = this;\n\n        setTimeout(function () {\n            self._onTcklC(from, options);\n        }, 50);\n\n        setTimeout(function () {\n            self._onIceCandidate();\n        }, 50);\n    },\n\n    _onTcklC: function _onTcklC(from, options) {\n        // setRemoteSDP，才可以添加 添加 对方 cands\n        var self = this;\n\n        // options.sdp && self.webRtc.setRemoteDescription(options.sdp);\n\n        if (self.setRemoteSDP) {\n            _logger.info(\"[WebRTC-API] recv and add cands.\");\n\n            self._recvCands && self._recvCands.length > 0 && self.webRtc.addIceCandidate(self._recvCands);\n            self._recvCands && self._recvCands.length > 0 && (self._recvCands = []);\n            options && options.cands && self.webRtc.addIceCandidate(options.cands);\n        } else if (options && options.cands && options.cands.length > 0) {\n            for (var i = 0; i < options.cands.length; i++) {\n                (self._recvCands || (self._recvCands = [])).push(options.cands[i]);\n            }\n            _logger.debug(\"[_onTcklC] temporary memory[recv] ice candidate. util setRemoteSDP = true\");\n        }\n    },\n\n    _onIceStateChange: function _onIceStateChange(event) {\n        var self = this;\n        event && _logger.debug(\"[WebRTC-API] \" + self.webRtc.iceConnectionState() + \" |||| ice state is \" + event.target.iceConnectionState);\n\n        if (event && event.target.iceConnectionState == \"closed\") {\n            self.setLocalSDP = false;\n            self.setRemoteSDP = false;\n        }\n\n        self.api.onIceConnectionStateChange(self.webRtc.iceConnectionState());\n    },\n\n    _onIceCandidate: function _onIceCandidate(event) {\n        //在本地sdp set 发送完成后，发送 cands\n        var self = this;\n\n        if (self.setLocalSDP) {\n            var sendIceCandidate = function sendIceCandidate(candidate) {\n                _logger.debug(\"send ice candidate...\");\n\n                var rt = new P2PRouteTo({\n                    to: self.callee,\n                    rtKey: self._rtKey\n                });\n\n                if (candidate) {\n                    self.api.tcklC(rt, self._sessId, self._rtcId, null, candidate);\n                }\n            };\n\n            if (self._cands && self._cands.length > 0) {\n\n                sendIceCandidate(self._cands);\n\n                self._cands = [];\n            }\n            event && event.candidate && sendIceCandidate(event.candidate);\n        } else {\n            event && event.candidate && (self._cands || (self._cands = [])).push(event.candidate);\n            _logger.debug(\"[_onIceCandidate] temporary memory[send] ice candidate. util setLocalSDP = true\");\n        }\n    },\n\n    termCall: function termCall(reason) {\n        var self = this;\n\n        self._pingIntervalId && window.clearInterval(self._pingIntervalId);\n\n        var rt = new P2PRouteTo({\n            to: self.callee,\n            rtKey: self._rtKey\n        });\n\n        var sendReason;\n        reason || !self.isCaller && !self.accepted && (sendReason = 'decline') || (sendReason = 'success');\n\n        self.hangup || self.api.termC(rt, self._sessId, self._rtcId, sendReason);\n\n        self.webRtc.close();\n\n        self.hangup = true;\n\n        self.setLocalSDP = false;\n        self.setRemoteSDP = false;\n\n        self.onTermCall(reason);\n    },\n\n    /**\r\n     *\r\n     * @param from\r\n     * @param options\r\n     * @param options.reason\r\n     *               \"ok\"      -> 'HANGUP'     \"success\" -> 'HANGUP'   \"timeout\"          -> 'NORESPONSE'\r\n     *               \"decline\" -> 'REJECT'     \"busy\"    -> 'BUSY'     \"failed-transport\" -> 'FAIL'\r\n     * @private\r\n     */\n    _onTermC: function _onTermC(from, options) {\n        _logger.debug(\"[_onTermC] options.reason = \" + options.reason);\n\n        var self = this;\n\n        self.hangup = true;\n\n        self.setLocalSDP = false;\n        self.setRemoteSDP = false;\n\n        self.termCall(options.reason);\n    },\n\n    onTermCall: function onTermCall() {\n        //to be overwrited by call.listener.onTermCall\n    }\n};\n\nmodule.exports = function (initConfigs) {\n    var self = this;\n\n    _util.extend(true, this, CommonPattern, initConfigs || {});\n\n    self.init();\n};\n\n/**\r\n * TODO: Conference\r\n */\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjU3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnJ0Yy9zcmMvY29tcG9uZW50cy9wMnAuanM/M2I2YyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogUDJQXHJcbiAqL1xyXG52YXIgX3V0aWwgPSByZXF1aXJlKCcuL3V0aWxzJyk7XHJcbnZhciBSb3V0ZVRvID0gcmVxdWlyZSgnLi9hcGknKS5Sb3V0ZVRvO1xyXG52YXIgX2xvZ2dlciA9IF91dGlsLmxvZ2dlcjtcclxuXHJcblxyXG52YXIgUDJQUm91dGVUbyA9IFJvdXRlVG8oe1xyXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoXCJpcSB0byBzZXJ2ZXIgc3VjY2Vzc1wiLCByZXN1bHQpO1xyXG4gICAgfSxcclxuICAgIGZhaWw6IGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoXCJpcSB0byBzZXJ2ZXIgZXJyb3JcIiwgZXJyb3IpO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG52YXIgQ29tbW9uUGF0dGVybiA9IHtcclxuICAgIF9waW5nSW50ZXJ2YWxJZDogbnVsbCxcclxuICAgIF9wMnBDb25maWc6IG51bGwsXHJcbiAgICBfcnRjQ2ZnOiBudWxsLFxyXG4gICAgX3J0Y0NmZzI6IG51bGwsXHJcbiAgICBfcnRLZXk6IG51bGwsXHJcbiAgICBfcnRGbGFnOiBudWxsLFxyXG5cclxuXHJcbiAgICB3ZWJSdGM6IG51bGwsXHJcbiAgICBhcGk6IG51bGwsXHJcblxyXG4gICAgY2FsbGVlOiBudWxsLFxyXG5cclxuXHJcbiAgICBpc0NhbGxlcjogZmFsc2UsXHJcbiAgICBhY2NlcHRlZDogZmFsc2UsXHJcblxyXG4gICAgc2V0TG9jYWxTRFA6IGZhbHNlLFxyXG4gICAgc2V0UmVtb3RlU0RQOiBmYWxzZSxcclxuXHJcbiAgICBoYW5ndXA6IGZhbHNlLFxyXG5cclxuXHJcbiAgICBpbml0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBzZWxmLmFwaS5vblBpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlbGYuX29uUGluZy5hcHBseShzZWxmLCBhcmd1bWVudHMpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgc2VsZi5hcGkub25UY2tsQyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VsZi5fb25UY2tsQy5hcHBseShzZWxmLCBhcmd1bWVudHMpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgc2VsZi5hcGkub25BY3B0QyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VsZi5fb25BY3B0Qy5hcHBseShzZWxmLCBhcmd1bWVudHMpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgc2VsZi5hcGkub25BbnNDID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZWxmLl9vbkFuc0MuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHNlbGYuYXBpLm9uVGVybUMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlbGYuX29uVGVybUMuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHNlbGYuYXBpLm9uRXZKb2luID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHNlbGYuX29uRXZKb2luLmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBzZWxmLmFwaS5vblN0cmVhbUNvbnRyb2wgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgc2VsZi5fb25TdHJlYW1Db250cm9sLmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBzZWxmLndlYlJ0Yy5vbkljZUNhbmRpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VsZi5fb25JY2VDYW5kaWRhdGUuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHNlbGYud2ViUnRjLm9uSWNlU3RhdGVDaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlbGYuX29uSWNlU3RhdGVDaGFuZ2UuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcclxuICAgICAgICB9O1xyXG4gICAgfSxcclxuXHJcbiAgICBfcGluZzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIGluZGV4ID0gMDtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcGluZygpIHtcclxuICAgICAgICAgICAgdmFyIHJ0ID0gbmV3IFAyUFJvdXRlVG8oe1xyXG4gICAgICAgICAgICAgICAgdG86IHNlbGYuY2FsbGVlLFxyXG4gICAgICAgICAgICAgICAgcnRLZXk6IHNlbGYuX3J0S2V5XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2VsZi5hcGkucGluZyhydCwgc2VsZi5fc2Vzc0lkLCBmdW5jdGlvbiAoZnJvbSwgcnRjT3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgX2xvZ2dlci5kZWJ1ZyhcInBpbmcgcmVzdWx0XCIsIHJ0Y09wdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIHNlbGYuYXBpLnN0cmVhbUNvbnRyb2wocnQsIHNlbGYuX3Nlc3NJZCwgXCJydGNJZFwiLCAoaW5kZXgrKykgJSA0LCBmdW5jdGlvbiAoZnJvbSwgcnRjT3B0aW9ucykge1xyXG4gICAgICAgICAgICAvLyAgICAgX2xvZ2dlci5kZWJ1ZyhcInN0cmVhbUNvbnRyb2wgcmVzdWx0XCIsIHJ0Y09wdGlvbnMpO1xyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNlbGYuX3BpbmdJbnRlcnZhbElkID0gd2luZG93LnNldEludGVydmFsKHBpbmcsIDUwMDAwKTtcclxuICAgIH0sXHJcblxyXG4gICAgX29uUGluZzogZnVuY3Rpb24gKGZyb20sIG9wdGlvbnMsIHJ0a2V5LCB0c3hJZCwgZnJvbVNpZCkge1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoJ19vblBpbmcgZnJvbScsIGZyb21TaWQpO1xyXG4gICAgfSxcclxuXHJcbiAgICBpbml0QzogZnVuY3Rpb24gKG1lZGlhU3RyZWFtQ29uc3RhaW50cywgYWNjZXNzU2lkKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYuc2lkID0gYWNjZXNzU2lkO1xyXG5cclxuICAgICAgICBzZWxmLmlzQ2FsbGVyID0gdHJ1ZTtcclxuICAgICAgICBzZWxmLmFjY2VwdGVkID0gZmFsc2U7XHJcbiAgICAgICAgc2VsZi5zZXRMb2NhbFNEUCA9IGZhbHNlO1xyXG4gICAgICAgIHNlbGYuc2V0UmVtb3RlU0RQID0gZmFsc2U7XHJcbiAgICAgICAgc2VsZi5oYW5ndXAgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgc2VsZi5zdHJlYW1UeXBlID0gbWVkaWFTdHJlYW1Db25zdGFpbnRzLmF1ZGlvICYmIG1lZGlhU3RyZWFtQ29uc3RhaW50cy52aWRlbyA/IFwiVklERU9cIiA6IFwiVk9JQ0VcIjtcclxuXHJcbiAgICAgICAgc2VsZi5jcmVhdGVMb2NhbE1lZGlhKG1lZGlhU3RyZWFtQ29uc3RhaW50cyk7XHJcbiAgICB9LFxyXG5cclxuICAgIGNyZWF0ZUxvY2FsTWVkaWE6IGZ1bmN0aW9uIChtZWRpYVN0cmVhbUNvbnN0YWludHMpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHRoaXMud2ViUnRjLmNyZWF0ZU1lZGlhKG1lZGlhU3RyZWFtQ29uc3RhaW50cywgZnVuY3Rpb24gKHdlYnJ0Yywgc3RyZWFtKSB7XHJcbiAgICAgICAgICAgIHdlYnJ0Yy5zZXRMb2NhbFZpZGVvU3JjT2JqZWN0KHN0cmVhbSk7XHJcblxyXG4gICAgICAgICAgICBzZWxmLndlYlJ0Yy5jcmVhdGVSdGNQZWVyQ29ubmVjdGlvbihzZWxmLl9ydGNDZmcpO1xyXG5cclxuICAgICAgICAgICAgc2VsZi53ZWJSdGMuY3JlYXRlT2ZmZXIoZnVuY3Rpb24gKG9mZmVyKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLl9vbkdvdFdlYlJ0Y09mZmVyKG9mZmVyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9vbkdvdFdlYlJ0Y09mZmVyOiBmdW5jdGlvbiAob2ZmZXIpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciBydCA9IG5ldyBQMlBSb3V0ZVRvKHtcclxuICAgICAgICAgICAgc2lkOiBzZWxmLnNpZCxcclxuICAgICAgICAgICAgdG86IHNlbGYuY2FsbGVlLFxyXG4gICAgICAgICAgICBydEtleTogc2VsZi5fcnRLZXlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc2VsZi5hcGkuaW5pdEMocnQsIHNlbGYuc3RyZWFtVHlwZSwgbnVsbCwgbnVsbCwgc2VsZi5fc2Vzc0lkLCBzZWxmLl9ydGNJZCwgbnVsbCwgbnVsbCwgb2ZmZXIsIG51bGwsIHNlbGYuX3J0Y0NmZzIsIG51bGwsIGZ1bmN0aW9uIChmcm9tLCBydGNPcHRpb25zKSB7XHJcbiAgICAgICAgICAgIF9sb2dnZXIuZGVidWcoXCJpbml0YyByZXN1bHRcIiwgcnRjT3B0aW9ucyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNlbGYuc2V0TG9jYWxTRFAgPSB0cnVlO1xyXG5cclxuICAgICAgICBzZWxmLl9waW5nKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9vbkFjcHRDOiBmdW5jdGlvbiAoZnJvbSwgb3B0aW9ucykge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuYW5zICYmIG9wdGlvbnMuYW5zID09IDEpIHtcclxuICAgICAgICAgICAgX2xvZ2dlci5pbmZvKFwiW1dlYlJUQy1BUEldIF9vbkFjcHRDIDogMTA0LCBhbnMgPSAxLCBpdCBpcyBhIGFuc3dlci4gd2lsbCBvbkFjY2VwdENhbGxcIik7XHJcbiAgICAgICAgICAgIHNlbGYub25BY2NlcHRDYWxsKGZyb20sIG9wdGlvbnMsIG9wdGlvbnMuZW5hYmxlVm9pY2UgIT09IGZhbHNlLCBvcHRpb25zLmVuYWJsZVZpZGVvICE9PSBmYWxzZSk7XHJcbiAgICAgICAgICAgIHNlbGYuX29uQW5zQyhmcm9tLCBvcHRpb25zKTtcclxuICAgICAgICB9IGVsc2UgaWYgKCFXZWJJTS5XZWJSVEMuc3VwcG9ydFBSQW5zd2VyKSB7XHJcbiAgICAgICAgICAgIF9sb2dnZXIuaW5mbyhcIltXZWJSVEMtQVBJXSBfb25BY3B0QyA6IG5vdCBzdXBwb3J0ZWQgcHJhbnN3ZXIuIGRyb3AgaXQuIHdpbGwgb25BY2NlcHRDYWxsXCIpO1xyXG5cclxuICAgICAgICAgICAgc2VsZi5zZXRSZW1vdGVTRFAgPSBmYWxzZTtcclxuICAgICAgICAgICAgc2VsZi5faGFuZFJlY3ZDYW5kc09yU2VuZChmcm9tLCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgIHNlbGYub25BY2NlcHRDYWxsKGZyb20sIG9wdGlvbnMsIG9wdGlvbnMuZW5hYmxlVm9pY2UgIT09IGZhbHNlLCBvcHRpb25zLmVuYWJsZVZpZGVvICE9PSBmYWxzZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgX2xvZ2dlci5pbmZvKFwiW1dlYlJUQy1BUEldIF9vbkFjcHRDIDogcmVjdiBwcmFuc3dlci4gXCIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuc2RwIHx8IG9wdGlvbnMuY2FuZHMpIHtcclxuICAgICAgICAgICAgICAgIC8vIG9wdGlvbnMuc2RwICYmIChvcHRpb25zLnNkcC50eXBlID0gXCJwcmFuc3dlclwiKTtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuc2RwICYmIHNlbGYud2ViUnRjLnNldFJlbW90ZURlc2NyaXB0aW9uKG9wdGlvbnMuc2RwKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZWxmLnNldFJlbW90ZVNEUCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBzZWxmLl9oYW5kUmVjdkNhbmRzT3JTZW5kKGZyb20sIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNlbGYub25BY2NlcHRDYWxsKGZyb20sIG9wdGlvbnMsIG9wdGlvbnMuZW5hYmxlVm9pY2UgIT09IGZhbHNlLCBvcHRpb25zLmVuYWJsZVZpZGVvICE9PSBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIF9vbkV2Sm9pbjogZnVuY3Rpb24gKGZyb20sIG9wdGlvbnMsIHJ0a2V5LCB0c3hJZCwgZnJvbVNpZCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgX2xvZ2dlci5kZWJ1ZygnX29uRXZKb2luIGZyb20nLCBmcm9tU2lkLCBmcm9tKTtcclxuXHJcbiAgICAgICAgc2VsZi5vbkFjY2VwdENhbGwoZnJvbSwgb3B0aW9ucywgb3B0aW9ucy5lbmFibGVWb2ljZSAhPT0gZmFsc2UsIG9wdGlvbnMuZW5hYmxlVmlkZW8gIT09IGZhbHNlKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25BY2NlcHRDYWxsOiBmdW5jdGlvbiAoZnJvbSwgb3B0aW9ucywgZW5hYmxlVm9pY2UsIGVuYWJsZVZpZGVvKSB7XHJcblxyXG4gICAgfSxcclxuXHJcbiAgICBfX29uVm9pY2VPclZpZGVvOiBmdW5jdGlvbihmcm9tLCBvcHRpb25zLCBmcm9tU2lkKXtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIG9wdGlvbnMuZW5hYmxlVm9pY2UgPT09IGZhbHNlID8gKHNlbGYub25PdGhlclVzZXJPcGVuVm9pY2UoZnJvbSwgZmFsc2UpKSA6IChzZWxmLm9uT3RoZXJVc2VyT3BlblZvaWNlKGZyb20sIHRydWUpKTtcclxuICAgICAgICBvcHRpb25zLmVuYWJsZVZpZGVvID09PSBmYWxzZSA/IChzZWxmLm9uT3RoZXJVc2VyT3BlblZpZGVvKGZyb20sIGZhbHNlKSkgOiAoc2VsZi5vbk90aGVyVXNlck9wZW5WaWRlbyhmcm9tLCB0cnVlKSk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qXHJcbiAgICAgKiB7IHZlcmlzb24gOiBNU1lOQ19WMSwgY29tcHJlc3NfYWxnb3JpbXRoIDogMCwgY29tbWFuZCA6IFNZTkMsIHBheWxvYWQgOiB7IG1ldGEgOiB7IGlkIDogMjMyNiwgdG8gOiBlYXNlbW9iLWRlbW8jY2hhdGRlbW91aV94eWowMDJAZWFzZW1vYi5jb20sIG5zIDogQ09ORkVSRU5DRSwgcGF5bG9hZCA6IHsgc2Vzc2lvbl9pZCA6IHh5ajAwMTE0OTQzMjA1OTgwNTUsIG9wZXJhdGlvbiA6IE1FRElBX1JFUVVFU1QsIHBlZXJfbmFtZSA6IHh5ajAwMSwgcm91dGVfZmxhZyA6IDEsIHJvdXRlX2tleSA6IC0tWC0tLCBjb250ZW50IDoge1wib3BcIjo0MDAsXCJjYWxsVmVyc2lvblwiOlwiMi4wLjBcIixcInNlc3NJZFwiOlwiMTI4NTQyODI2OTA5NjY3MzI4XCIsXCJydGNJZFwiOlwiQ2hhbm5lbDE0OTQzMjA1OTgwNTZcIixcInRzeElkXCI6XCIxNDk0MzIwNjIyODY2LTZcIixcImNvbnRyb2xUeXBlXCI6MH0sIGNvbnRyb2xfdHlwZSA6IFBBVVNFX1ZPSUNFIH0gfSB9IH1cclxuICAgICAqIFBBVVNFX1ZPSUNFKDAsIDApLCBSRVNVTUVfVk9JQ0UoMSwgMSksIFBBVVNFX1ZJREVPKDIsIDIpLCBSRVNVTUVfVklERU8oMywgMylcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIF9vblN0cmVhbUNvbnRyb2w6IGZ1bmN0aW9uIChmcm9tLCBvcHRpb25zLCBydGtleSwgdHN4SWQsIGZyb21TaWQpe1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICB2YXIgY29udHJvbFR5cGUgPSBvcHRpb25zLmNvbnRyb2xUeXBlO1xyXG5cclxuICAgICAgICBjb250cm9sVHlwZSA9PT0gMCAmJiAoc2VsZi5vbk90aGVyVXNlck9wZW5Wb2ljZShmcm9tLCBmYWxzZSkpO1xyXG4gICAgICAgIGNvbnRyb2xUeXBlID09PSAxICYmIChzZWxmLm9uT3RoZXJVc2VyT3BlblZvaWNlKGZyb20sIHRydWUpKTtcclxuICAgICAgICBjb250cm9sVHlwZSA9PT0gMiAmJiAoc2VsZi5vbk90aGVyVXNlck9wZW5WaWRlbyhmcm9tLCBmYWxzZSkpO1xyXG4gICAgICAgIGNvbnRyb2xUeXBlID09PSAzICYmIChzZWxmLm9uT3RoZXJVc2VyT3BlblZpZGVvKGZyb20sIHRydWUpKTtcclxuXHJcbiAgICAgICAgc2VsZi5vblN0cmVhbUNvbnRyb2woZnJvbSwgb3B0aW9ucywgcnRrZXksIHRzeElkLCBmcm9tU2lkKTtcclxuICAgIH0sXHJcbiAgICBvblN0cmVhbUNvbnRyb2w6IGZ1bmN0aW9uIChmcm9tLCBvcHRpb25zLCBydGtleSwgdHN4SWQsIGZyb21TaWQpe1xyXG5cclxuICAgIH0sXHJcblxyXG4gICAgb25PdGhlclVzZXJPcGVuVm9pY2U6IGZ1bmN0aW9uIChmcm9tLCBvcGVuZWQpe1xyXG4gICAgICAgIF9sb2dnZXIuZGVidWcoXCJmcm9tIG9wZW46XCIsIG9wZW5lZCwgXCIgdm9pY2UgLlwiLCBmcm9tKVxyXG4gICAgfSxcclxuICAgIG9uT3RoZXJVc2VyT3BlblZpZGVvOiBmdW5jdGlvbiAoZnJvbSwgb3BlbmVkKXtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKFwiZnJvbSBvcGVuOlwiLCBvcGVuZWQsIFwiIHZvaWRlbyAuXCIsIGZyb20pXHJcbiAgICB9LFxyXG5cclxuXHJcbiAgICBfb25BbnNDOiBmdW5jdGlvbiAoZnJvbSwgb3B0aW9ucykgeyAvLyBhbnN3ZXJcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIF9sb2dnZXIuaW5mbyhcIltXZWJSVEMtQVBJXSBfb25BbnNDIDogcmVjdiBhbnN3ZXIuIFwiKTtcclxuXHJcbiAgICAgICAgc2VsZi5hY2NlcHRlZCA9IHRydWU7XHJcblxyXG4gICAgICAgIG9wdGlvbnMuc2RwICYmIHNlbGYud2ViUnRjLnNldFJlbW90ZURlc2NyaXB0aW9uKG9wdGlvbnMuc2RwKTtcclxuXHJcbiAgICAgICAgc2VsZi5zZXRSZW1vdGVTRFAgPSB0cnVlO1xyXG4gICAgICAgIHNlbGYuX2hhbmRSZWN2Q2FuZHNPclNlbmQoZnJvbSwgb3B0aW9ucyk7XHJcblxyXG5cclxuICAgICAgICBzZWxmLl9fb25Wb2ljZU9yVmlkZW8oZnJvbSwgb3B0aW9ucyk7XHJcbiAgICB9LFxyXG5cclxuXHJcbiAgICBfb25Jbml0QzogZnVuY3Rpb24gKGZyb20sIG9wdGlvbnMsIHJ0a2V5LCB0c3hJZCwgZnJvbVNpZCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2VsZi5pc0NhbGxlciA9IGZhbHNlO1xyXG4gICAgICAgIHNlbGYuYWNjZXB0ZWQgPSBmYWxzZTtcclxuICAgICAgICBzZWxmLnNldExvY2FsU0RQID0gZmFsc2U7XHJcbiAgICAgICAgc2VsZi5zZXRSZW1vdGVTRFAgPSBmYWxzZTtcclxuICAgICAgICBzZWxmLmhhbmd1cCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBzZWxmLmNhbGxlZSA9IGZyb207XHJcbiAgICAgICAgc2VsZi5fcnRjQ2ZnMiA9IG9wdGlvbnMucnRjQ2ZnO1xyXG4gICAgICAgIHNlbGYuX3J0S2V5ID0gcnRrZXk7XHJcbiAgICAgICAgc2VsZi5fdHN4SWQgPSB0c3hJZDtcclxuICAgICAgICBzZWxmLl9mcm9tU2lkID0gZnJvbVNpZDtcclxuXHJcbiAgICAgICAgc2VsZi5fcnRjSWQgPSBvcHRpb25zLnJ0Y0lkO1xyXG4gICAgICAgIHNlbGYuX3Nlc3NJZCA9IG9wdGlvbnMuc2Vzc0lkO1xyXG5cclxuICAgICAgICBzZWxmLnN0cmVhbVR5cGUgPSBvcHRpb25zLnN0cmVhbVR5cGU7XHJcblxyXG4gICAgICAgIHNlbGYud2ViUnRjLmNyZWF0ZVJ0Y1BlZXJDb25uZWN0aW9uKHNlbGYuX3J0Y0NmZzIpO1xyXG5cclxuICAgICAgICBvcHRpb25zLnNkcCAmJiBfbG9nZ2VyLmRlYnVnKG9wdGlvbnMuc2RwLnNkcCk7XHJcblxyXG4gICAgICAgIG9wdGlvbnMuc2RwICYmIChzZWxmLndlYlJ0Yy5zZXRSZW1vdGVEZXNjcmlwdGlvbihvcHRpb25zLnNkcCkudGhlbihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICBzZWxmLnNldFJlbW90ZVNEUCA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlbGYuX2hhbmRSZWN2Q2FuZHNPclNlbmQoZnJvbSwgb3B0aW9ucyk7XHJcblxyXG4gICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICAgKiBjaHJvbWUg54mI5pysIOWkp+S6jiA1MOaXtu+8jOWPr+S7peS9v+eUqHByYW5zd2Vy44CCXHJcbiAgICAgICAgICAgICAqIOWwj+S6jjUwIOS4jeaUr+aMgXByYW5zd2Vy77yM5q2k5pe25aSE55CG6YC76L6R5piv77yM55u05o6l6L+b5YWl5oyv6ZOD54q25oCBXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBpZiAoV2ViSU0uV2ViUlRDLnN1cHBvcnRQUkFuc3dlcikge1xyXG4gICAgICAgICAgICAgICAgc2VsZi53ZWJSdGMuY3JlYXRlUFJBbnN3ZXIoZnVuY3Rpb24gKHByQW5zd2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25Hb3RXZWJSdGNQUkFuc3dlcihwckFuc3dlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyAvL+eUseS6jiBjaHJvbWUg5ZyoIHByYW5zd2Vy5pe277yMaWNl54q25oCB5Y+q5pivIGNoZWNraW5n77yM5bm25LiN6IO95YOPc2Rr6YKj5qC3IOacn+W+hSBjb25uZWN0ZWQg5oyv6ZOD77yb5omA5Lul55uu5YmN5pS55Li6IOWPkemAgeWujHByYW5zd2Vy5ZCO77yM55u05o6l5oyv6ZODXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2dnZXIuaW5mbyhcIltXZWJSVEMtQVBJXSBvblJpbmdpbmcgOiBhZnRlciBzZW5kIHByYW5zd2VyLiBcIiwgc2VsZi5jYWxsZWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm9uUmluZ2luZyhzZWxmLmNhbGxlZSwgc2VsZi5zdHJlYW1UeXBlKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCA1MDApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBfbG9nZ2VyLmluZm8oXCJbV2ViUlRDLUFQSV0gb25SaW5naW5nIDogQWZ0ZXIgaW5pQywgY2F1c2UgYnk6IG5vdCBzdXBwb3J0ZWQgcHJhbnN3ZXIuIFwiLCBzZWxmLmNhbGxlZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5vblJpbmdpbmcoc2VsZi5jYWxsZWUsIHNlbGYuc3RyZWFtVHlwZSk7XHJcbiAgICAgICAgICAgICAgICB9LCA1MDApXHJcbiAgICAgICAgICAgICAgICBzZWxmLl9waW5nKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSk7XHJcbiAgICB9LFxyXG5cclxuXHJcbiAgICBfb25Hb3RXZWJSdGNQUkFuc3dlcjogZnVuY3Rpb24gKHByQW5zd2VyKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgcnQgPSBuZXcgUDJQUm91dGVUbyh7XHJcbiAgICAgICAgICAgIC8vdHN4SWQ6IHNlbGYuX3RzeElkLFxyXG4gICAgICAgICAgICB0bzogc2VsZi5jYWxsZWUsXHJcbiAgICAgICAgICAgIHJ0S2V5OiBzZWxmLl9ydEtleVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvL3NlbGYuYXBpLmFjcHRDKHJ0LCBzZWxmLl9zZXNzSWQsIHNlbGYuX3J0Y0lkLCBwckFuc3dlciwgbnVsbCwgMSk7XHJcbiAgICAgICAgc2VsZi5hcGkuYWNwdEMocnQsIHNlbGYuX3Nlc3NJZCwgc2VsZi5fcnRjSWQsIHByQW5zd2VyKTtcclxuXHJcbiAgICAgICAgc2VsZi5zZXRMb2NhbFNEUCA9IHRydWU7XHJcbiAgICAgICAgc2VsZi5faGFuZFJlY3ZDYW5kc09yU2VuZCgpO1xyXG5cclxuICAgICAgICBzZWxmLl9waW5nKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uUmluZ2luZzogZnVuY3Rpb24gKGNhbGxlciwgc3RyZWFtVHlwZSkge1xyXG4gICAgfSxcclxuXHJcbiAgICBhY2NlcHQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUFuZFNlbmRBbnN3ZXIoKSB7XHJcbiAgICAgICAgICAgIF9sb2dnZXIuaW5mbyhcImNyZWF0ZUFuZFNlbmRBbnN3ZXIgOiAuLi4uLi4gXCIpO1xyXG5cclxuICAgICAgICAgICAgc2VsZi53ZWJSdGMuY3JlYXRlQW5zd2VyKGZ1bmN0aW9uIChhbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBydCA9IG5ldyBQMlBSb3V0ZVRvKHtcclxuICAgICAgICAgICAgICAgICAgICAvL3RzeElkOiBzZWxmLl90c3hJZCxcclxuICAgICAgICAgICAgICAgICAgICB0bzogc2VsZi5jYWxsZWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcnRLZXk6IHNlbGYuX3J0S2V5XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoV2ViSU0uV2ViUlRDLnN1cHBvcnRQUkFuc3dlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYXBpLmFuc0MocnQsIHNlbGYuX3Nlc3NJZCwgc2VsZi5fcnRjSWQsIGFuc3dlcik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYXBpLmFjcHRDKHJ0LCBzZWxmLl9zZXNzSWQsIHNlbGYuX3J0Y0lkLCBhbnN3ZXIsIG51bGwsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghV2ViSU0uV2ViUlRDLnN1cHBvcnRQUkFuc3dlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0TG9jYWxTRFAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2VsZi5faGFuZFJlY3ZDYW5kc09yU2VuZCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNlbGYuYWNjZXB0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBjb25zdGFpbnRzID0ge1xyXG4gICAgICAgICAgICBhdWRpbzogdHJ1ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYoc2VsZi5zdHJlYW1UeXBlID09IFwiVklERU9cIil7XHJcbiAgICAgICAgICAgIGNvbnN0YWludHMudmlkZW8gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2VsZi53ZWJSdGMuY3JlYXRlTWVkaWEoY29uc3RhaW50cywgZnVuY3Rpb24gKHdlYnJ0Yywgc3RyZWFtKSB7XHJcbiAgICAgICAgICAgIHdlYnJ0Yy5zZXRMb2NhbFZpZGVvU3JjT2JqZWN0KHN0cmVhbSk7XHJcblxyXG4gICAgICAgICAgICBjcmVhdGVBbmRTZW5kQW5zd2VyKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9oYW5kUmVjdkNhbmRzT3JTZW5kOiBmdW5jdGlvbiAoZnJvbSwgb3B0aW9ucykge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlbGYuX29uVGNrbEMoZnJvbSwgb3B0aW9ucyk7XHJcbiAgICAgICAgfSwgNTApO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VsZi5fb25JY2VDYW5kaWRhdGUoKTtcclxuICAgICAgICB9LCA1MCk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9vblRja2xDOiBmdW5jdGlvbiAoZnJvbSwgb3B0aW9ucykgeyAvLyBzZXRSZW1vdGVTRFDvvIzmiY3lj6/ku6Xmt7vliqAg5re75YqgIOWvueaWuSBjYW5kc1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgLy8gb3B0aW9ucy5zZHAgJiYgc2VsZi53ZWJSdGMuc2V0UmVtb3RlRGVzY3JpcHRpb24ob3B0aW9ucy5zZHApO1xyXG5cclxuICAgICAgICBpZiAoc2VsZi5zZXRSZW1vdGVTRFApIHtcclxuICAgICAgICAgICAgX2xvZ2dlci5pbmZvKFwiW1dlYlJUQy1BUEldIHJlY3YgYW5kIGFkZCBjYW5kcy5cIik7XHJcblxyXG4gICAgICAgICAgICBzZWxmLl9yZWN2Q2FuZHMgJiYgc2VsZi5fcmVjdkNhbmRzLmxlbmd0aCA+IDAgJiYgc2VsZi53ZWJSdGMuYWRkSWNlQ2FuZGlkYXRlKHNlbGYuX3JlY3ZDYW5kcyk7XHJcbiAgICAgICAgICAgIHNlbGYuX3JlY3ZDYW5kcyAmJiBzZWxmLl9yZWN2Q2FuZHMubGVuZ3RoID4gMCAmJiAoc2VsZi5fcmVjdkNhbmRzID0gW10pO1xyXG4gICAgICAgICAgICBvcHRpb25zICYmIG9wdGlvbnMuY2FuZHMgJiYgc2VsZi53ZWJSdGMuYWRkSWNlQ2FuZGlkYXRlKG9wdGlvbnMuY2FuZHMpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNhbmRzICYmIG9wdGlvbnMuY2FuZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMuY2FuZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIChzZWxmLl9yZWN2Q2FuZHMgfHwgKHNlbGYuX3JlY3ZDYW5kcyA9IFtdKSkucHVzaChvcHRpb25zLmNhbmRzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfbG9nZ2VyLmRlYnVnKFwiW19vblRja2xDXSB0ZW1wb3JhcnkgbWVtb3J5W3JlY3ZdIGljZSBjYW5kaWRhdGUuIHV0aWwgc2V0UmVtb3RlU0RQID0gdHJ1ZVwiKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIF9vbkljZVN0YXRlQ2hhbmdlOiBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgZXZlbnQgJiYgX2xvZ2dlci5kZWJ1ZyhcIltXZWJSVEMtQVBJXSBcIiArIHNlbGYud2ViUnRjLmljZUNvbm5lY3Rpb25TdGF0ZSgpICsgXCIgfHx8fCBpY2Ugc3RhdGUgaXMgXCIgKyBldmVudC50YXJnZXQuaWNlQ29ubmVjdGlvblN0YXRlKTtcclxuXHJcblxyXG4gICAgICAgIGlmKGV2ZW50ICYmIGV2ZW50LnRhcmdldC5pY2VDb25uZWN0aW9uU3RhdGUgPT0gXCJjbG9zZWRcIil7XHJcbiAgICAgICAgICAgIHNlbGYuc2V0TG9jYWxTRFAgPSBmYWxzZTtcclxuICAgICAgICAgICAgc2VsZi5zZXRSZW1vdGVTRFAgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNlbGYuYXBpLm9uSWNlQ29ubmVjdGlvblN0YXRlQ2hhbmdlKHNlbGYud2ViUnRjLmljZUNvbm5lY3Rpb25TdGF0ZSgpKTtcclxuICAgIH0sXHJcblxyXG4gICAgX29uSWNlQ2FuZGlkYXRlOiBmdW5jdGlvbiAoZXZlbnQpIHsgLy/lnKjmnKzlnLBzZHAgc2V0IOWPkemAgeWujOaIkOWQju+8jOWPkemAgSBjYW5kc1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgaWYgKHNlbGYuc2V0TG9jYWxTRFApIHtcclxuICAgICAgICAgICAgZnVuY3Rpb24gc2VuZEljZUNhbmRpZGF0ZShjYW5kaWRhdGUpIHtcclxuICAgICAgICAgICAgICAgIF9sb2dnZXIuZGVidWcoXCJzZW5kIGljZSBjYW5kaWRhdGUuLi5cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJ0ID0gbmV3IFAyUFJvdXRlVG8oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRvOiBzZWxmLmNhbGxlZSxcclxuICAgICAgICAgICAgICAgICAgICBydEtleTogc2VsZi5fcnRLZXlcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjYW5kaWRhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmFwaS50Y2tsQyhydCwgc2VsZi5fc2Vzc0lkLCBzZWxmLl9ydGNJZCwgbnVsbCwgY2FuZGlkYXRlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHNlbGYuX2NhbmRzICYmIHNlbGYuX2NhbmRzLmxlbmd0aCA+IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICBzZW5kSWNlQ2FuZGlkYXRlKHNlbGYuX2NhbmRzKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZWxmLl9jYW5kcyA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGV2ZW50ICYmIGV2ZW50LmNhbmRpZGF0ZSAmJiBzZW5kSWNlQ2FuZGlkYXRlKGV2ZW50LmNhbmRpZGF0ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZXZlbnQgJiYgZXZlbnQuY2FuZGlkYXRlICYmIChzZWxmLl9jYW5kcyB8fCAoc2VsZi5fY2FuZHMgPSBbXSkpLnB1c2goZXZlbnQuY2FuZGlkYXRlKTtcclxuICAgICAgICAgICAgX2xvZ2dlci5kZWJ1ZyhcIltfb25JY2VDYW5kaWRhdGVdIHRlbXBvcmFyeSBtZW1vcnlbc2VuZF0gaWNlIGNhbmRpZGF0ZS4gdXRpbCBzZXRMb2NhbFNEUCA9IHRydWVcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcblxyXG4gICAgdGVybUNhbGw6IGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNlbGYuX3BpbmdJbnRlcnZhbElkICYmIHdpbmRvdy5jbGVhckludGVydmFsKHNlbGYuX3BpbmdJbnRlcnZhbElkKTtcclxuXHJcbiAgICAgICAgdmFyIHJ0ID0gbmV3IFAyUFJvdXRlVG8oe1xyXG4gICAgICAgICAgICB0bzogc2VsZi5jYWxsZWUsXHJcbiAgICAgICAgICAgIHJ0S2V5OiBzZWxmLl9ydEtleVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgc2VuZFJlYXNvbjtcclxuICAgICAgICByZWFzb24gfHwgKCFzZWxmLmlzQ2FsbGVyICYmICFzZWxmLmFjY2VwdGVkICYmIChzZW5kUmVhc29uID0gJ2RlY2xpbmUnKSkgfHwgKHNlbmRSZWFzb24gPSAnc3VjY2VzcycpO1xyXG5cclxuICAgICAgICBzZWxmLmhhbmd1cCB8fCBzZWxmLmFwaS50ZXJtQyhydCwgc2VsZi5fc2Vzc0lkLCBzZWxmLl9ydGNJZCwgc2VuZFJlYXNvbik7XHJcblxyXG4gICAgICAgIHNlbGYud2ViUnRjLmNsb3NlKCk7XHJcblxyXG4gICAgICAgIHNlbGYuaGFuZ3VwID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgc2VsZi5zZXRMb2NhbFNEUCA9IGZhbHNlO1xyXG4gICAgICAgIHNlbGYuc2V0UmVtb3RlU0RQID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHNlbGYub25UZXJtQ2FsbChyZWFzb24pO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZnJvbVxyXG4gICAgICogQHBhcmFtIG9wdGlvbnNcclxuICAgICAqIEBwYXJhbSBvcHRpb25zLnJlYXNvblxyXG4gICAgICogICAgICAgICAgICAgICBcIm9rXCIgICAgICAtPiAnSEFOR1VQJyAgICAgXCJzdWNjZXNzXCIgLT4gJ0hBTkdVUCcgICBcInRpbWVvdXRcIiAgICAgICAgICAtPiAnTk9SRVNQT05TRSdcclxuICAgICAqICAgICAgICAgICAgICAgXCJkZWNsaW5lXCIgLT4gJ1JFSkVDVCcgICAgIFwiYnVzeVwiICAgIC0+ICdCVVNZJyAgICAgXCJmYWlsZWQtdHJhbnNwb3J0XCIgLT4gJ0ZBSUwnXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICovXHJcbiAgICBfb25UZXJtQzogZnVuY3Rpb24gKGZyb20sIG9wdGlvbnMpIHtcclxuICAgICAgICBfbG9nZ2VyLmRlYnVnKFwiW19vblRlcm1DXSBvcHRpb25zLnJlYXNvbiA9IFwiICsgb3B0aW9ucy5yZWFzb24pO1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNlbGYuaGFuZ3VwID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgc2VsZi5zZXRMb2NhbFNEUCA9IGZhbHNlO1xyXG4gICAgICAgIHNlbGYuc2V0UmVtb3RlU0RQID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHNlbGYudGVybUNhbGwob3B0aW9ucy5yZWFzb24pO1xyXG5cclxuICAgIH0sXHJcblxyXG4gICAgb25UZXJtQ2FsbDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vdG8gYmUgb3ZlcndyaXRlZCBieSBjYWxsLmxpc3RlbmVyLm9uVGVybUNhbGxcclxuICAgIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGluaXRDb25maWdzKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgX3V0aWwuZXh0ZW5kKHRydWUsIHRoaXMsIENvbW1vblBhdHRlcm4sIGluaXRDb25maWdzIHx8IHt9KTtcclxuXHJcbiAgICBzZWxmLmluaXQoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBUT0RPOiBDb25mZXJlbmNlXHJcbiAqL1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicnRjL3NyYy9jb21wb25lbnRzL3AycC5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFsZEE7QUFDQTtBQW9kQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ })

/******/ });